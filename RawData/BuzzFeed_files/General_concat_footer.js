var BF_UniversalDOM=function(){this.UNIVERSAL_DOM_CLASS="bf_dom";this.UNIVERSAL_DOM_ATTR="rel:bf_bucket";this.UNIVERSAL_DOM_DATA_ATTR="rel:bf_bucket_data";this.UNIVERSAL_DOM_BUCKET_DATA_ATTR="rel:bf_data";this._bucket={};this._element_assignment_lookup={};this.init=function(){universal_dom._bucket={};bfjs.each(bfjs.$("."+universal_dom.UNIVERSAL_DOM_CLASS),function(t){universal_dom._assign(t)})};this.get_bucket_elements=function(t){if(typeof universal_dom._bucket[t]=="undefined")return[];var i=[];bfjs.each(universal_dom._bucket[t].elements,function(t){i.push(t.element)});return i};this.get_bucket_elements_with_data=function(t,i){if(typeof universal_dom._bucket[t]=="undefined")return[];var r=[];universal_dom._bucket[t].elements.each(function(t){var a=true;for(var s in i){if(typeof t.data[s]=="undefined"||t.data[s]!=i[s])a=false}if(a)r.push(t.element)});return r};this.class_regex=new RegExp(this.UNIVERSAL_DOM_CLASS);this.update=function(t){var i=$(t);if(i){var r=i.select('[class~="'+universal_dom.UNIVERSAL_DOM_CLASS+'"]')||[];if(i.hasClassName(this.UNIVERSAL_DOM_CLASS))r.push(i);r.each(function(t){universal_dom._assign(t)})}};this.assign_handler=function(t){var i=t.bucket;var r=t.handler;var a=t.event||"immediate";var s=true;var n=universal_dom._bucket[i]||{};var o=n.handlers||{};var l=o[a]||[];bfjs.each(l,function(t){if(t==r)s=false});if(s){l.push(r);o[a]=l;n.handlers=o;universal_dom._bucket[i]=n}universal_dom._assign_handler(i)};this.add_element_to_bucket=function(t){var i=t.bucket;var r=t.element;var a=t.data;var s=universal_dom._bucket[i]||{};var n=s.elements||[];n.push({element:r,data:a});s.elements=n;universal_dom._bucket[i]=s;universal_dom._assign_handler(i);var o=universal_dom._element_assignment_lookup[r]||[];o.push(i);universal_dom._element_assignment_lookup[r]=o};this.remove_element_from_buckets=function(t){var i=universal_dom._element_assignment_lookup[t];if(i){i.each(function(i){var r=[];universal_dom._bucket[i].elements.each(function(i){if(i.element!=t)r.push(i)});universal_dom._bucket[i].elements=r})}};this.refresh_immediate_bucket=function(t){if(universal_dom._bucket[t].elements){universal_dom._bucket[t].elements.each(function(i){if(universal_dom._bucket[t].handlers.immediate){universal_dom._bucket[t].handlers.immediate.each(function(t){t(i.element,i.data)})}})}};this._assign_handler=function(t){var i=universal_dom._bucket[t];var r=i.handlers;if(typeof i.elements=="undefined")i.elements=[];for(var a=0;a<i.elements.length;a++){var s=i.elements[a].element;var n=i.elements[a].data;n.element=s;for(var o in r){r[o].each(function(i){var r=n.assigned||{};if(typeof r[i.toString()]=="undefined"){if(o=="immediate")i(s,n);else{var l=Object.clone(n);s.observe(o,function(e){for(var t in l){e[t]=l[t]}i(e)})}}r[i.toString()]=true;n.assigned=r;universal_dom._bucket[t].elements[a].data=n})}}};this._assign=function(t){if(t.hasAttribute(this.UNIVERSAL_DOM_ATTR))this.bucket_attr(t);else if(t.hasAttribute(this.UNIVERSAL_DOM_DATA_ATTR))this.bucket_data_attr(t);else{}};this.update_or_add_element_in_bucket=function(t){var i=t.bucket;var r=t.element;var a=t.data;var s=universal_dom._bucket[i];if(typeof s=="undefined"||typeof s.elements=="undefined"||s.elements.length==0){universal_dom.add_element_to_bucket({bucket:i,element:r,data:a});return}var n=0;s.elements.each(function(t,i){if(t.element==r){s.elements[i].data=a;n=1;throw $break}});if(!n){universal_dom.add_element_to_bucket({bucket:i,element:r,data:a})}};this.bucket_attr=function(t){var i="";try{i=t.getAttribute(universal_dom.UNIVERSAL_DOM_ATTR);var r={};var a=t.getAttribute(universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR);if(a)r=JSON.parse(a);var s=i.split(" ");s.each(function(i){universal_dom.update_or_add_element_in_bucket({element:t,bucket:i,data:r})})}catch(e){console.error(e+i+t.id+universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR)}};this.bucket_data_attr=function(t){var i=t.getAttribute(universal_dom.UNIVERSAL_DOM_DATA_ATTR);try{var r=JSON.parse(i)}catch(e){console.error("Failed to parse JSON ("+i+") for element "+t+" (id:"+t.id+",class:"+t.className+",tag:"+t.tagName+")")}for(var a in r){universal_dom.update_or_add_element_in_bucket({element:t,bucket:a,data:r[a]})}};this.remove_bucket_elements=function(t){t.each(function(t){if(typeof universal_dom._bucket[t]!="undefined"){delete universal_dom._bucket[t].elements}})};this.assign_ids_to_elements_in_bucket=function(t,i){universal_dom._bucket[t].elements.each(function(t,r){if(typeof t.element!="undefined"&&!t.element.id)t.element.id=i(r)})}};var universal_dom=new BF_UniversalDOM;universal_dom.init();universal_dom.assign_handler({bucket:"toggle",event:"click",handler:function(e){e.stop();var t=function(t){if(t.style.display=="none")t.toggle();else if(t.hasClassName("hidden"))t.removeClassName("hidden");else t.addClassName("hidden")};if(typeof e.el!="undefined"){t($(e.el))}if(typeof e.els!="undefined"){e.els.each(function(i){t($(i))})}}});universal_dom.assign_handler({bucket:"stop",event:"click",handler:Event.stop});BF_ProgLoad_Images=function(){this.images=new Hash;this.index=1;this.DEBUG=false;this.bad_browser=0;this.autoload=false;this.autoload_interval=1e3;this.min_lookahead_pixels=400;this.init_total_delay=0;this.init_max_delay=1e4;this.init_delay_interval=250;var t=this;this.init=function(){bf_prog_load.media=new Hash;if(document.location.search.match(/progload_debug=true/)){this.DEBUG=true;console.debug("init progressive image loader...")}try{this.lookahead_pixels=document.viewport.getHeight();if(window["BF_IS_TOP_LIST"]&&this.lookahead_pixels<2e3)this.lookahead_pixels=2e3;if(this.lookahead_pixels<t.min_lookahead_pixels&&t.init_total_delay<t.init_max_delay){t.init_total_delay+=t.init_delay_interval;setTimeout(bf_prog_load.init,t.init_delay_interval);return}var i=document.viewport.getScrollOffsets();var r=i[1];r=document.viewport.getHeight()+r;universal_dom.get_bucket_elements("progload").each(function(i){var a=i.getAttribute("rel:bf_image_src");var s=i.cumulativeOffset()[1];if(bf_prog_load.DEBUG){console.log("INIT viewport: %s image offset: %s image: %s lookahead: %s pixels",r,s,a,bf_prog_load.lookahead_pixels);i.title=s}if(s!==0&&r>s-bf_prog_load.lookahead_pixels){if(bf_prog_load.DEBUG){i.style.border="solid red 1px"}t.load_image(i,a.match("^http(?:s?)://")?a:BF_STATIC.image_root+a)}else{var n={el:i,position:s,src:a};bf_prog_load.media.set(""+bf_prog_load.index,n);bf_prog_load.index++}});universal_dom.get_bucket_elements("progload_video").each(function(e){var t=e.cumulativeOffset()[1];bf_prog_load.media.set(""+bf_prog_load.index,{data:e,position:t,type:"video"});bf_prog_load.index++});if(Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6||Prototype.Browser.Opera||!!window.fb_app){bf_prog_load.bad_browser=1;setTimeout(function(){bf_prog_load.scrolled("all")},500)}else{Event.observe(window,"scroll",function(e){bf_prog_load.scrolled()})}}catch(e){console.error(e)}universal_dom.assign_handler({bucket:"add_to_prog_load",handler:bf_prog_load.add});t.autoload_media()};this.autoload_media=function(){t.autoload=true;if(t.DEBUG){console.info("Starting image autoload")}var i;i=setInterval(function(){if(!bf_prog_load.media.size()){if(t.DEBUG){console.info("End image autoload")}t.autoload=false;clearInterval(i)}else{bf_prog_load.media.each(function(i){var r=false;if(!i.value.type){var a=i.value.el.getAttribute("rel:bf_image_src");if(i.value.position===0||a==i.value.el.src){return false}if(t.DEBUG){i.value.el.style.border="solid orange 1px"}t.load_image(i.value.el,i.value.src.match("^http(?:s?)://")?i.value.src:BF_STATIC.image_root+i.value.src);r=true}else if(i.value.type=="video"){if(i.value.data){embed_video.load_video(i.value.data,true);r=true}}if(r){bf_prog_load.media.unset(i.key);throw $break}})}},t.autoload_interval)};this.image_watcher=function(i,r,a,s){this.maxRetries=3;this.retry=0;this.retryTimeout=[1e4,2e4,3e4];this.el=i;this.src=r;this.success=a;this.error=s;this.load=function(){if(t.DEBUG){console.log((this.retry==0?"First":"Try #"+this.retry)+" load "+this.src)}this.image=new Image;this.image.onload=function(t){return function(){t.onsuccess.call(t)}}(this);this.image.onabort=function(t){return function(){t.timeout.call(t)}}(this);this.image.onerror=function(t){return function(){t.timeout.call(t)}}(this);this.image.src=this.src};this.onsuccess=function(){this.image=null;this.success(this)};this.timeout=function(){this.image=null;if(this.retry>=this.maxRetries){this.error(this);return}if(t.DEBUG){console.log("Waiting "+this.retryTimeout[this.retry]+" ms on "+this.src)}setTimeout(function(t){return function(){t.load.call(t)}}(this),this.retryTimeout[this.retry]);this.retry++}};this.load_image=function(i,r){if(!i)return false;if(i.className.match(/progload-tweet/)){bf_prog_load.loadTwitterEmbed(i);return false}else if(i.className.match(/progload-instagram/)){bf_prog_load.loadInstagramEmbed(i);return false}var a=(new Date).getTime();new this.image_watcher(i,r,function(a){if(t.DEBUG){console.info("Image %s was loaded successfully.",a.src)}i.src=r},function(r){if(t.DEBUG){console.error("Image %s wasn't loaded.",r.src)}i.src=trans_gif_1x1_base64}).load()};this.loadInstagramEmbed=function(t){var i=t.getAttribute("rel:bf_instagram_el"),r=document.getElementById(i);if(r){r.className="instagram-media";if(typeof instgrm!="undefined"&&typeof instgrm.Embeds!="undefined")instgrm.Embeds.process()}};this.loadTwitterEmbed=function(t){if(typeof EventManager!="undefined"){EventManager.fire("progload:tweet",{el:t})}};this.scrolled=function(i){try{bf_prog_load.media.each(function(r){var a=document.viewport.getScrollOffsets();var s=a[1];s=document.viewport.getHeight()+s;if(r.value.position!==0&&(s>r.value.position-bf_prog_load.lookahead_pixels||i)){if(bf_prog_load.DEBUG){console.log("SCROLL viewport: %s image offset: %s image: %s",s,r.value.position,r.value.src);if(i){r.value.el.style.border="solid green 1px"}else{r.value.el.style.border="solid blue 1px"}}if(r.value.data){embed_video.load_video(r.value.data,true)}else{t.load_image(r.value.el,r.value.src.match("^http(?:s?)://")?r.value.src:BF_STATIC.image_root+r.value.src)}bf_prog_load.media.unset(r.key)}})}catch(e){console.error(e)}};this.add=function(i){var r=i.getAttribute("rel:bf_image_src");var a=i.cumulativeOffset()[1];var s=document.viewport.getScrollOffsets();var n=s[1];n=document.viewport.getHeight()+n;if(a!==0&&(n>a-bf_prog_load.lookahead_pixels||bf_prog_load.bad_browser)){if(bf_prog_load.DEBUG){i.style.border="solid yellow 1px";console.log("SHOW (add). offset: %s image: %s lookahead: %s pixels",a,r,bf_prog_load.lookahead_pixels)}t.load_image(i,r.match("^http(?:s?)://")?r:BF_STATIC.image_root+r)}else{var o={el:i,position:a,src:r};if(bf_prog_load.DEBUG){console.log("ADDING image. offset: %s image: %s lookahead: %s pixels",a,r,bf_prog_load.lookahead_pixels)}bf_prog_load.media.set(""+bf_prog_load.index,o);bf_prog_load.index++;if(!t.autoload){t.autoload_media()}}var l=i.getAttribute("rel:bf_bucket");var d=l.replace("add_to_prog_load","xx");i.setAttribute("rel:bf_bucket",d)}};var bf_prog_load=new BF_ProgLoad_Images;BuzzLoader.register(function(){bf_prog_load.init()},2);var BFPinterestReferer=function(){this.COOKIE="bf_referer";this.PAGE_TYPE;this.PROMO_INDEX=5;this.PROMO_PER_ROW=2;this.PROMO_ROWS=2;this.SPONSOR_INDEX=1;this.pinit_ps={};this.init=function(){var t=true;if(BF_STATIC.tt_page.match(/^(MobileHome|MobileDiy|MobileFood|MobileHealth|MobileParents|MobileStyle|MobileTravel|MobileWeddings)$/i)){bf_pinterest_referer.PAGE_TYPE="vertical";bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page.match(/^MobileBuzz$/)){bf_pinterest_referer.PAGE_TYPE="bpage-mobile";bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page.match(/^(DIY|Food|Health|Parents|Style|Travel|Weddings)$/i)){bf_pinterest_referer.PAGE_TYPE="vertical"}else if(BF_STATIC.hp_type&&BF_STATIC.hp_type.match(/^Life$/i)){bf_pinterest_referer.PAGE_TYPE="life";bf_pinterest_referer.PROMO_PER_ROW=6;bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page=="Buzz"){bf_pinterest_referer.PAGE_TYPE="bpage";if(document.getElementById("hotOnPinterestWrap")){var r=document.getElementById("hotOnPinterestWrap").getElementsByClassName("hot-on-pinterest");for(i=0;i<r.length;i++){pinterestunit=r[i];pinterestunit.setAttribute("data-promo_per_row",3);pinterestunit.setAttribute("data-promo_rows",1);pinterestunit.setAttribute("data-unit_type","bpage_bottom")}}}else{t=false}if(t)bf_pinterest_referer._init()};this._init=function(){bf_pinterest_referer.setup_observers();bf_pinterest_referer._loadPinterestScript();var t=document.getElementsByClassName("hot-on-pinterest__more");for(i=0;i<t.length;i++){bf_pinterest_referer.show_more(t[i])}};this.setup_observers=function(){var t=document.getElementsByClassName("hot-on-pinterest__more");for(i=0;i<t.length;i++){t[i].addEventListener("click",bf_pinterest_referer.show_more)}};this.show_more=function(t){var i=false;if(t.target){t=t.target;i=true}var r=t.parentNode.parentNode;var a=r.getAttribute("data-revealed");if(!a||i){var s=r.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;var n=r.getAttribute("data-promo_rows")||bf_pinterest_referer.PROMO_ROWS;var o=s*n;if(a==o)o=12;if(a==12)o=21;if(o==21)t.className+=" hidden";bf_pinterest_referer.reveal_promos(r,o)}};this.reveal_promos=function(t,i){t.setAttribute("data-revealed",i);var r=bf_pinterest_referer._get_the_promos(t);for(var a in r){var s=t.getElementsByClassName("js-sponsored");s=Object.keys(s).map(function(t){return s[t]});for(var n=0;n<r[a].length;n++){if(s.indexOf(r[a][n])!=-1)r[a].splice(n,1)}}var o=function(t){for(var a in r){for(var s=0;s<i&&s<r[a].length;s++){t.call(null,r[a][s])}}};o(function(i){if(i.className&&!i.className.match("js-backfill")||t.getElementsByClassName("js-sponsored hidden").length){i.className=i.className.toString().replace("hidden","")}var r=i.getElementsByClassName("pinterest-list__link");if(r.length){r[0].setAttribute("data-pin-do","buttonPin");var a=r[0].parentNode;a.className=a.className.toString().replace(/\s+hidden/,"");if(!i.getElementsByClassName("js-get_repin_count").length&&i.getElementsByClassName("pinterest-list__pin-count").length){var s=i.getElementsByClassName("pinterest-list__pin-count")[0];var n=s.getAttribute("data-pin-url");var o=document.createElement("script");o.type="text/javascript";o.async=true;o.className="js-get_repin_count";o.src="//api.pinterest.com/v1/urls/count.json?callback=bf_pinterest_referer.set_repin_count&url="+n;s.parentNode.insertBefore(o,s)}}if(typeof window.buildPinterestBtns!="undefined")window.buildPinterestBtns(i)});var l=t.getElementsByClassName("pinterest-list__li hidden");l=Object.keys(l).map(function(t){return l[t]});if(l.length){for(var n=0;n<l.length;n++){if(l[n].className&&l[n].className.match(/js-sponsored|js-backfill/)){l.splice(n,1)}}var d=t.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;if(l.length<d)l=[]}if(!l.length){t.getElementsByClassName("hot-on-pinterest__more")[0].className+=" hidden"}if(bf_pinterest_referer.PAGE_TYPE&&(!bf_pinterest_referer.PAGE_TYPE.match("bpage")||t.getAttribute("data-unit_type")=="bpage_bottom")){t.className=t.className.toString().replace("hidden","")}};this._get_the_promos=function(t){var i={};var r="pinterest_promo";var a=t.getElementsByClassName("pinterest-list__li");a=Object.keys(a).map(function(t){return a[t]});var s=t.getElementsByClassName("js-sponsored");s=Object.keys(s).map(function(t){return s[t]});var n=t.getElementsByClassName("js-backfill");n=Object.keys(n).map(function(t){return n[t]});s=s.concat(n);if(s.length<a.length){var o=[];var l=t.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;for(var d=a.length-1;d>0&&a.length%l!=0;d--){if(s.indexOf(a[d])==-1){var c=a.splice(d,1);o.push(c[0])}}var u=t.getElementsByClassName("js-sponsored").length;if(o.length>=u){while(o.length&&u>0){a.push(o.pop());u--}}else{var f=l-u;for(var d=a.length-1;d>0&&f>0;d--){if(s.indexOf(a[d])==-1){a.splice(d,1);f--}}}}i[r]=a;return i};this.set_repin_count=function(t){if(t&&t.count&&(t.count=parseInt(t.count))){var i=document.querySelectorAll('div[data-pin-url="'+t.url+'"]');for(var r=0;i[r];r++){var a=i[r];a.innerHTML=t.count.toLocaleString()+" repins"}}};this._loadPinterestScript=function(){if(!BF_STATIC.bf_test_mode){if(typeof window.buildPinterestBtns=="undefined"){var t,i,r=document;i=r.createElement("SCRIPT");i.type="text/javascript";i.async=true;i.setAttribute("data-pin-color","red");i.setAttribute("data-pin-build","buildPinterestBtns");i.src="//assets.pinterest.com/js/pinit.js";t=r.getElementsByTagName("SCRIPT")[0];t.parentNode.insertBefore(i,t)}}else{console.info("disable Dynamically load assets.pinterest.com/js/pinit.js for test mode")}}};bf_pinterest_referer=new BFPinterestReferer;bf_pinterest_referer.init();BF_DID_REGISTER=false;BF_Register=function(){this.highlight_field=new Array;this.ajax=new BF_Request;this.ERR_MISSING_PARAMS="Please complete all fields.";this.ERR_BAD_USERNAME="Your username may only contain letters and numbers.";this.ERR_USERNAME_LENGTH="Your username must be between 3 and 30 characters in length.";this.ERR_PW_LENGTH="Your password must be at least 6 characters in length.";this.ERR_MUST_AGGEE=local.t("You must agree to the Terms of Service in order to register.");this.ERR_PW_MUST_MATCH="Your passwords do not match.";this.ERR_DUP_USERNAME="Sorry, that username is not available. Please try another.";this.ERR_DUP_SITENAME="Sorry, that domain name is not available. Please try another.";this.ERR_BAD_INVITE="Sorry, the invite code you entered is not valid.";this.ERR_DUP_EMAIL="There is already an account with that email address.";this.ERR_FB_DUP_EMAIL="The email address that belongs to your Facebook account has already been used by another BuzzFeed account.";this.BANNED_FB_UID=local.t("You cannot register with that Facebook user.");this.ERR_BAD_EMAIL="You have entered an invalid email address.";this.ERR_NO_ALIASES="Sorry, you don't have enough site aliases left to create a tracked site.";this.ERR=local.t("Sorry, we are unable to process your request at this time.");this.ERR_ALREADY_REGISTERED="You have already registered for an account";this.highlight_field[this.ERR_BAD_USERNAME]="register-username";this.highlight_field[this.ERR_USERNAME_LENGTH]="register-username";this.highlight_field[this.ERR_PW_LENGTH]="register-pw1";this.highlight_field[this.ERR_PW_MUST_MATCH]="register-pw2";this.highlight_field[this.ERR_MUST_AGGEE]="register-agree";this.highlight_field[this.ERR_DUP_USERNAME]="register-username";this.highlight_field[this.ERR_DUP_EMAIL]="bfe";this.highlight_field[this.ERR_BAD_EMAIL]="bfe";this.SUCCESS1="Thanks for registering. We've created your account and saved your post, but before we post it we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br /><br />Your post will appear automatically once you validate.";this.SUCCESS1_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook, created your account and saved your post. ");this.SUCCESS2="Thanks for registering. We've created your account, but before you can vote we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.";this.SUCCESS2_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook and created your account. You now can vote.");this.SUCCESS3="<h3>Please Validate Your Email</h3><p>Thanks for registering. We've created your account, but before you can log in we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.</p>";this.SUCCESS3_VALIDATED="<h3>Your Email Has Been Validated</h3><p>"+local.t("Thanks for registering. We've created your account and validated your email address with Facebook. Some of your profile data has been prepopulated with information from your Facebook profile. You can log in now.")+"</p>";this.SUCCESS4="Thanks for registering. We've created your account, but before you can post we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br/><br/>Once you validate <a id='register_this_page_url' href=''>click here</a> to make a post.";this.SUCCESS4_VALIDATED="Thanks for registering. We've created your account and validated your email address with Facebook.";this.fb_link_handler=function(){var t=function(t){t.stop();$("facebook-login").hide();$("facebook-registration-form").hide();bf_login.switch_to_link_accounts()}.bind(this);if($("fb-link-submit"))$("fb-link-submit").observe("click",t);if($("fb-link-submit2"))$("fb-link-submit2").observe("click",t)};this.fb_register_handler=function(t,i){if(BF_Register.registered_fb_handler)return;BF_Register.registered_fb_handler=true;this.fb_link_handler();if(typeof t=="undefined")t=true;if(i)this.args=i;var r=function(t){t.stop();this.facebook_register()}.bind(this);if($("facebook-registration-form"))$("facebook-registration-form").stopObserving("submit",r);if($("facebook-registration-form"))$("facebook-registration-form").observe("submit",r);if($("fb-register-submig"))$("fb-register-submit").disabled=false;if(t&&$("facebook-registration-form"))$("facebook-registration-form").reset()};this.alias_register_handler=function(t,i){if(BF_Register.alias_registered_handler)return;BF_Register.alias_registered_handler=true;if(typeof t=="undefined")t=true;if(i)this.args=i;var r=function(t){t.stop();this.alias_register()}.bind(this);BF_UserSwitcher.count_aliases(function(t){var i=(new BF_User).getUserInfo();var r=parseInt(i.max_aliases)-parseInt(t.count);if($("alias-sites-left")&&t.success){$("alias-sites-left").update(r);if(r==1)$("alias-sites-left-plural").hide();if(t.unlimited==1)$("alias-count-message").hide();else $("alias-count-message").show();if(r<=0&&i.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}});if($("alias-registration-form"))$("alias-registration-form").stopObserving("submit",r);if($("alias-registration-form"))$("alias-registration-form").observe("submit",r);if($("alias-registration-form"))$("alias-register-submit").disabled=false;if(t&&$("alias-registration-form"))$("alias-registration-form").reset()};this.register_handler=function(t,i){if(BF_Register.registered_handler)return;BF_Register.registered_handler=true;if(typeof t=="undefined")t=true;if(i)this.args=i;var r=function(t){t.stop();this.register()}.bind(this);if($("regsitration-form"))$("regsitration-form").stopObserving("submit",r);if($("regsitration-form"))$("regsitration-form").observe("submit",r);if($("register-submit"))$("register-submit").disbaled=false;if(t&&$("regsitration-form"))$("regsitration-form").reset()};this.facebook_register=function(){var t=$F("fb-register-name").strip();var i="get_from_facebook@buzzfeed.com";try{i=facebook.user_data.email}catch(e){}var r=$F("fb-register-username").strip();var a=$F("fb-register-pw1").strip();var s=true;var n=0;var o=$("import_fb_profile_checkbox").checked?"true":"false";if(o=="false")t=r;var l=$("fb-facebook-uid")?$("fb-facebook-uid").value:"";this.username=r;this.password=a;if($("fb-email-me").checked){n=1}var d=function(t){this.response(t)}.bindAsEventListener(this);var c=function(t){this.err(t)}.bindAsEventListener(this);var u={name:t,username:r,pw:a,email:i,contribute:1,allow_email_updates:n,facebook_uid:l,import_fb_profile:o,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:u,onSuccess:d,onFailure:c})};this.alias_register=function(){var t=$("alias-register-username").value.strip();if(!t.match(/^[a-zA-Z0-9]+$/)){this._alias_register({success:0,message:"Site URL must consist of only alphanumeric characters"});return}var i=$("alias-register-display_name").value;if($("alias-registering-status"))$("alias-registering-status").show();if(!t||!i){this._alias_register({success:0,message:"missing username"})}else{BF_UserSwitcher.create_alias({username:t,display_name:i},this._alias_register)}};this._alias_register=function(t){if(t.success==0||t.status!=200){$("alias-message").show();if(t.message.match(/missing username/i)){$("alias-message").update("please fill out all fields")}else if(t.message.match(/logged in/i)){$("alias-message").update("please log in and try again")}else if(t.message.match(/privileges/i)){$("alias-message").update("you don't have permission to create an alias")}else if(t.message.match(/limit/i)){$("alias-message").update("Sorry, but you are over your alias limit")}else if(t.message.match(/username/i)){$("alias-message").update("this site URL already is taken, please select another")}else{$("alias-message").update(t.message)}}else{if($("alias-registration-fieldset"))$("alias-registration-fieldset").hide();if($("alias-registration-creating-site"))$("alias-registration-creating-site").show();BF_UserSwitcher.switchTo(t.userid,function(){})}if($("alias-registering-status"))$("alias-registering-status").hide()};this.register=function(){if($("registering-status"))$("registering-status").show();var t="";var i="";if(typeof this.args=="undefined"){this.args={action:"vote"}}var r=$F("register-name").strip();var a=$F("bfe").strip();var s=$F("register-username").strip();var n=$F("register-pw1").strip();var o=$F("register-pw2").strip();var l=false;var d="";var c="";var u="";var f="";var p=false;if(BF_STATIC.facebook_enabled){u=$("facebook-uid")?$("facebook-uid").value:"";p=$("import_fb_profile_checkbox").checked}if($("register-agree").checked){l=true}if($("email-me").checked){d=1}var _=true;if(!r||!a||!s||!n||!o){this.update_registration_message(this.ERR_MISSING_PARAMS)}else if(!s.match(/^[a-zA-Z0-9]+$/)){this.update_registration_message(this.ERR_BAD_USERNAME)}else if(s.length<3||s.length>30){this.update_registration_message(this.ERR_USERNAME_LENGTH)}else if(n!=o){this.update_registration_message(this.ERR_PW_MUST_MATCH)}else if(!l){this.update_registration_message(this.ERR_MUST_AGGEE)}else if(typeof n=="undefined"||n.length<6){this.update_registration_message(this.ERR_PW_LENGTH)}else if(typeof a=="undefined"||!a.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){this.update_registration_message(this.ERR_BAD_EMAIL)}else if(t=="yoursite.com"||i=="invite code"){this.update_registration_message("Please enter your site's domain.")}else if(t!=""&&!t.match(/\w\.\w/)){this.update_registration_message("Please enter a valid domain for site (example.com).")}else{_=false;this.username=s;this.password=n;var h=function(t){this.response(t)}.bindAsEventListener(this);var m=function(t){this.err(t)}.bindAsEventListener(this);$("register-submit").disbaled=true;var g={name:r,username:s,pw:n,email:a,contribute:1,allow_email_updates:d,facebook_uid:u,location:c,link:f,import_fb_profile:p,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:g,onSuccess:h,onFailure:m})}if(_){if($("register-submit"))$("register-submit").disabled=false;$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()}};this.update_registration_message=function(t){if(Prototype.Browser.IE){$("registration-message").innerText=t;$("facebook-registration-message").innerText=t}else{$("registration-message").update(t);$("facebook-registration-message").update(t)}if(this.__error_field){this.__error_field.style.border="1px solid gray";this.__error_field=null}if(this.highlight_field[t]&&$(this.highlight_field[t])){$(this.highlight_field[t]).style.border="1px solid red";this.__error_field=$(this.highlight_field[t])}};this.response=function(t){var i=this.username;var r=this.password;$("registering-status").hide();try{$("register-submit").disbaled=false;obj=JSON.parse(t.responseText);if(!obj||!obj.status){this.err()}else{if(obj.status=="success"){__reg_ok=true;BF_DID_REGISTER=true;$("regsitration-form").reset();if(this.args&&this.args.action=="signin"){if($("contribute-success"))$("contribute-success").hide();if($("registered-success"))$("registered-success").show();if($("registration-div"))$("registration-div").hide();if($("reg-success-message")){var a=this.SUCCESS3;if(obj.user_validated)a=this.SUCCESS3_VALIDATED;$("reg-success-message").update(a);$("reg-success-message").show();if(typeof return_tracker!="undefined")return_tracker.track_goal("register_signin");if(obj.user_validated){var s={username:i,password:r,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:s,onSuccess:function(t){bf_login.loggedIn(t);if(window.location.href.indexOf("/signin")!=-1)window.location.href="/"+i},onFailure:bf_login.err})}}}else if(this.args&&this.args.action=="badge_vote"){if(typeof return_tracker!="undefined")return_tracker.track_goal("register_badge_vote");if(badge_vote_manager&&badge_vote_manager.onRegister){badge_vote_manager.onRegister()}else{if($("registered-vote-success"))$("registered-vote-success").show();if($("registration-div"))$("registration-div").hide()}}else if(this.args&&this.args.action=="micosite_submission"){if(typeof return_tracker!="undefined")return_tracker.track_goal("register_microsite");if(typeof picks_controller!="undefined"&&picks_controller.onLogin)picks_controller.onLogin()}else if(this.args&&this.args.onRegister){if(typeof return_tracker!="undefined")return_tracker.track_goal("register");this.args.onRegister(obj)}else{if(typeof return_tracker!="undefined")return_tracker.track_goal("register");if($("contribute-success"))$("contribute-success").hide();if($("registered-success"))$("registered-success").show();if($("registration-div"))$("registration-div").hide();if(bf_contribute&&bf_contribute.type=="image"){var a=this.SUCCESS4;if(obj.user_validated)a=this.SUCCESS4_VALIDATED;if($("reg-success-message"))$("reg-success-message").update(a)}else{var a=this.SUCCESS1;if(obj.user_validated){a=this.SUCCESS1_VALIDATED;if($("please-validate-your-email"))$("please-validate-your-email").update("We Have Validated Your Email");var s={username:i,password:r,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:s,onSuccess:function(t){bf_login.loggedIn(t,this.args);if(window.location.href.indexOf("/signin")!=-1)window.location.href="/"+i},onFailure:bf_login.err})}if($("reg-success-message"))$("reg-success-message").update(a)}bf_contribute.submit({})}if($("register_this_page_url")){var n=document.location.href;n=n.replace(/#.*/,"");$("register_this_page_url").href=n}}else{var o=true;if(obj.message=="bad beta key"){this.update_registration_message(this.ERR_BETA_KEY)}else if(obj.message=="duplicate username"||obj.message=="url already taken"){this.update_registration_message(this.ERR_DUP_USERNAME)}else if(obj.message=="duplicate site name"){this.update_registration_message(this.ERR_DUP_SITENAME)}else if(obj.message=="Your invite code is not valid."){this.update_registration_message(this.ERR_BAD_INVITE)}else if(obj.message=="duplicate email"){if(facebook.is_logged_in())this.update_registration_message(this.BANNED_FB_UID);else this.update_registration_message(this.ERR_DUP_EMAIL)}else{this.err();o=false}if(o){if($("register-submit"))$("register-submit").disabled=false;$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show()}}}}catch(e){console.dir({e:e});this.err()}};this.err=function(t){$("register-submit").disabled=false;$("facebook-registration-message").update(this.ERR);$("facebook-registration-message").addClassName("error");
$("facebook-registration-message").show();$("registration-message").update(this.ERR);$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()};this.redirect_to=function(t){window.location.href=BF_STATIC.web_root+"/"+t};this.form_values=function(t){if(typeof t.pw=="undefined"){if($("register-password").value!=$("register-password").getAttribute("defaultvalue")){t.pw=$("register-password").value}}if(typeof t.username=="undefined"){if(bf_register.signup_page()){if($(signup_page.currentNameBox()).value!=$(signup_page.currentNameBox()).getAttribute("defaultvalue")){t.name=t.username=$(signup_page.currentNameBox()).value}}else{t.name=t.username=$("register-uri-text").value}}if(typeof t.email=="undefined"){if($("register-email").value!=$("register-email").getAttribute("defaultvalue")){t.email=$("register-email").value}}return t};this.create_advertiser_account=function(t){if(!acl.user_can("partners_manage"))return;var i=[];var r={create_advertiser_account:1,pw:t.pw||"",pw2:t.pw||"",name:t.name||t.username||"",username:t.username||"",email:t.email||"",contribute:1};var a=false;var s=new Array("email","username","pw");var n={email:"email",username:"username",pw:"password"};s.each(function(t){if(typeof r[t]!="undefined"&&typeof r[t].strip!="undefined")r[t]=r[t].strip();if(typeof r[t]=="undefined"||r[t]==""){i.push("Missing "+n[t]);if(t=="email")a=true}});if(!a&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){i.push(local.t("Please enter a valid email address"));if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var o=bf_register.currentErrorBox();var l=function(t){i=true;if(o){o.update(t);o.show()}};if(i.length)return l(i.join(", "));if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:r,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(t){var i=JSON.parse(t.responseText);bf_register._new_register(r,i)}})};this.create_contributor_account=function(t){if(!acl.user_can("editors_manage"))return;var i=[];var r={create_contributor_account:1,pw:t.pw||"",pw2:t.pw||"",name:t.name||t.username||"",username:t.username||"",email:t.email||"",contribute:1};var a=false;var s=new Array("email","username","pw");var n={email:"email",username:"username",pw:"password"};s.each(function(t){if(typeof r[t]!="undefined"&&typeof r[t].strip!="undefined")r[t]=r[t].strip();if(typeof r[t]=="undefined"||r[t]==""){i.push("Missing "+n[t]);if(t=="email")a=true}});if(!a&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){i.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var o=bf_register.currentErrorBox();var l=function(t){i=true;if(o){o.update(t);o.show()}};if(i.length)return l(i.join(", "));if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:r,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(t){var i=JSON.parse(t.responseText);bf_register._new_register(r,i)}})};this.newRegisterCallbacks=[];this.new_register=function(t){if(t.create_advertiser_account)return bf_register.create_advertiser_account(t);if(t.create_contributor_account)return bf_register.create_contributor_account(t);if(typeof t.pw2=="undefined")t.pw2=t.pw;if(typeof t.name=="undefined")t.name=t.username;var i=false;var r={username:local.t("Please enter a username."),email:local.t("Please enter a valid email address"),pw:local.t("Please enter a password")};var a=bf_register.currentErrorBox();var s=function(t){i=true;if(a){a.update(t);a.show()}};t=this.form_values(t);var n=new Array("name","email","username","pw");n.each(function(i){if(typeof t[i]!="undefined")t[i]=t[i].strip()});if(t.username=="username"){t.username=""}for(var o in r){if(typeof t[o]=="undefined"||t[o]==""){s(r[o]);break}}if(t.username=="url"){t.username=""}if(t.pw=="password"){t.pw=""}if(t.email=="your@email.com"){t.email=""}if(!i&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){s("Please enter a valid email address")}if(!i&&(t.username.length<3||t.username.length>30)){s("Please enter a URL between 3 and 30 characters")}if(!i&&t.pw.length<6){s("Your password must have at least 6 characters")}if(!i){if(document.location.search.indexOf("registered_from=")){var l=document.location.search.substring(1);var d=l.split("&");d.each(function(i){var r=i.split("=");if(r[0]=="registered_from"){t.registered_from_url=r[1]}})}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:t,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(i){var r=JSON.parse(i.responseText);bf_register._new_register(t,r)}})}};this._new_register=function(t,i){if(i.status=="failed")bf_register._error(i);else bf_register._success(t,i)};this._error=function(t){var i={"duplicate email":bf_register.ERR_DUP_EMAIL,"duplicate username":bf_register.ERR_DUP_USERNAME};if($("registration-success-message")){old_msg.hide()}var r=bf_register.currentErrorBox();if(bf_register.signup_page()){signup_page.toggleSpinner(0)}if(r){var a;if(a=t.message.match(/^(.*) at lib/)){t.message=a[1]}r.update(i[t.message]||t.message);r.show()}};this._success=function(t,i){if(bf_register.currentErrorBox()){bf_register.currentErrorBox().hide()}i.user_validated=i.user_validated==true||i.user_validated=="true";if(i.user_validated){var r={username:t.username,password:t.pw,contribute:1};bf_register.dont_switch=i.dont_switch||0;bf_register.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:r,while_processing:{show:"logging-in",hide:"new-registration-form"},onSuccess:function(t){if(bf_register.dont_switch){var i=JSON.parse(t.responseText);bf_register.redirect_to("settings/"+i.username)}else{if(typeof return_tracker!="undefined")return_tracker.track_goal("register");bf_login.loggedIn(t);bf_register.redirect_to("settings?firstTime=true")}}})}else{if(bf_register.signup_page()){signup_page.toggleSpinner(0);signup_page.openDialog("old")}if(typeof return_tracker!="undefined")return_tracker.track_goal("register");var a=$("new-registration-form");var s=$("registration-success-message");if(a)a.hide();if(s)s.show()}if(this.newRegisterCallbacks.length){this.newRegisterCallbacks.each(function(r){r(t,i)})}};this.register_alias=function(t){var i=false;var r=bf_register.currentErrorBox();var a=function(t){i=true;if(r){r.update(t);r.show()}};if(!t.username||t.username.length<3||t.username.length>30){if(bf_register.signup_page()){a("Please enter a username between 3 and 30 characters")}else{a("Please enter a URL between 3 and 30 characters")}}if(!i){if(bf_register.signup_page()){signup_page.toggleSpinner(1)}BF_UserSwitcher.create_alias({username:t.username,display_name:typeof t.name=="undefined"?t.username:t.name},bf_register._register_alias)}};this._register_alias=function(t){if(t.success==0||t.status!=200){bf_register._error({message:t.message||"Unable to create an alias at this time"})}else{BF_UserSwitcher.switchTo(t.userid,function(){window.location.href=BF_STATIC.web_root+"/"+t.username})}};this.signup_page=function(){return BF_STATIC.tt_page=="Signup"?true:false};this.currentErrorBox=function(){return bf_register.signup_page()?$(signup_page.currentErrorBox()):$("registration-error-message")}};if(!window.AJAX_TEST_STATUS)window.AJAX_TEST_STATUS={};var qq=qq||{};qq.extend=function(t,i){for(var r in i){t[r]=i[r]}};qq.indexOf=function(t,i,r){if(t.indexOf)return t.indexOf(i,r);r=r||0;var a=t.length;if(r<0)r+=a;for(;r<a;r++){if(r in t&&t[r]===i){return r}}return-1};qq.getUniqueId=function(){var t=0;return function(){return t++}}();qq.attach=function(t,i,r){if(t.addEventListener){t.addEventListener(i,r,false)}else if(t.attachEvent){t.attachEvent("on"+i,r)}};qq.detach=function(t,i,r){if(t.removeEventListener){t.removeEventListener(i,r,false)}else if(t.attachEvent){t.detachEvent("on"+i,r)}};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.insertBefore=function(t,i){i.parentNode.insertBefore(t,i)};qq.remove=function(t){t.parentNode.removeChild(t)};qq.contains=function(t,i){if(t==i)return true;if(t.contains){return t.contains(i)}else{return!!(i.compareDocumentPosition(t)&8)}};qq.toElement=function(){var t=document.createElement("div");return function(i){t.innerHTML=i;var r=t.firstChild;t.removeChild(r);return r}}();qq.css=function(t,i){if(i.opacity!=null){if(typeof t.style.opacity!="string"&&typeof t.filters!="undefined"){i.filter="alpha(opacity="+Math.round(100*i.opacity)+")"}}qq.extend(t.style,i)};qq.hasClass=function(t,i){var r=new RegExp("(^| )"+i+"( |$)");return r.test(t.className)};qq.addClass=function(t,i){if(!qq.hasClass(t,i)){t.className+=" "+i}};qq.removeClass=function(t,i){var r=new RegExp("(^| )"+i+"( |$)");t.className=t.className.replace(r," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(t,i){t.innerText=i;t.textContent=i};qq.children=function(t){var i=[],r=t.firstChild;while(r){if(r.nodeType==1){i.push(r)}r=r.nextSibling}return i};qq.getByClass=function(t,i){if(t.querySelectorAll){return t.querySelectorAll("."+i)}var r=[];var a=t.getElementsByTagName("*");var s=a.length;for(var n=0;n<s;n++){if(qq.hasClass(a[n],i)){r.push(a[n])}}return r};qq.ie=function(){"use strict";return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){"use strict";return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.obj2url=function(t,i,r){var a=[],s="&",n=function(t,r){var s=i?/\[\]$/.test(i)?i:i+"["+r+"]":r;if(s!="undefined"&&r!="undefined"){a.push(typeof t==="object"?qq.obj2url(t,s,true):Object.prototype.toString.call(t)==="[object Function]"?encodeURIComponent(s)+"="+encodeURIComponent(t()):encodeURIComponent(s)+"="+encodeURIComponent(t))}};if(!r&&i){s=/\?/.test(i)?/\?$/.test(i)?"":"&":"?";a.push(i);a.push(qq.obj2url(t))}else if(Object.prototype.toString.call(t)==="[object Array]"&&typeof t!="undefined"){for(var o=0,l=t.length;o<l;++o){n(t[o],o)}}else if(typeof t!="undefined"&&t!==null&&typeof t==="object"){for(var o in t){n(t[o],o)}}else{a.push(encodeURIComponent(i)+"="+encodeURIComponent(t))}return a.join(s).replace(/^&/,"").replace(/%20/g,"+")};qq.isObject=function(t){"use strict";return t!==null&&t&&typeof t==="object"&&t.constructor===Object};qq.isFunction=function(t){"use strict";return typeof t==="function"};qq.each=function(t,i){"use strict";var r,a;if(t){for(r in t){if(Object.prototype.hasOwnProperty.call(t,r)){a=i(r,t[r]);if(a===false){break}}}}};qq.obj2FormData=function(t,i,r){"use strict";if(!i){i=new FormData}qq.each(t,function(t,a){t=r?r+"["+t+"]":t;if(qq.isObject(a)){qq.obj2FormData(a,i,t)}else if(qq.isFunction(a)){i.append(t,a())}else{i.append(t,a)}});return i};qq.obj2Inputs=function(t,i){"use strict";var r;if(!i){i=document.createElement("form")}qq.obj2FormData(t,{append:function(t,a){r=document.createElement("input");r.setAttribute("name",t);r.setAttribute("value",a);i.appendChild(r)}});return i};var qq=qq||{};qq.FileUploaderBasic=function(t){var i=this;this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,autoUpload:true,sendAsForm:false,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(t,i){},onProgress:function(t,i,r,a){},onComplete:function(t,i,r){},onCancel:function(t,i){},onValidate:function(t,i,r){},onError:function(t,i,r){},urlHandler:false,messages:{typeError:"{file} has an invalid extension. Permitted file types are {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled.",noFiles:"Only files on your computer can be uploaded."},showMessage:function(t){alert(t)}};qq.extend(this._options,t);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(t){this._options.params=t},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var t=0;t<this._storedFiles.length;t++){var i=this._getItemByFileId(this._storedFiles[t]);this._find(i,"spinner").style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[t],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(t){var i=this;return new qq.UploadButton({element:t,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(r){i._onInputChange(r);i._createUploadButton(t)}})},_createUploadHandler:function(){var t=this,i;if(qq.UploadHandlerXhr.isSupported()){i="UploadHandlerXhr"}else{i="UploadHandlerForm"}var r=new qq[i]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(i,r,a,s){t._onProgress(i,r,a,s);t._options.onProgress(i,r,a,s)},onComplete:function(i,r,a){t._onComplete(i,r,a);t._options.onComplete(i,r,a)},onCancel:function(i,r){t._onCancel(i,r);t._options.onCancel(i,r)}});return r},_preventLeaveInProgress:function(){var t=this;qq.attach(window,"beforeunload",function(e){if(!t._filesInProgress){return}var e=e||window.event;e.returnValue=t._options.messages.onLeave;return t._options.messages.onLeave})},_onSubmit:function(t,i){this._filesInProgress++},_onProgress:function(t,i,r,a){},_onComplete:function(t,i,r){this._filesInProgress--;if(r.error){this._options.showMessage(r.error)}},_onCancel:function(t,i){this._filesInProgress--},_onInputChange:function(t){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(t.files)}else{if(this._validateFile(t)){this._uploadFile(t)}}this._button.reset()},_uploadFileList:function(t){var i,r;i=this._getValidationDescriptors(t);if(i.length>1){r=this._options.onValidate(i,true)===false}if(!r){if(typeof t=="undefined"||t.length<1){return false}for(var a=0;a<t.length;a++){if(!this._validateFile(t[a])){return}}for(var a=0;a<t.length;a++){this._uploadFile(t[a])}}},_uploadFile:function(t){var i=this._handler.add(t);var r=this._handler.getName(i);if(this._options.onSubmit(i,r,t)!==false){this._handler._options.action=this._options.action;this._handler._options.sendAsForm=this._options.sendAsForm;this._handler._options.headers=this._options.headers;this._onSubmit(i,r);if(this._options.autoUpload){this._handler.upload(i,this._options.params)}else{this._filesInProgress--;var a=this._getItemByFileId(i);this._find(a,"spinner").style.display="none";this._storedFiles.push(i)}}},_validateFile:function(t){var i,r,a;i=this._getValidationDescriptor(t);if(this._options.onValidate(i,false,t)===false){return false}if(t.value){r=t.value.replace(/.*(\/|\\)/,"")}else{r=t.fileName!=null?t.fileName:t.name;a=t.fileSize!=null?t.fileSize:t.size}if(!this._isAllowedExtension(r)){this._error("typeError",r);return false}else if(a===0){this._error("emptyError",r);return false}else if(a&&this._options.sizeLimit&&a>this._options.sizeLimit){this._error("sizeError",r);return false}else if(a&&a<this._options.minSizeLimit){this._error("minSizeError",r);return false}return true},_error:function(t,i){var r=this._options.messages[t];function a(t,i){r=r.replace(t,i)}a("{file}",this._formatFileName(i));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.onError(null,i,r);this._options.showMessage(r);if(this._options.onError(r,i)!==false){this._options.onError(r,i)}},_formatFileName:function(t){if(t.length>33){t=t.slice(0,19)+"..."+t.slice(-13)}return t},_isAllowedExtension:function(t){var i=-1!==t.indexOf(".")?t.replace(/.*[.]/,"").toLowerCase():"";var r=this._options.allowedExtensions;if(!r.length){return true}for(var a=0;a<r.length;a++){if(r[a].toLowerCase()==i){return true}}return false},_formatSize:function(t){var i=-1;do{t=t/1024;i++}while(t>99);return Math.max(t,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][i]},_parseFileName:function(t){var i;if(t.value){i=t.value.replace(/.*(\/|\\)/,"")}else{i=t.fileName!==null&&t.fileName!==undefined?t.fileName:t.name}return i},_parseFileSize:function(t){var i;if(!t.value){i=t.fileSize!==null&&t.fileSize!==undefined?t.fileSize:t.size}return i},_getValidationDescriptor:function(t){var i,r,a;a={};i=this._parseFileName(t);r=this._parseFileSize(t);a.name=i;if(r){a.size=r}return a},_getValidationDescriptors:function(t){var i,r;r=[];for(i=0;i<t.length;i++){r.push(t[i])}return r}};qq.FileUploader=function(t){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,dropElement:null,listElement:null,skipDropElement:false,skipUploadElement:false,template:'<div class="qq-uploader">'+'<div class="qq-upload-drop-area" style="display:none"><span>Drop files here to upload</span></div>'+'<div type="button" class="qq-upload-button button2 small">Upload Image</div>'+'<ul class="qq-upload-list" style="display:none;"></ul>'+"</div>",fileTemplate:"<li>"+'<span class="qq-upload-file"></span>'+'<span class="qq-upload-spinner loader loader--small"></span>'+'<span class="qq-upload-size"></span>'+'<a class="qq-upload-cancel" href="#">Cancel</a>'+'<span class="qq-upload-failed-text">Failed</span>'+"</li>",classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"},additionalUploadIds:false});qq.extend(this._options,t);this._element=this._options.element;if(!this._options.skipDropTemplate){this._dropElement=this._options.dropElement?this._options.dropElement:this._options.element}if(!this._options.skipUploadTemplate){this._element.innerHTML=this._options.template;this._button=this._createUploadButton(this._find(this._element,"button"))}if(this._options.additionalUploadIds){for(var i=0;i<this._options.additionalUploadIds.length;i++){this._createUploadButton($(this._options.additionalUploadIds[i]))}}this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._bindCancelEvent();if(!this._options.skipDropTemplate)this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(t,i){var r=qq.getByClass(t,this._options.classes[i])[0];if(!r){throw new Error("element not found "+i)}return r},_setupDragDrop:function(){var t=this,i=this._find(this._dropElement,"drop");var r=new qq.UploadDropZone({element:i,onEnter:function(e){qq.addClass(i,t._classes.dropActive);e.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(e){qq.removeClass(i,t._classes.dropActive)},onDrop:function(e){gtrack.track_events("[ttp]:sidebar/minisuper","drag-n-drop","");var i=qq.getByClass(document,t._options.classes["drop"]);for(var r=0;r<i.length;r++){if(i[r]){qq.removeClass(i[r],t._classes.dropActive);i[r].style.display="none";$$("body")[0].removeClassName("qq-dragging")}}if(t._options.urlHandler&&e.dataTransfer.files.length==0){if(e.dataTransfer.types.indexOf&&-1!=e.dataTransfer.types.indexOf("text/uri-list")||e.dataTransfer.types.contains&&-1!=e.dataTransfer.types.contains("text/uri-list")){var a=e.dataTransfer.getData("text/uri-list");return t._options.urlHandler(e,a)}}t._uploadFileList(e.dataTransfer.files);if($(e.target).descendantOf($("suplist_omnibox_modules"))){gtrack.track_events("[ttp]:edit-item","drag-drop-image")}}});i.style.display="none";i.hide_fn=function(){this.style.display="none";$$("body")[0].removeClassName("qq-dragging")}.bind(i);qq.attach(document,"dragenter",function(e){$$("body")[0].addClassName("qq-dragging");if(!r._isValidFileDrag(e)||i.className.match(/disabled/))return;i.style.display="block"});qq.attach(document,"dragleave",function(e){var t=document.elementFromPoint(e.clientX,e.clientY);if(!t||t.nodeName=="HTML"||t.nodeName=="BODY"){i.hide_fn()}})},_onSubmit:function(t,i){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(t,i)},_onProgress:function(t,i,r,a){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var s=this._getItemByFileId(t);if(!s){var n=t;var o=0;while(!s){n++;o++;if(o>50)break;s=this._getItemByFileId(n)}}var l=this._find(s,"size");l.style.display="inline";var d;if(r!=a){d=Math.round(r/a*100)+"% from "+this._formatSize(a)}else{d=this._formatSize(a)}qq.setText(l,d)},_onComplete:function(t,i,r){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var a=this._getItemByFileId(t);if(!a){var s=t;var n=0;while(!a){s++;n++;if(n>50)break;a=this._getItemByFileId(s)}}qq.remove(this._find(a,"cancel"));qq.remove(this._find(a,"spinner"));if(r.success){qq.addClass(a,this._classes.success)}else{qq.addClass(a,this._classes.fail)}},_addToList:function(t,i){var r=qq.toElement(this._options.fileTemplate);r.qqFileId=t;var a=this._find(r,"file");qq.setText(a,this._formatFileName(i));this._find(r,"size").style.display="none";this._listElement.appendChild(r)},_getItemByFileId:function(t){var i=this._listElement.firstChild;while(i){if(i.qqFileId==t)return i;i=i.nextSibling}},_bindCancelEvent:function(){var t=this,i=this._listElement;if(i){qq.attach(i,"click",function(e){e=e||window.event;var i=e.target||e.srcElement;if(qq.hasClass(i,t._classes.cancel)){qq.preventDefault(e);var r=i.parentNode;t._handler.cancel(r.qqFileId);qq.remove(r)}})}}});qq.UploadDropZone=function(t){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(this._options,t);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(e){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var t=this;qq.attach(t._element,"dragover",function(e){if(!t._isValidFileDrag(e))return;var i=e.dataTransfer.effectAllowed;if(i=="move"||i=="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});qq.attach(t._element,"dragenter",function(e){if(!t._isValidFileDrag(e))return;t._options.onEnter(e)});qq.attach(t._element,"dragleave",function(e){if(!t._isValidFileDrag(e))return;t._options.onLeave(e);var i=document.elementFromPoint(e.clientX,e.clientY);if(qq.contains(this,i))return;t._options.onLeaveNotDescendants(e)});qq.attach(t._element,"drop",function(e){if(!t._isValidFileDrag(e))return;e.preventDefault();t._options.onDrop(e)})},_isValidFileDrag:function(e){if(qq.ie()&&!qq.ie10()){return false}var t=e.dataTransfer,i=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&t.effectAllowed!="none"&&(t.files||!i&&t.types&&t.types.contains&&t.types.contains("Files"))}};qq.UploadButton=function(t){this._options={element:null,multiple:false,name:"file",onChange:function(t){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,t);this._element=this._options.element;qq.css(this._element,{position:"relative"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var t=$(this._element).down("input[type=file]");if(t){return t}var i=document.createElement("input");if(this._options.multiple){i.setAttribute("multiple","multiple")}i.setAttribute("type","file");i.setAttribute("name",this._options.name);i.setAttribute("rel:gt_act","ignore");qq.css(i,{position:"absolute",right:0,top:0,fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0,width:"100%",height:"100%"});i.addClassName("file_mask");this._element.appendChild(i);var r=this;qq.attach(i,"change",function(){r._options.onChange(i)});qq.attach(i,"mouseover",function(){qq.addClass(r._element,r._options.hoverClass)});qq.attach(i,"mouseout",function(){qq.removeClass(r._element,r._options.hoverClass)});qq.attach(i,"focus",function(){qq.addClass(r._element,r._options.focusClass)});qq.attach(i,"blur",function(){qq.removeClass(r._element,r._options.focusClass)});if(window.attachEvent){i.setAttribute("tabIndex","-1")}return i}};qq.UploadHandlerAbstract=function(t){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(t,i,r,a){},onComplete:function(t,i,r){},onCancel:function(t,i){}};qq.extend(this._options,t);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(t){if(this._options.debug&&window.console)console.log("[uploader] "+t)},add:function(t){},upload:function(t,i){var r=this._queue.push(t);var a={};qq.extend(a,i);this._params[t]=a;if(r<=this._options.maxConnections){this._upload(t,this._params[t])}},cancel:function(t){this._cancel(t);this._dequeue(t)},cancelAll:function(){for(var t=0;t<this._queue.length;t++){this._cancel(this._queue[t])}this._queue=[]},getName:function(t){},getSize:function(t){},getQueue:function(){return this._queue},_upload:function(t){},_cancel:function(t){},_dequeue:function(t){var i=qq.indexOf(this._queue,t);this._queue.splice(i,1);var r=this._options.maxConnections;if(this._queue.length>=r&&i<r){var a=this._queue[r-1];this._upload(a,this._params[a])}}};qq.UploadHandlerForm=function(t){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(t){t.setAttribute("name","image");var i="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[i]=t;if(t.parentNode){qq.remove(t)}return i},getName:function(t){return this._inputs[t].value.replace(/.*(\/|\\)/,"")},_cancel:function(t){this._options.onCancel(t,this.getName(t));delete this._inputs[t];var i=document.getElementById(t);if(i){i.setAttribute("src","javascript:false;");qq.remove(i)}},_upload:function(t,i){var r=this._inputs[t];if(!r){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var a=this.getName(t);var s=this._createIframe(t);var n=this._createForm(s,i);n.appendChild(r);var o=this;this._attachLoadEvent(s,function(){o.log("iframe loaded");var i=o._getIframeContentJSON(s);o._options.onComplete(t,a,i);o._dequeue(t);delete o._inputs[t];setTimeout(function(){qq.remove(s)},1)});n.submit();qq.remove(n);return t},_attachLoadEvent:function(t,i){qq.attach(t,"load",function(){if(!t.parentNode){return}try{if(t.contentDocument&&t.contentDocument.body&&t.contentDocument.body.innerHTML=="false"){return}}catch(e){}i()})},_getIframeContentJSON:function(t){try{var i=t.contentDocument?t.contentDocument:t.contentWindow.document,r;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+i.body.innerHTML);try{r=JSON.parse(i.body.innerHTML)}catch(a){r={}}}catch(e){r={success:false}}return r},_createIframe:function(t){var i=qq.toElement('<iframe src="javascript:false;" name="'+t+'" />');i.setAttribute("id",t);i.style.display="none";document.body.appendChild(i);return i},_createForm:function(t,i){var r=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');qq.obj2Inputs(i,r);r.setAttribute("action",this._options.action);r.setAttribute("target",t.name);r.style.display="none";document.body.appendChild(r);return r}});qq.UploadHandlerXhr=function(t){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){try{var t=document.createElement("input");t.type="file";var i=false;var r=navigator.userAgent.toLowerCase();if(r.indexOf("safari")!=-1){i=true;if(r.indexOf("chrome")>-1){i=false}}var a=typeof FileReader!="undefined"&&typeof(new FileReader).readAsBinaryString=="undefined";return"multiple"in t&&typeof File!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"&&typeof FileReader!="undefined"&&typeof window.WebKitBlobBuilder=="undefined"&&!i&&!a}catch(e){console.error(e);return false}};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(t){if(!(t instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(t)-1},getName:function(t){var i=this._files[t];return i.fileName!=null?i.fileName:i.name},getSize:function(t){var i=this._files[t];return i.fileSize!=null?i.fileSize:i.size},getLoaded:function(t){return this._loaded[t]||0},_upload:function(t,i){var r=this._files[t],a=this.getName(t),s=this.getSize(t);this._loaded[t]=0;var n=this._xhrs[t]=new XMLHttpRequest;var o=this;var l=(new Date).getTime();n.upload.onprogress=function(e){if(e.lengthComputable){o._loaded[t]=e.loaded;o._options.onProgress(t,a,e.loaded,e.total)}};n.onreadystatechange=function(){if(n.readyState==4){try{if(BF_Request&&qp_superlist){var i=/\.gif/.test(a)?"gif":"image";var r=(new Date).getTime()-l;BF_Request.statsd.timer("superposter.image.client."+i+"_upload",r);BF_Request.statsd.timer("superposter.image.client.upload",r)}}catch(s){}o._onComplete(t,n)}};i=i||{};var d=qq.obj2url(i,this._options.action);n.open("POST",d,true);if(this._options.sendAsForm){try{if(typeof XMLHttpRequest.prototype.sendAsBinary=="undefined"){XMLHttpRequest.prototype.sendAsBinary=function(t){var i=new ArrayBuffer(t.length);var r=new Uint8Array(i,0);for(var a=0;a<t.length;a++)r[a]=t.charCodeAt(a)&255;this.send(r)}}}catch(e){console.error(e)}var c="---------------------------";c+=Math.floor(Math.random()*32768);c+=Math.floor(Math.random()*32768);c+=Math.floor(Math.random()*32768);var u=new FileReader;u.readAsBinaryString(r);u.onload=function(t){i["Filedata"]=u.result;i["Filename"]=encodeURIComponent(r.name);var a="";$H(i).each(function(t){if(a!="")a+="\r\n";a+="--"+c+"\r\n"+'Content-Disposition: form-data; charset: utf-8; accept-charset: utf-8; name="'+t.key+'"';if(t.key=="Filedata")a+='; filename="'+encodeURIComponent(r.name)+'"\r\nContent-Type: application/octet-stream';a+="\r\n\r\n"+t.value});a+="\r\n";a+="--"+c+"--\r\n";n.setRequestHeader("Content-Type","multipart/form-data; charset: utf-8; accept-charset: utf-8; boundary="+c);n.sendAsBinary(a)}}else{n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("X-File-Name",encodeURIComponent(a));n.setRequestHeader("X-Filesize-On-Client",s);n.setRequestHeader("Content-Type","application/octet-stream");if(this._options.headers){for(var f in this._options.headers){n.setRequestHeader(f,this._options.headers[f])}}n.send(r)}},_onComplete:function(t,i){if(!this._files[t])return;var r=this._xhrs[t];if(BF_STATIC.bf_env==="dev"&&BF_STATIC.bf_test_mode){var a=window.AJAX_TEST_STATUS[this._options.action];if(!a)a=new RequestStack;var s={xhr_request:r};s.status=i.status;if(a.push)a.push(s);else if(a.stack&&a.stack.push)a.stack.push(s);window.AJAX_TEST_STATUS[this._options.action]=a}var n=this.getName(t);var o=this.getSize(t);this._options.onProgress(t,n,o,o);if(i.status==200){this.log("xhr - server response received");this.log("responseText = "+i.responseText);var l;try{l=JSON.parse(i.responseText)}catch(d){l={}}try{if(acl.user_can("general_admin")&&l.uploaded&&(l.uploaded==="false"||l.uploaded===false)&&l.filesize_on_server){
(new Image).src="/buzzfeed/_error_logger?z="+(new Date).getTime()+"&error="+encodeURIComponent(JSON.stringify(l))}}catch(d){console.dir(d)}this._options.onComplete(t,n,l)}else{this._options.onComplete(t,n,{})}this._files[t]=null;this._xhrs[t]=null;this._dequeue(t)},_cancel:function(t){this._options.onCancel(t,this.getName(t));this._files[t]=null;if(this._xhrs[t]){this._xhrs[t].abort();this._xhrs[t]=null}}});var audioplayer_swfobject=function(){var t="undefined",i="object",r="Shockwave Flash",a="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",n="SWFObjectExprInst",o="onreadystatechange",l=window,d=document,c=navigator,u=false,f=[B],p=[],_=[],h=[],m,g,v,b,w=false,y=false,k,T,A=true,S=function(){var n=typeof d.getElementById!=t&&typeof d.getElementsByTagName!=t&&typeof d.createElement!=t,o=c.userAgent.toLowerCase(),f=c.platform.toLowerCase(),p=f?/win/.test(f):/win/.test(o),_=f?/mac/.test(f):/mac/.test(o),h=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,m=!+"1",g=[0,0,0],v=null;if(typeof c.plugins!=t&&typeof c.plugins[r]==i){v=c.plugins[r].description;if(v&&!(typeof c.mimeTypes!=t&&c.mimeTypes[s]&&!c.mimeTypes[s].enabledPlugin)){u=true;m=false;v=v.replace(/^.*\s+(\S+\s+\S+$)/,"$1");g[0]=parseInt(v.replace(/^(.*)\..*$/,"$1"),10);g[1]=parseInt(v.replace(/^.*\.(.*)\s.*$/,"$1"),10);g[2]=/[a-zA-Z]/.test(v)?parseInt(v.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof l.ActiveXObject!=t){try{var b=new ActiveXObject(a);if(b){v=b.GetVariable("$version");if(v){m=true;v=v.split(" ")[1].split(",");g=[parseInt(v[0],10),parseInt(v[1],10),parseInt(v[2],10)]}}}catch(e){}}return{w3:n,pv:g,wk:h,ie:m,win:p,mac:_}}(),E=function(){if(!S.w3){return}if(typeof d.readyState!=t&&d.readyState=="complete"||typeof d.readyState==t&&(d.getElementsByTagName("body")[0]||d.body)){C()}if(!w){if(typeof d.addEventListener!=t){d.addEventListener("DOMContentLoaded",C,false)}if(S.ie&&S.win){d.attachEvent(o,function(){if(d.readyState=="complete"){d.detachEvent(o,arguments.callee);C()}});if(l==top){(function(){if(w){return}try{d.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()})()}}if(S.wk){(function(){if(w){return}if(!/loaded|complete/.test(d.readyState)){setTimeout(arguments.callee,0);return}C()})()}x(C)}}();function C(){if(w){return}try{var t=d.getElementsByTagName("body")[0].appendChild(H("span"));t.parentNode.removeChild(t)}catch(e){return}w=true;var i=f.length;for(var r=0;r<i;r++){f[r]()}}function z(t){if(w){t()}else{f[f.length]=t}}function x(i){if(typeof l.addEventListener!=t){l.addEventListener("load",i,false)}else if(typeof d.addEventListener!=t){d.addEventListener("load",i,false)}else if(typeof l.attachEvent!=t){V(l,"onload",i)}else if(typeof l.onload=="function"){var r=l.onload;l.onload=function(){r();i()}}else{l.onload=i}}function B(){if(u){I()}else{N()}}function I(){var r=d.getElementsByTagName("body")[0];var a=H(i);a.setAttribute("type",s);var n=r.appendChild(a);if(n){var o=0;(function(){if(typeof n.GetVariable!=t){var i=n.GetVariable("$version");if(i){i=i.split(" ")[1].split(",");S.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}r.removeChild(a);n=null;N()})()}else{N()}}function N(){var i=p.length;if(i>0){for(var r=0;r<i;r++){var a=p[r].id;var s=p[r].callbackFn;var n={success:false,id:a};if(S.pv[0]>0){var o=D(a);if(o){if(W(p[r].swfVersion)&&!(S.wk&&S.wk<312)){Y(a,true);if(s){n.success=true;n.ref=q(a);s(n)}}else if(p[r].expressInstall&&F()){var l={};l.data=p[r].expressInstall;l.width=o.getAttribute("width")||"0";l.height=o.getAttribute("height")||"0";if(o.getAttribute("class")){l.styleclass=o.getAttribute("class")}if(o.getAttribute("align")){l.align=o.getAttribute("align")}var d={};var c=o.getElementsByTagName("param");var u=c.length;for(var f=0;f<u;f++){if(c[f].getAttribute("name").toLowerCase()!="movie"){d[c[f].getAttribute("name")]=c[f].getAttribute("value")}}U(l,d,a,s)}else{O(o);if(s){s(n)}}}}else{Y(a,true);if(s){var _=q(a);if(_&&typeof _.SetVariable!=t){n.success=true;n.ref=_}s(n)}}}}}function q(r){var a=null;var s=D(r);if(s&&s.nodeName=="OBJECT"){if(typeof s.SetVariable!=t){a=s}else{var n=s.getElementsByTagName(i)[0];if(n){a=n}}}return a}function F(){return!y&&W("6.0.65")&&(S.win||S.mac)&&!(S.wk&&S.wk<312)}function U(i,r,a,s){y=true;v=s||null;b={success:false,id:a};var o=D(a);if(o){if(o.nodeName=="OBJECT"){m=R(o);g=null}else{m=o;g=a}i.id=n;if(typeof i.width==t||!/%$/.test(i.width)&&parseInt(i.width,10)<310){i.width="310"}if(typeof i.height==t||!/%$/.test(i.height)&&parseInt(i.height,10)<137){i.height="137"}d.title=d.title.slice(0,47)+" - Flash Player Installation";var c=S.ie&&S.win?"ActiveX":"PlugIn",u="MMredirectURL="+l.location.toString().replace(/&/g,"%26")+"&MMplayerType="+c+"&MMdoctitle="+d.title;if(typeof r.flashvars!=t){r.flashvars+="&"+u}else{r.flashvars=u}if(S.ie&&S.win&&o.readyState!=4){var f=H("div");a+="SWFObjectNew";f.setAttribute("id",a);o.parentNode.insertBefore(f,o);o.style.display="none";(function(){if(o.readyState==4){o.parentNode.removeChild(o)}else{setTimeout(arguments.callee,10)}})()}L(i,r,a)}}function O(t){if(S.ie&&S.win&&t.readyState!=4){var i=H("div");t.parentNode.insertBefore(i,t);i.parentNode.replaceChild(R(t),i);t.style.display="none";(function(){if(t.readyState==4){t.parentNode.removeChild(t)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.replaceChild(R(t),t)}}function R(t){var r=H("div");if(S.win&&S.ie){r.innerHTML=t.innerHTML}else{var a=t.getElementsByTagName(i)[0];if(a){var s=a.childNodes;if(s){var n=s.length;for(var o=0;o<n;o++){if(!(s[o].nodeType==1&&s[o].nodeName=="PARAM")&&!(s[o].nodeType==8)){r.appendChild(s[o].cloneNode(true))}}}}}return r}function L(r,a,n){var o,l=D(n);if(S.wk&&S.wk<312){return o}if(l){if(typeof r.id==t){r.id=n}if(S.ie&&S.win){var d="";for(var c in r){if(r[c]!=Object.prototype[c]){if(c.toLowerCase()=="data"){a.movie=r[c]}else if(c.toLowerCase()=="styleclass"){d+=' class="'+r[c]+'"'}else if(c.toLowerCase()!="classid"){d+=" "+c+'="'+r[c]+'"'}}}var u="";for(var f in a){if(a[f]!=Object.prototype[f]){u+='<param name="'+f+'" value="'+a[f]+'" />'}}l.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+d+">"+u+"</object>";_[_.length]=r.id;o=D(r.id)}else{var p=H(i);p.setAttribute("type",s);for(var h in r){if(r[h]!=Object.prototype[h]){if(h.toLowerCase()=="styleclass"){p.setAttribute("class",r[h])}else if(h.toLowerCase()!="classid"){p.setAttribute(h,r[h])}}}for(var m in a){if(a[m]!=Object.prototype[m]&&m.toLowerCase()!="movie"){j(p,m,a[m])}}l.parentNode.replaceChild(p,l);o=p}}return o}function j(t,i,r){var a=H("param");a.setAttribute("name",i);a.setAttribute("value",r);t.appendChild(a)}function P(t){var i=D(t);if(i&&i.nodeName=="OBJECT"){if(S.ie&&S.win){i.style.display="none";(function(){if(i.readyState==4){M(t)}else{setTimeout(arguments.callee,10)}})()}else{i.parentNode.removeChild(i)}}}function M(t){var i=D(t);if(i){for(var r in i){if(typeof i[r]=="function"){i[r]=null}}i.parentNode.removeChild(i)}}function D(t){var i=null;try{i=d.getElementById(t)}catch(e){}return i}function H(t){return d.createElement(t)}function V(t,i,r){t.attachEvent(i,r);h[h.length]=[t,i,r]}function W(t){var i=S.pv,r=t.split(".");r[0]=parseInt(r[0],10);r[1]=parseInt(r[1],10)||0;r[2]=parseInt(r[2],10)||0;return i[0]>r[0]||i[0]==r[0]&&i[1]>r[1]||i[0]==r[0]&&i[1]==r[1]&&i[2]>=r[2]?true:false}function G(r,a,s,n){if(S.ie&&S.mac){return}var o=d.getElementsByTagName("head")[0];if(!o){return}var l=s&&typeof s=="string"?s:"screen";if(n){k=null;T=null}if(!k||T!=l){var c=H("style");c.setAttribute("type","text/css");c.setAttribute("media",l);k=o.appendChild(c);if(S.ie&&S.win&&typeof d.styleSheets!=t&&d.styleSheets.length>0){k=d.styleSheets[d.styleSheets.length-1]}T=l}if(S.ie&&S.win){if(k&&typeof k.addRule==i){k.addRule(r,a)}}else{if(k&&typeof d.createTextNode!=t){k.appendChild(d.createTextNode(r+" {"+a+"}"))}}}function Y(t,i){if(!A){return}var r=i?"visible":"hidden";if(w&&D(t)){D(t).style.visibility=r}else{G("#"+t,"visibility:"+r)}}function J(i){var r=/[\\\"<>\.;]/;var a=r.exec(i)!=null;return a&&typeof encodeURIComponent!=t?encodeURIComponent(i):i}var X=function(){if(S.ie&&S.win){window.attachEvent("onunload",function(){var t=h.length;for(var i=0;i<t;i++){h[i][0].detachEvent(h[i][1],h[i][2])}var r=_.length;for(var a=0;a<r;a++){P(_[a])}for(var s in S){S[s]=null}S=null;for(var n in audioplayer_swfobject){audioplayer_swfobject[n]=null}audioplayer_swfobject=null})}}();return{registerObject:function(t,i,r,a){if(S.w3&&t&&i){var s={};s.id=t;s.swfVersion=i;s.expressInstall=r;s.callbackFn=a;p[p.length]=s;Y(t,false)}else if(a){a({success:false,id:t})}},getObjectById:function(t){if(S.w3){return q(t)}},embedSWF:function(r,a,s,n,o,l,d,c,u,f){var p={success:false,id:a};if(S.w3&&!(S.wk&&S.wk<312)&&r&&a&&s&&n&&o){Y(a,false);z(function(){s+="";n+="";var _={};if(u&&typeof u===i){for(var h in u){_[h]=u[h]}}_.data=r;_.width=s;_.height=n;var m={};if(c&&typeof c===i){for(var g in c){m[g]=c[g]}}if(d&&typeof d===i){for(var v in d){if(typeof m.flashvars!=t){m.flashvars+="&"+v+"="+d[v]}else{m.flashvars=v+"="+d[v]}}}if(W(o)){var b=L(_,m,a);if(_.id==a){Y(a,true)}p.success=true;p.ref=b}else if(l&&F()){_.data=l;U(_,m,a,f);return}else{Y(a,true)}if(f){f(p)}})}else if(f){f(p)}},switchOffAutoHideShow:function(){A=false},ua:S,getFlashPlayerVersion:function(){return{major:S.pv[0],minor:S.pv[1],release:S.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(t,i,r){if(S.w3){return L(t,i,r)}else{return undefined}},showExpressInstall:function(t,i,r,a){if(S.w3&&F()){U(t,i,r,a)}},removeSWF:function(t){if(S.w3){P(t)}},createCSS:function(t,i,r,a){if(S.w3){G(t,i,r,a)}},addDomLoadEvent:z,addLoadEvent:x,getQueryParamValue:function(t){var i=d.location.search||d.location.hash;if(i){if(/\?/.test(i)){i=i.split("?")[1]}if(t==null){return J(i)}var r=i.split("&");for(var a=0;a<r.length;a++){if(r[a].substring(0,r[a].indexOf("="))==t){return J(r[a].substring(r[a].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(y){var t=D(n);if(t&&m){t.parentNode.replaceChild(m,t);if(g){Y(g,true);if(S.ie&&S.win){m.style.display="block"}}if(v){v(b)}}y=false}}}}();var AudioPlayer=function(){var t=[];var i={};var r={};var a="";var s={};var n=-1;var o="9";function l(t){if(document.all&&!window[t]){for(var i=0;i<document.forms.length;i++){if(document.forms[i][t]){return document.forms[i][t];break}}}return document.all?window[t]:document[t]}function d(t,i,r){l(t).addListener(i,r)}return{setup:function(t,i){a=t;s=i;if(audioplayer_swfobject.hasFlashPlayerVersion(o)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(t){return l(t)},addListener:function(t,i,r){d(t,i,r)},embed:function(r,n){var l={};var d;var c={};var u={};var f={};for(d in s){l[d]=s[d]}for(d in n){l[d]=n[d]}if(l.transparentpagebg=="yes"){c.bgcolor="#FFFFFF";c.wmode="transparent"}else{if(l.pagebg){c.bgcolor="#"+l.pagebg}c.wmode="opaque"}c.menu="false";for(d in l){if(d=="pagebg"||d=="width"||d=="transparentpagebg"){continue}u[d]=l[d]}f.name=r;f.style="outline: none";u.playerID=r;audioplayer_swfobject.embedSWF(a,r,l.width.toString(),"24",o,false,u,c,f);t.push(r);if(n.group){i[r]=n.group}},syncVolumes:function(r,a){if(i[r])return;n=a;for(var s=0;s<t.length;s++){if(!i[t[s]]&&t[s]!=r){l(t[s]).setVolume(n)}}},activate:function(t,a){for(var s in r){if(s==t){continue}if(i[t]!=i[s]){this.close(s);continue}if(!(i[t]||i[s])){this.close(s)}}r[t]=1},load:function(t,i,r,a){l(t).load(i,r,a)},close:function(t){l(t).close();if(t in r){delete r[t]}},open:function(t,i){if(i==undefined){i=1}l(t).open(i==undefined?0:i-1)},getVolume:function(t){return n}}}();var BF_GplusSignin=function(){this.callback=function(t){if(!t["status"]["signed_in"]){return}else if(t["status"]["signed_in"]){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:t["code"]},onSuccess:function(t){gplus._result(t)},onFailure:function(t){return}})}};this._result=function(t){var i=JSON.parse(t.responseText),r=new BF_User,a=BF_STATIC.language||"en",s,n;if(i.username.match("[^A-Za-z0-9]"))i.username=i.username.replace(i.username.match("[^A-Za-z0-9]")[0],"");if(!r.isLoggedIn()&&i.login=="false"&&i.username&&i.password){n={name:i.username,username:i.username.replace(/\W/g,""),pw:i.password,email:i.email,contribute:"1",allow_email_updates:"1",googleplus_uid:i.googleplus_uid,import_fb_profile:"false",language:i.language||a,googleplus_image:i.googleplus_image,display_name:i.display_name};bf_register.new_register(n)}else if(i.login=="true"){gplus.login(i)}};this.login=function(t){if(t&&t.username){BFW_Util.saveEarnedReactions({value:t});bf_login.cookieLogin()}}};var BF_UserSwitcher={controller:"/buzzfeed/_switch",template:'<li><a href="" onclick="return false" class="switch-to-user" rel:id="#{id}"><div class="default_user #{default_div}"><svg width="25" height="25" viewbox="0 0 512 512"><use xlink:href="#icon-user-avatar"></use></svg></div><img src="#{root}#{image}" class="#{user_img}"/>#{display_name}</a></li>',template_bottom_div:'<li class="#{hl}"><a href="" onclick="return false" rel:username="#{username}"><span class="list-username" rel:username="#{username}">#{username}</span> #{display_name}</a><span class="hl chosen"></span></li>',latest_switch_list:[],latest_switch_list_loaded:false,was_ajax:false,switcher:null,bottom_warning_div:null,bottom_warning_select:null,is_user_switcher:false,selected_user:null,init:function(t){try{if(!acl.user_can("general_admin"))return false;if(t!=null)BF_UserSwitcher.selected_user=t;if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.apply_visibility();return false}BF_UserSwitcher.switcher=$("quickpost-user-switcher");if(BF_UserSwitcher.switcher)BF_UserSwitcher.is_user_switcher=true;BF_UserSwitcher.apply_visibility();if(acl.user_can("general_admin")){BF_UserSwitcher._switch_list_ui([""],"bottom");universal_dom.get_bucket_elements("switch_users").each(function(t){var i=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.observe("click",function(){if(i.style.display=="block")return false;i.style.display="block";universal_dom.get_bucket_elements("switch_user_dialog").each(function(t){t.update("Loading...")});BF_UserSwitcher.getSwitchList(BF_UserSwitcher._switch_list_ui,"bottom",true)});Event.observe(window,"click",function(e){if(!$(e.target).childOf||!$(e.target).childOf(BF_UserSwitcher.switcher)){i.style.display="none"}})})}}catch(e){console.error(e)}},apply_visibility:function(){try{if(!BF_UserSwitcher.is_user_switcher)return false;var t=(new BF_User).getUserInfo();if(BF_UserSwitcher.selected_user==null){if(typeof edit_post!="undefined"){BF_UserSwitcher.selected_user=edit_post.buzz.username}else{BF_UserSwitcher.selected_user=t.username;$$(".switched-display_name").each(function(i){if(i.hasClassName("bottom_display_name"))i.update(t.display_name)})}}if(acl.user_can("general_admin")){var i;if(typeof edit_post!="undefined")i=edit_post.buzz.username;else i=t.default_user.username}else{BF_UserSwitcher.switcher.style.display="none"}}catch(e){console.error(e)}},sw_bottom_div:function(e){try{e.stop();var t=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.select("li a").each(function(t){if(e.target==t||e.target.parentNode==t){BF_UserSwitcher.selected_user=t.getAttribute("rel:username");t.parentNode.addClassName("hl");superlist_bylines.set_add_bylines(BF_UserSwitcher.selected_user,true);universal_dom.get_bucket_elements("switch_user_dialog")[0].hide()}else t.parentNode.removeClassName("hl")});BF_UserSwitcher.apply_visibility()}catch(e){console.error(e)}},fill_switch_div:function(t){try{if(!BF_UserSwitcher.is_user_switcher)return false;var i=new Template(BF_UserSwitcher.template_bottom_div);var r="<ul>";var a=(new BF_User).getUserInfo();u=a.default_user;t.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:u.image,userid:u.userid});if(typeof edit_post!="undefined")t.unshift({display_name:decodeURIComponent(edit_post.buzz.user_displayname.unescapeHTML()),not_user:true,username:edit_post.buzz.username,image:edit_post.buzz.user_image,userid:edit_post.buzz.userid});t.each(function(t){if(t.p_disable_quickpost=="1")return false;if(typeof edit_post!="undefined"&&t.username==edit_post.buzz.username&&!t.not_user)return false;var a=BF_UserSwitcher.selected_user==t.username?true:false;r+=i.evaluate({display_name:t.display_name,username:t.username,hl:a?"hl":""})});var t=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.update(r+"</ul>");t.select("ul a").each(function(t){t.observe("click",BF_UserSwitcher.sw_bottom_div)})}catch(e){console.error(e)}},switch_callback:function(){try{var t=(new BF_User).getUserInfo();if(typeof edit_post=="undefined"){if(BF_UserSwitcher.is_user_switcher)BF_UserSwitcher.selected_user=t.username;$$(".switched-display_name").each(function(i){i.update(t.display_name)})}else{$$(".switched-display_name").each(function(i){if(!i.hasClassName("bottom_display_name"))i.update(t.display_name)})}if(t.p_disable_quickpost=="true"){BF_Request.location({reload_track:true});return false}if(BF_UserSwitcher.is_user_switcher){var i=BF_UserSwitcher.switcher.select(".switch_user_list")[0];i.style.display="none";BF_UserSwitcher.apply_visibility()}}catch(e){console.error(e)}},swfunction:function(e){try{e.stop();var t=e.target.getAttribute("rel:id");BF_UserSwitcher.switchTo(t,BF_UserSwitcher.switch_callback)}catch(e){console.error(e)}},switch_list_ui:function(e){try{if(typeof e.stop!=="boolean")e.stop();if($("switch-list-spinner"))$("switch-list-spinner").show();this.getSwitchList(BF_UserSwitcher._switch_list_ui,"top")}catch(e){console.error(e)}},_switch_list_ui:function(t,i,r){if(!$("usernav-switch-list"))return;try{if(r&&BF_UserSwitcher.is_user_switcher){var a=t.slice(0);BF_UserSwitcher.fill_switch_div(a)}var s=(new BF_User).getUserInfo();var n=new Template(BF_UserSwitcher.template);var o='<a class="close_switch_list_ui" href="javascript:;" onclick="BF_UserSwitcher.hide_switch_list_ui();return false;"><div class="closeBtn">x</div></a><ul>';var l=typeof s.default_user.image=="undefined"||s.default_user_image==null?"":s.default_user.image;var d=l==null||l==""?"":"hidden";var c=l==null||l==""?"hidden":"";t.unshift({image:decodeURIComponent(l.unescapeHTML()),display_name:decodeURIComponent(s.default_user.display_name.unescapeHTML()),userid:s.default_user.userid});t.each(function(t){if(typeof t.image=="undefined"||t.image==""||t.image==null){d="";c="hidden"}else{d="hidden";c=""}o+=n.evaluate({image:t.image||trans_gif_1x1_base64,display_name:t.display_name,id:t.userid,root:BF_STATIC.image_root,default_div:d,user_img:c})});if(s.p_alias=="true"||typeof s.default_user!="undefined"&&s.default_user.p_alias=="true"){o+='<li><a href="'+BF_STATIC.web_root+'/signup"><span class="microsite-new logo">+ </br></span><span class="microsite-new text"><i>Create Another BuzzFeed</i></span></a></li>'}$("usernav-switch-list").update(o+"</ul>");if(i=="top"){$("usernav-switch-list").show();if($("switch-list-spinner"))$("switch-list-spinner").hide()}$$(".switch-to-user").each(function(t){t.observe("click",BF_UserSwitcher.swfunction)});$$(".switched-display_name").each(function(t){if(!t.hasClassName("bottom_display_name"))t.update(s.display_name)});BF_UserSwitcher.apply_visibility()}catch(e){console.error(e)}},hide_switch_list_ui:function(){$("usernav-switch-list").hide()},switchTo:function(t,i){try{var r=new BF_User;if(r.isLoggedIn()){var a=r.getUserInfo();if(typeof a.default_user!="undefined"){if(a.userid==t){$("usernav-switch-list").hide();if($("switch-list-spinner"))$("switch-list-spinner").hide()}else{$("usernav-switch-list").hide();if($("switch-list-spinner"))$("switch-list-spinner").show();var s=new BF_Request;s.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch",default_username:a.default_user.username,switch_id:t},onSuccess:function(t){BF_UserSwitcher._switchTo(t,i)}})}}}}catch(e){console.error(e)}},_switchTo:function(t,i){try{var r={};if(window.location.href.match("/signup")){r={no_reload:true}}bf_login.loggedIn(t,r);i();if($("switch-list-spinner"))$("switch-list-spinner").hide()}catch(e){console.error(e)}},getSwitchListFor:function(t,i){try{if(!acl.user_can("edit_user_accounts"))return;var r=new BF_Request;r.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list_for",username:t},onSuccess:function(t){BF_UserSwitcher._getSwitchList(t.responseText,i)}})}catch(e){console.error(e)}},getSwitchList:function(t,i,r){try{if(BF_UserSwitcher.was_ajax){var a=BF_UserSwitcher.latest_switch_list;a.shift();a=JSON.stringify(a);BF_UserSwitcher._getSwitchList('{"success" : 1, "switch_list" :'+a+"}",t,i,r)}else{if(typeof r=="undefined")r=false;var s=new BF_User;if(s.isLoggedIn()){var n=s.getUserInfo();if(typeof n.default_user!="undefined"){var o=new BF_Request;o.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list",default_username:n.default_user.username},onSuccess:function(a){BF_UserSwitcher._getSwitchList(a.responseText,t,i,r);BF_UserSwitcher.was_ajax=true},on401:function(){console.warn("Insufficient Permissions")}})}}}}catch(e){console.error(e)}},_getSwitchList:function(t,i,r,a){try{if(i==undefined)return false;var s=JSON.parse(t);if(s.success=="1"){BF_UserSwitcher.latest_switch_list=s.switch_list.slice(0);var n=(new BF_User).getUserInfo();u=n.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:decodeURIComponent(u.image.unescapeHTML()),userid:u.userid});BF_UserSwitcher.latest_switch_list_loaded=true;i(s.switch_list,r,a)}}catch(e){console.error(e)}},show_warning:function(){try{var t=new BF_User;if(t.isLoggedIn()){var i=t.getUserInfo();if(!window.location.pathname.match("/dashboard$")&&typeof i.default_user!="undefined"&&i.default_user.username!=i.username){$$(".switched-display_name").each(function(t){t.update(i.display_name)});$$(".switch-warning").each(function(t){t.show()})}else{$$(".switch-warning").each(function(t){t.hide()})}}}catch(e){console.error(e)}},_getSwitchList:function(t,i,r,a){if(i==undefined)return false;var s=JSON.parse(t);if(s.success=="1"){if(typeof s.switch_list.users!=="undefined"){BF_UserSwitcher.latest_switch_list=s.switch_list.users.slice(0)}else{BF_UserSwitcher.latest_switch_list=s.switch_list.slice(0)}var n=(new BF_User).getUserInfo();u=n.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:unescape(u.display_name),username:unescape(u.username),userid:unescape(u.userid)});BF_UserSwitcher.latest_switch_list_loaded=true;i(s.switch_list,r,a)}},disable_private_fields:function(){try{var t=new BF_User;if(t.isLoggedIn()){var i=t.getUserInfo();if(typeof i.default_user!="undefined"&&i.default_user.username!=i.username){var r=["user-settings-button"];r.each(function(t){if($(t))$(t).style.display="none"})}}}catch(e){console.error(e)}},create_alias_for:function(t,i){if(typeof t.username=="undefined"||typeof t.alias_username=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},i);return}if(!acl.user_can("edit_user_accounts"))return;(new BF_Request).request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias_for",username:t.username,alias_username:t.alias_username},onSuccess:function(t){BF_UserSwitcher._create_alias(t,i)},onFailure:function(t){BF_UserSwitcher._create_alias(t,i)}})},create_alias:function(t,i){if(typeof t.username=="undefined"||typeof t.display_name=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},i);return}var r=new BF_User;if(r.isLoggedIn()){var a=r.getUserInfo();if(typeof a.default_user!="undefined"){var s=new BF_Request;if(t.self_serve==1){s.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:t.username,display_name:t.display_name,default_username:a.default_user.username,self_serve:1},onSuccess:function(r){BF_UserSwitcher._create_alias(r,t.username,i)},onFailure:function(r){BF_UserSwitcher._create_alias(r,t.username,i)}})}else{s.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:t.username,display_name:t.display_name,default_username:a.default_user.username},onSuccess:function(t){BF_UserSwitcher._create_alias(t,i)},onFailure:function(t){BF_UserSwitcher._create_alias(t,i)}})}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Insufficient privileges"})},i)}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"User not logged in"})},i)}},_create_alias:function(t,i){var r=JSON.parse(t.responseText);r.status=t.status;i(r)},count_aliases:function(t){var i=new BF_User;if(i.isLoggedIn()){var r=i.getUserInfo();if(typeof r.default_user!="undefined"){var a=new BF_Request;a.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"count_aliases",default_username:r.default_user.username},onComplete:function(i){BF_UserSwitcher._count_aliases(i,t)}})}}},_count_aliases:function(t,i){var r=JSON.parse(t.responseText);r.status=t.status;i(r)}};if(typeof edit_post=="undefined")BuzzLoader.register(BF_UserSwitcher.init,1);bf_badge_vote_manager=function(){var t=this;this.VOTE_CONTROLLER="/buzzfeed/_badge_vote";this.VOTE_DEFINITIONS={badge:{onSuccess:function(t){badge_vote_manager.voting=false;badge_vote_manager.badgeResponse(t)},onFailure:function(t){badge_vote_manager.voting=false;badge_vote_manager.failureResponse(t)},parameters:{badge_id:function(t){if(t.className.match(/bf_dom/)){var i=JSON.parse(t.getAttribute("rel:data"));return i.vote.badge_id}else return t.getAttribute("rel:badge_id")}}},love_or_hate:{onSuccess:function(t){badge_vote_manager.voting=false;badge_vote_manager.loveHateResponse(t)},onFailure:function(t){badge_vote_manager.voting=false;badge_vote_manager.failureResponse(t)},parameters:{value:function(t){if(t.className.match(/bf_dom/)){var i=JSON.parse(t.getAttribute("rel:data"));return i.vote.value=="loves"?1:0}else return t.getAttribute("rel:value")=="loves"?1:0}}}};this.initialized=false;this.initialization=false;this.voting=false;this.badgeResponse=function(t){var i=JSON.parse(t.responseText);if($("spinner-badge"))$("spinner-badge").hide();if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(i.success){BFW_Util.updateInfoCookie({last_active:i.last_active});if(!!window.fb_app){fb_app.badge_vote_success(i)}else{var r=$(i.element_id);var a=r;var s=r.getAttribute("rel:category");while(a.parentNode&&!a.getAttribute("rel:buzz_id"))a=a.parentNode;Event.stopObserving(r,"click",badge_vote_manager.vote);r.removeAttribute("href");$(r).up("li").addClassName("voted");if(i.already_voted){if(BF_STATIC.tt_page!="Video"){return badge_vote_manager._already_voted(i)}}if(BF_STATIC.tt_page!="Video"){badge_vote_manager.show_reaction_share_box(r.getAttribute("rel:badge_name"),r.getAttribute("rel:message"))}var n=new BF_User;var o=badge_vote_manager.VOTE_DEFINITIONS[s];var l=o.success_template;var d={username:n.getUserInfo().username,display_name:n.getUserInfo().display_name,title:decodeURIComponent(a.getAttribute("rel:buzz_title")),uri:a.getAttribute("rel:buzz_uri"),badge:r.getAttribute("rel:badge_name")};if(BF_STATIC.tt_page!="Video"){badge_vote_manager._hide_social_messages();if(r.getAttribute("rel:message"))$("badge-message").update(unescape(r.getAttribute("rel:message")));if($("social_message")){$("social_message").show();var c=$("social_message").select("a")[0];if(c)c.setAttribute("target","_none")}if($("number_of_contribs_header"))$("number_of_contribs_header").show();this._update_reaction_count(r.getAttribute("rel:badge_id"));if(typeof i.earned_reactions!="undefined"){BFW_Util.updateInfoCookie({earned_reactions:i.earned_reactions})}}gtrack.trackShares(23,"numReactions_"+d.badge.toLowerCase());gtrack.track_events("[ttp]","react/"+d.badge.toLowerCase(),"");EventManager.fire("badge_vote:success",d.badge)}}else{}};this.failureResponse=function(i){if(i.status===401){BF_Request.debug_log(i.request.url);BF_LOGIN_SIGNUP.show({locationName:"reaction",onSuccessLoginCb:function(){BF_LOGIN_SIGNUP.updateUserNav();t.initialized=true;t.vote_by_id(target.up("li").id)}.bind(this)})}else{(new BF_Request).alert(local.t("Sorry, there was a problem processing your request. If it persists please contact support at")+" "+BF_STATIC.web_root+"/about/contact")}};this.loveHateResponse=function(t){var i=JSON.parse(t.responseText);if($("spinner-love_or_hate"))$("spinner-love_or_hate").hide();if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(i.success&&i.element_id){BFW_Util.updateInfoCookie({last_active:i.last_active});var r=$(i.element_id);if(r.parentNode.id.match(/(love|hate)_button-\d+/)){$(r.parentNode).show()}var a=r;while(a.parentNode&&!a.getAttribute("rel:buzz_id"))a=a.parentNode;Event.stopObserving(r,"click",badge_vote_manager.vote);r.removeAttribute("href");if(r.parentNode.nodeName=="LI")$(r.parentNode).addClassName("voted");else if(r.parentNode.nodeName=="A")$(r.parentNode).up().addClassName("voted");if(i.already_voted)return badge_vote_manager._already_voted(i);var s=new BF_User;var n=r.getAttribute("rel:category");var o=badge_vote_manager.VOTE_DEFINITIONS[n];var l=o.success_template;var d={display_name:s.getUserInfo().display_name,title:decodeURIComponent(a.getAttribute("rel:buzz_title")),uri:a.getAttribute("rel:buzz_uri"),loves:r.getAttribute("rel:value")};var c=d.loves=="loves"?"feed-love":"feed-hate";badge_vote_manager._hide_social_messages();if(!badge_vote_manager.is_contribution(r)){var u=d.loves.match(/love/)?"love":"hate";badge_vote_manager.show_reaction_share_box(u);if($("number_of_contribs_header"))$("number_of_contribs_header").show();this._update_reaction_count(u)}else{var f=$("social_message-"+a.getAttribute("rel:buzz_id"));var p=d.loves=="loves"?local.t("Yeah!"):local.t("Awww");f.update(p);f.show()}}else{}};this._already_voted=function(t){badge_vote_manager._hide_social_messages();if($("share-reaction-box"))$("share-reaction-box").hide();var i=$(t.element_id);if(badge_vote_manager.is_contribution(i)){var r=i;while(r.parentNode&&!r.getAttribute("rel:buzz_id"))r=r.parentNode;var a=$("social_message-"+r.getAttribute("rel:buzz_id"));if(a){a.update(local.t("Okay!"));a.style.width="100%";a.show()}}else{$("social_message-already-voted").show()}};this._exceeded_maximum_badge_votes=function(){if(typeof fb_app=="undefined"){var t=$$(".vote-badge");for(var i=0;i<t.length;i++){Event.stopObserving(t[i],"click",badge_vote_manager.vote);t[i].observe("click",badge_vote_manager._show_vote_exceeded)}badge_vote_manager._show_vote_exceeded()}else{if($("badge_vote_msg"))$("badge_vote_msg").update("<h4>"+local.t("Sorry")+"</h4>, <p>"+local.t("you can only react up to three times")+'.<p> <a href="javascript:;" onclick="javascript:$(\'badge_vote_msg\').hide()" class="close">&times;</a>');if(typeof fb_app.error_msg_timeout!="undefined")clearTimeout(fb_app.error_msg_timeout);fb_app.error_msg_timeout=setTimeout("Effect.Fade('badge_vote_msg',{'duration':2.0})",3e3)}};this._show_vote_exceeded=function(e){if(typeof e!="undefined")e.stop();badge_vote_manager._hide_social_messages();if($("social_message-badge-votecount-exceeded"))$("social_message-badge-votecount-exceeded").show()};this._hide_social_messages=function(){if($("social_message-badge-votecount-exceeded"))$("social_message-badge-votecount-exceeded").hide();if($("social_message-already-voted"))$("social_message-already-voted").hide();if($("social_message"))$("social_message").hide();if($("social_message-loves"))$("social_message-loves").hide();if($("social_message-hates"))$("social_message-hates").hide()};this.init=function(){
if(badge_vote_manager.initialized){return false}if(badge_vote_manager.initialization){setTimeout(this.init.bind(this,args),300)}badge_vote_manager.initialization=true;try{bf_login.init();this.ajax=new BF_Request;if($("badge_voting")&&BF_STATIC.tt_page!="Video"){var t=$("badge_voting").getElementsByTagName("UL")[0];badge_vote_manager.earned_reactions_buttons(t)}var i=new BF_User;$$(".add-pick").each(function(t){if(i.isLoggedIn()){t.removeClassName("hidden");t.up().removeClassName("hidden")}else{t.addClassName("hidden");t.up().addClassName("hidden")}});var r=i.getUserInfo();if(r&&typeof r.p_disable_reaction!="undefined"&&r.p_disable_reaction=="true"){$$("#lovehate_buttons, #badge_voting, .lovehate-buttons").each(function(t){t.style.visibility="hidden"})}else{for(var a in badge_vote_manager.VOTE_DEFINITIONS){var s=$$(".vote-"+a);for(var n=0;n<s.length;n++){var o=s[n];if(o.className.match(/bf_dom/))continue;o.setAttribute("rel:category",a);if(!o.id){o.id="vote-"+a+"-"+parseInt(Math.random()*1e7)}o.observe("click",badge_vote_manager.vote)}}}var l=$("filter-show_everything");if(l){l.observe("click",function(e){e.stop();if($("contribution-list"))$("contribution-list").show();$(e.target.parentNode).addClassName("current")})}var d=$$(".contrib");for(var n=0;n<d.length;n++){var c=d[n].getAttribute("rel:buzz_id");if(c){d[n].observe("mouseout",function(e){var t=e.target;while(t.parentNode&&!t.getAttribute("rel:buzz_id"))t=t.parentNode;var i=t.getAttribute("rel:buzz_id");var r="tools-"+i;if($(r)){$(r).removeClassName("selected_tools")}});d[n].observe("mouseover",function(e){var t=e.target;while(t.parentNode&&!t.getAttribute("rel:buzz_id"))t=t.parentNode;var i=t.getAttribute("rel:buzz_id");var r="tools-"+i;if($(r)){$(r).addClassName("selected_tools")}})}}badge_vote_manager.initialized=true}catch(e){console.error(e);badge_vote_manager.initialization=false}};this.reset_sharing_box=function(){if($("social-sharing-box")){$("sharing-message").value="";$("sharing-box-caption").update("");$("sharing-box-submit").value=local.t("Post to Facebook");$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}if($("share-reaction-box")){$("reaction-sharing-message").value="";$("reaction-share-submit").value=local.t("Share Link");$("reaction-share-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}};this.show_reaction_share_box=function(t,i){if($("share-reaction-box")){$("share-reaction-box").show();$("reaction-sharing-message").value="";if($("share-reaction-success-wrapper").visible()){$("share-reaction-success-wrapper").hide()}if(!$("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-content-wrapper")}$("reaction-share-submit").observe("click",badge_vote_manager.sharing_box_handler);if(typeof bf_rdio=="object"){var r=bf_rdio.fetch_rdio_buzz(t.toLowerCase());if(r&&$("share-reaction-box_title")){var a="I know, right? Now check out the Rdio"+" <span class='react_box'>"+t+"</span> playlist <a onClick=\"trackPixel('https://ad.doubleclick.net/clk;267621454;93691579;z');\" href='http://buzzfeed.com"+r+"'>"+local.t("HERE")+"</a>";$("share-reaction-box_title").innerHTML=a}}["Nom Nom"].each(function(r){if(r==t&&i){$("share-reaction-box_title").innerHTML=unescape(i)}})}};this.show_sharing_box=function(t,i){if($("social-sharing-box")){var r=$("social-sharing-box");var a=badge_vote_manager.find_position(t);if(typeof a=="undefined")return;var s=parseInt(a[0]);var n=t.getAttribute("rel:category");var o=n&&n=="badge"?parseInt(a[1])+7:parseInt(a[1])-1;var l=$(t.getAttribute("id"));var d=parseInt(l.getWidth());var c=parseInt(r.getWidth());var u=300;var f=s<c/2-d/2?10:s-(c/2-d/2);r.setStyle({top:o+35+"px",left:f+"px"});var p=10;var _=s<c/2-d/2?s-10+d/2:c/2;_=_-10;$("arrowBorder").setStyle({top:-p+"px",left:_+"px",borderBottom:p+"px solid #444"});$("arrowFill").setStyle({top:-p+2+"px",left:_+"px",borderBottom:p+"px solid #F2F2F2"});if(typeof i!="undefined"&&i=="fbtl"){$("sharing-box-caption").update(local.t("Add a message?"));$("sharing-box-submit").value=local.t("Add A Message");$("sharing-box-submit").observe("click",fbtl_session.add_message)}else{$("sharing-box-caption").update(local.t("I know, right? Will your friends agree?"));var h=t.getAttribute("rel:badge_name")?t.getAttribute("rel:badge_name")+"!":"";$("sharing-message").value=h;$("sharing-box-submit").observe("click",badge_vote_manager.sharing_box_handler)}r.show()}};this.find_position=function(t){var i=curtop=0;if(t.offsetParent){do{i+=t.offsetLeft;curtop+=t.offsetTop}while(t=t.offsetParent);return[i,curtop]}};this.sharing_box_handler=function(e){var t="";var i=document.getElementsByTagName("meta");var r=["image","title","description","url"];var a={};if(objExists(e.target.id)){if(e.target.id="reaction-share-submit"){t=$("reaction-sharing-message").value}else if(e.target.id="sharing-box-submit"){t=$("sharing-message").value}}for(var s=0;s<i.length;s++){for(var n=0;n<r.length;n++){var o="og:"+r[n];if(i[s].getAttribute("property")==o)a[r[n]+""]=i[s].getAttribute("content")}}if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled&&!BF_STATIC.mobile_app){a.url=pound.urls.unescaped.hashAndQueryString()}var l={};l["description"]=a.description;l["name"]=a.title;l["link"]=a.url;l["picture"]=a.image;l["message"]=t;facebook.publish_to_stream(l,function(){if($("social-sharing-box").visible()){$("social-sharing-box").hide()}if($("share-reaction-box")){if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideUp("share-reaction-content-wrapper")}if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-success-wrapper")}}})};this.show_social_icons=function(){if(typeof ActiveHistory=="undefined")return;ActiveHistory.observe("visited:digg",function(){if($("share_digg_button"))$("share_digg_button").show()});ActiveHistory.observe("visited:twitter",function(){if($("share_twitter_button"))$("share_twitter_button").show()});ActiveHistory.observe("visited:reddit",function(){if($("share_reddit_button"))$("share_reddit_button").show()});ActiveHistory.observe("visited:stumbleupon",function(){if($("share_stumbleupon_button"))$("share_stumbleupon_button").show()});ActiveHistory.observe("visited:delicious",function(){if($("share_delicious_button"))$("share_delicious_button").show()});ActiveHistory.observe("visited:fark",function(){if($("share_fark_button"))$("share_fark_button").show()})};this.vote=function(e){e.stop();if(badge_vote_manager.voting==true)return;var i=new BF_User;var r;if(e.target.nodeName=="SPAN")r=e.target.up();else r=e.target;if(typeof fb_app!="undefined"){var a=r.getAttribute("rel:badge_name");fb_app.show_bubble(a);if(!fb_app.session||!fb_app.bf_user_info){fb_app.log_into_buzzfeed()}else{badge_vote_manager._vote(r)}}else if(i.isLoggedIn()){var s=readCookie("fb-vote-prompt");r.up(".contrib")?badge_vote_manager._comment_vote(r):badge_vote_manager._vote(r)}else{BF_LOGIN_SIGNUP.show({locationName:"reaction",onSuccessLoginCb:function(){BF_LOGIN_SIGNUP.updateUserNav();t.initialized=true;t.vote_by_id(r.up("li").id)}.bind(this)})}EventManager.fire("badge_vote:vote_init",r.getAttribute("rel:badge_name"))};this.vote_by_id=function(t){var i=typeof universal_dom!="undefined"&&badge_vote_manager.initialized&&$$("#"+t+" a").length;if(i){var r=$$("#"+t+" a")[0].fire("click");badge_vote_manager.vote(r)}else setTimeout(badge_vote_manager.vote_by_id.bind(this,t),500)};this._comment_vote=function(t){var i=t.getAttribute("rel:category");if(!i){if(t.up("a")){t=t.up("a");i=t.getAttribute("rel:category");if(!i)return}}Event.stopObserving(t,"click",badge_vote_manager.vote);var r=t.up(".contrib").getAttribute("rel:comment_id");var a=t.getAttribute("rel:value");var s={action:"comment_vote",comment_id:r,badge_name:a};var n=new BF_Request;n.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:s,onFailure:badge_vote_manager.failureResponse});var o=parseInt(t.down(".count").innerHTML);if(o>=0){t.down(".count").innerHTML=o+1}};this._vote=function(t){var i=t.getAttribute("rel:category");if(!i)return;var r=t;while(r.parentNode&&!r.getAttribute("rel:buzz_id"))r=r.parentNode;var a=r.getAttribute("rel:buzz_id");if(i=="badge"){if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={};_badge_votes_so_far[a]={}}else if(typeof _badge_votes_so_far[a]=="undefined"){_badge_votes_so_far[a]={}}var s=new BF_User;var n=s.getUserInfo();if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+a][n.username]=="undefined"){_badge_votes_so_far[""+a][n.username]=1}else{if(_badge_votes_so_far[""+a][n.username]>=3){return badge_vote_manager._exceeded_maximum_badge_votes()}else{_badge_votes_so_far[""+a][n.username]+=1}}}}if(badge_vote_manager.is_contribution(t)){$("love_button-"+r.getAttribute("rel:buzz_id")).hide();$("hate_button-"+r.getAttribute("rel:buzz_id")).hide();$("social_message-"+r.getAttribute("rel:buzz_id")).hide();badge_vote_manager._spinner=$("spinner-"+r.getAttribute("rel:buzz_id"));$(badge_vote_manager._spinner).style.width="100%";$(badge_vote_manager._spinner).show()}else if($("spinner-"+i)){$("spinner-"+i).show()}var o=this.VOTE_DEFINITIONS[i];if(!o)return;bf_reactions.grow_up_css(t);var l={action:"vote",element_id:t.id,category:i,uri:"/"+r.getAttribute("rel:buzz_uri"),buzz_id:r.getAttribute("rel:buzz_id")};for(var d in o.parameters){l[d]=o.parameters[d](t)}badge_vote_manager.voting=true;var c=new BF_Request;c.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:l,onSuccess:o.onSuccess,onFailure:o.onFailure});if(i=="badge"&&t.getAttribute("rel:badge_type")!="earned"){if(typeof _badge_votes_so_far=="undefined"||_badge_votes_so_far[""+a][n.username]<2){var u="react";var f=window.location.toString().replace(/\?.*/i,"");if(BF_STATIC.bf_env!="live"){f=f.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var p=t.getAttribute("rel:badge_uri");var _={article:f,badge:"http://www.buzzfeed.com/badge/"+p};try{if(typeof FB!="undefined")fbtl_session.trigger(u,_)}catch(e){console.error(e)}}}(new BF_Targetting_Pixel).add("badge_reaction")};this.simple_love_vote=function(t,i){var r=this.VOTE_DEFINITIONS["love_or_hate"];var a={action:"vote",buzz_id:i,category:"love_or_hate",uri:t,value:1};var s=new BF_Request;s.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:a,onSuccess:r.onSuccess,onFailure:r.onFailure})};this.is_contribution=function(t){var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id"))i=i.parentNode;return i.parentNode.className.match(/contribution-lovehate-buttons/)};this._update_reaction_count=function(t){return false;var i=t+"-reaction-count";var r=$(i).innerHTML.replace(/\s+/g,"");var r=parseInt(r);if(!isNaN(r)){r++;$(i).update(r)}};this.find_parent=function(t,i){if(i.tagName.toLowerCase()==t.toLowerCase())return i;else if(i.parentNode!=null)return badge_vote_manager.find_parent(t,i.parentNode);else return console.warn("no "+t+" found in DOM")};this.earned_reactions_buttons=function(t){if(local.non_english){return false}try{var i=new Template('<li id="#{name}_button" class="reaction #{name}"> <a id="vote-badge-#{rand}" class="btn-reaction vote-badge" rel:badge_type="earned" rel:badge_name="#{title}" rel:badge_id="#{badge_id}" rel:message="<b>'+local.t("I know, right?")+"</b> <span class=#{infinite}>"+local.t("You have #{remaining_less_one} of these babies left, use #{itslashthem} wisely")+"...</span><span class=#{none_left}>"+local.t("That was your last #{title} reaction. Go earn some more!")+'</span>"> #{title} <span class="earned-remaining">#{remaining}</span></a> <span id="#{badge_id}-reaction-count" class="badge-vote-count zero"></span> </li>');var r=(new BF_User).getUserInfo().earned_reactions;var a=false;if(r&&t){var s=JSON.parse(r);for(var n in s){if(!s.hasOwnProperty(n)||s[n].remaining==0)continue;var o=n.toLowerCase().replace("[^a-zA-Z]","");if(typeof o==="undefined"||o=="")continue;var l={name:o,rand:parseInt(Math.random()*1e3)+(new Date).getTime(),title:n,remaining:s[n].remaining==-1?"":" "+s[n].remaining+"",badge_id:s[n].badge_id};l.remaining_less_one=s[n].remaining-1;l.infinite=l.remaining_less_one<1?"hidden":"";l.none_left=l.remaining_less_one==0?"":"hidden";l.itslashthem=l.remaining_less_one==1?"it":"them";var d=i.evaluate(l);t.insert(d);a=true}if(a){$s(".reactions_container.special").show();$$(".special-reactions").each(function(t){t.show()});var c={el:$s(".reactions_slider.special"),reactions_class:"reaction"};new BF_Reactions_Slider(c)}}}catch(e){console.error(e)}}};badge_vote_manager=new bf_badge_vote_manager;badge_vote_manager.show_social_icons();BuzzLoader.register(function(){badge_vote_manager.init()},6);bf_user_reaction=function(){var t="/buzzfeed/_badge_vote";var i={success_voted:local.t("Thanks for your vote!"),already_voted:"<span>"+local.t("Oops")+".</span> "+local.t("It looks like you've already voted")+".",reaction_count_exceeded:"<span>"+local.t("Sorry")+"</span>, "+local.t("you can only react up to three times")+"."};var r=this;this.init=function(){var t=new BF_User;$$(".user-reaction").each(function(i,a){if(t.isLoggedIn()){i.removeClassName("hide-user-reaction")}i.select(".reaction-btn").each(function(t,i){t.observe("click",r.add_reaction)})});universal_dom.assign_handler({bucket:"fb-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share",handler:bf_user_reaction.buzz_share,event:"click"})};this.buzz_share=function(t){var i=$("user-reaction-social-"+t.id);if(!i){return}var r=encodeURIComponent(i.getAttribute("rel:title"));var a=BF_STATIC.bf_env!="live"?"http://stage.buzzfeed.com/":"http://www.buzzfeed.com/";var s=encodeURIComponent(a+i.getAttribute("rel:link"));var n=encodeURIComponent(BF_STATIC.image_root+i.getAttribute("rel:thumb"));var o="https://twitter.com/intent/tweet?text="+r+"&url="+s;if(BF_STATIC.tt_page="Community")o=o+"&via=buzzfeeders";if(t.element.hasClassName("buzz-facebook-share")){window.open("https://facebook.com/sharer/sharer.php?s=100&p[url]="+s+"&p[title]="+r+"&p[images][0]="+n,"_blank","width=600, height=260")}else if(t.element.hasClassName("buzz-twitter-share")){window.open(o,"_blank","width=600,height=400")}else if(t.element.hasClassName("buzz-pinterest-share")){window.open("https://pinterest.com/pin/create/button/?media="+n+"&url="+s+"&description="+r,"_blank","width=600,height=400")}};this.add_reaction=function(t){var i=t.target;if(i.hasClassName("icon")){i=i.parentNode}var a=r.get_reaction_wrap(i);r.hide_all_reaction_messages(i);var s={action:"vote",element_id:i.id,category:i.getAttribute("rel:category"),buzz_id:a.getAttribute("rel:buzz_id"),uri:"/"+a.getAttribute("rel:buzz_uri")};if(i.getAttribute("rel:category")=="badge"&&!r.is_reaction_available(a.getAttribute("rel:buzz_id"))){r.show_reaction_message(i,"reaction_count_exceeded");return false}if(i.getAttribute("rel:badge_id")){s.badge_id=i.getAttribute("rel:badge_id")}if(i.getAttribute("rel:value")){s.value=i.getAttribute("rel:value")=="loves"?"1":i.getAttribute("rel:value")=="hates"?"0":i.getAttribute("rel:value")}var n=new BF_User;if(!n.isLoggedIn()){console.warn("signin.open is deprecated. Please use BF_LOGIN_SIGNUP.show");return false}r.send_react_request(s);r.show_reaction_loading(i);(new BF_Targetting_Pixel).add("badge_reaction")};this.vote_by_id=function(t){$$("#"+t+" a")[0].scrollIntoView();var i=$$("#"+t+" a")[0].fire("click");bf_user_reaction.add_reaction(i)};this.send_react_request=function(i){var a=new BF_Request;a.request(t,{method:"post",parameters:i,needsToken:true,onSuccess:r.add_reaction_success})};this.is_reaction_available=function(t){var i=new BF_User;var r=i.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[t]=="undefined"){_badge_votes_so_far[t]={}}if(typeof _badge_votes_so_far[t][r.username]=="undefined"){_badge_votes_so_far[t][r.username]=1;return true}else{if(_badge_votes_so_far[t][r.username]>=3){return false}_badge_votes_so_far[t][r.username]+=1;return true}};this.add_reaction_success=function(t){var i=JSON.parse(t.responseText);if(i.success){$(i.element_id).stopObserving("click",r.add_reaction);$(i.element_id).addClassName("already-reacted");r.hide_reaction_loading($(i.element_id));if(i.already_voted){r.show_reaction_message($(i.element_id),"already_voted")}else{r.show_reaction_message($(i.element_id),"success_voted")}}else{}};this.get_reaction_wrap=function(t){var i=t;while(i.parentNode&&!i.hasClassName("user-reaction")){i=i.parentNode}return i};this.show_reaction_loading=function(t){var i=r.get_reaction_wrap(t);if(!i.select(".reaction-loading").length){i.insert('<div class="reaction-loading" style="display:none;">'+local.t("Saving")+"...</div>")}i.select(".reaction-loading")[0].show()};this.hide_reaction_loading=function(t){var i=r.get_reaction_wrap(t);if(i.select(".reaction-loading").length){i.select(".reaction-loading")[0].hide()}};this.show_reaction_message=function(t,a){var s=r.get_reaction_wrap(t);if(!s.select(".reaction-message-"+a).length){s.insert('<div class="reaction-message reaction-message-'+a+'" style="display:none;">'+i[a]+"</div>")}s.select(".reaction-message-"+a)[0].show()};this.hide_all_reaction_messages=function(t){var i=r.get_reaction_wrap(t);if(i.select(".reaction-message").length){i.select(".reaction-message").each(function(t,i){t.hide()})}}};bf_user_reaction=new bf_user_reaction;BuzzLoader.register(function(){bf_user_reaction.init()},2);var BF_MAX_UPLOAD=1024*1024*5;var BF_MAX_UPLOAD_TEXT="5 megabytes";var BF_MAX_UPLOAD_PROFILE=1024*1024*5;var BF_MAX_UPLOAD_PROFILE_TEXT="5 megabyte";var BF_MAX_UPLOAD_COVER=1024*1024*2;var BF_MAX_UPLOAD_COVER_TEXT="2 megabytes";BF_IMAGE_CROPPER=Class.create({template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="btn--buzz btn--buzz--inline hidden">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="btn--buzz btn--buzz--discrete btn--buzz--inline" value="Cancel" /></li>				</ul>			</div>		</div>',preview_template:'<div id="preview" class="preview hidden"></div>',uploader_template:'		<div id="uploader_container">			<p class="upload-desc">Select an image to use for your post. After uploading you\'ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<fieldset>				<div>Thumbnail</div>				<div id="result" class="results"><div class="scroller"><img id="result-image" rel:width="300" rel:height="45" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){},fitToScreen:function(){},initialize:function(t){try{var i=this;this.options={cropper_class:"",fitImageAndScreen:false,showThumbs:true,showPreview:true,showCropper:true,minHeight:null,minWidth:null,enforceMin:false,maxHeight:null,maxWidth:null,enforceMax:false,modalIsParent:false,controller:"/bfcgi/_edit_quickpost_image",action:"imageupload"};Object.extend(this.options,t);this.uploader_params={action:this.options.action};this.regions={"default":false};this.setDefaults();this.container=$(t.container);this.container.update(new Template(this.template).evaluate({cropper_class:this.options.cropper_class,static_root:BF_STATIC.static_root,uploader_template:new Template(this.uploader_template).evaluate({static_root:BF_STATIC.static_root}),preview_template:new Template(this.preview_template).evaluate({static_root:BF_STATIC.static_root}),thumbs_template:new Template(this.thumbs_template).evaluate({static_root:BF_STATIC.static_root})}));if(this.options.modalIsParent)this.container=$(this.container.parentNode);this.uploader_container=$$("#"+this.container.id+" #uploader_container")[0];this.cropper_container=$$("#"+this.container.id+" #cropper_container")[0];this.cropper_instance=null;this.preview_button=$$("#"+this.container.id+" #preview-thumbs")[0];this.approve_button=$$("#"+this.container.id+" #approve-thumbs")[0];this.save_button=$$("#"+this.container.id+" #save-image")[0];this.cancel_button=$$("#"+this.container.id+" #image-cancel")[0];this.uploader_element=$$("#"+this.container.id+" #uploader")[0];this.image_element=$$("#"+this.container.id+" #image")[0];this.preview_button.observe("click",this.preview_image.bind(this));this.approve_button.stopObserving("click");this.approve_button.observe("click",this.approve_image.bind(this));this.save_button.observe("click",this.save_image.bind(this));this.cancel_button.observe("click",this.cancel_image.bind(this));this.error_title="";this.error_message="";this.init_uploader();this.cropper_container.addClassName("hidden");this.uploader_container.select(".upload-error, upload-status").each(function(t){t.addClassName("hidden")});$("uploader").removeClassName("hidden");if(this.options.image_data)this.onComplete(0,t.image_data.image,t.image_data)}catch(e){this.close();alert("Unknown error occured. Please try again later.");console.dir(e);console.trace()}},preview_image:function(){try{this.container.scrollTo();this.container.removeClassName("upload").removeClassName("crop").addClassName("thumbs");this.cropper_container.select(".container")[0].addClassName("hidden");$("thumbs").removeClassName("hidden");if(this.options.showThumbs)this.approve_button.removeClassName("hidden");else this.save_button.removeClassName("hidden");this.preview_button.addClassName("hidden");this.show_thumbs()}catch(t){console.error(t)}},show_thumbs:function(){var t=this;var i=this.image_element;$("result-image").each(function(r){var a=t.regions["default"];r.up(".scroller").style.width=r.getAttribute("rel:width")+"px";r.up(".scroller").style.height=r.getAttribute("rel:height")+"px";var s=r.getAttribute("rel:width")*1;var n=r.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*s/a.width);var l=Math.round(a.left*s/a.width);var d=Math.round(n*a.top/a.height);r.src=i.src;r.style.margin="-"+d+"px 0 0 -"+l+"px";r.style.width=o+"px";var c=r.up("fieldset").select("button")[0];c.stopObserving("click");c.observe("click",function(){$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t))})},approve_image:function(e){},save_image:function(e){},cancel_image:function(e){e.stop()},init_uploader:function(){try{this.uploader=new qq.FileUploader({sendAsForm:true,element:this.uploader_element,action:this.options.controller,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:BF_MAX_UPLOAD,params:this.uploader_params,onValidate:this.onValidate.bind(this),onProgress:this.onProgress.bind(this),onError:this.onError.bind(this),onComplete:this.onComplete.bind(this)})}catch(e){console.error(e)}},check_image:function(t){try{if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="Small image";i.select(".cerror-message")[0].innerHTML=this.error_message="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;return false}return true}catch(e){console.error(e)}},init_cropper:function(){try{this.container.scrollTo();this.cropper_container.select(".container")[0].removeClassName("hidden");if(this.options.showThumbs){this.preview_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}if(this.cropper_instance){this.cropper_instance.remove();delete this.cropper_instance}var t={x1:0,y1:0,x2:this.options.minWidth,y2:this.options.minHeight};var i={autoIncludeCSS:true,displayOnInit:true,onloadCoords:t,ratioDim:{x:this.options.minWidth,y:this.options.minHeight},minWidth:this.options.minWidth,minHeight:this.options.minHeight,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight,onEndCrop:this.crop_done.bind(this),captureKeys:false};if(this.options.ratioDim)i["ratioDim"]=this.options.ratioDim;this.customize_cropper(i);this.cropper_instance=new Cropper.Img(this.image_element,i);if(this.options.fitImageAndScreen)this.fitToScreen();if($(this.container).down("#image")!==this.cropper_instance.img){this.close();(new BF_Request).alert("Error: Unknown error occurred.<br>Please save your work, reload page and try upload image again.")}}catch(r){console.dir(r);console.trace()}},customize_cropper:function(t){try{var i=t.onloadCoords;if(this.regions["default"]){i.x1=this.regions["default"].left;i.y1=this.regions["default"].top;i.x2=this.regions["default"].left+this.regions["default"].width;i.y2=this.regions["default"].top+this.regions["default"].height}t.onloadCoords=i}catch(e){console.error(e)}},crop_default_size:function(){},crop_done:function(t,i){try{this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src}}catch(e){console.error(e)}},onValidate:function(t){try{var i=this.uploader_container.select(".upload-error")[0];if(t.size>BF_MAX_UPLOAD){i.removeClassName("hidden");i.select(".error-title")[0].innerHTML="Too big file";i.select(".cerror-message")[0].innerHTML="Max image upload size is "+BF_MAX_UPLOAD_TEXT}else{$("uploader").addClassName("hidden");i.addClassName("hidden");var r=this.container.select(".upload-status")[0];r.removeClassName("hidden");var r=this.uploader_container.select(".upload-status div.red")[0];r.style.width="0px"}}catch(e){console.error(e)}},onProgress:function(t,i,r,a){try{var s=r;var n=a;var o=Math.round(s/n*100);var l=this.uploader_container.select(".upload-status div.red")[0];l.style.width=this.uploader_container.select(".upload-status div.text")[0].getWidth()/100*o+"px"}catch(e){}},onError:function(t,i,r){$("uploader").removeClassName("hidden");var a="A critical error occurred while trying to upload the picture. Please try again in a few minutes.";if(r)a=r;var s=this.uploader_container.select(".upload-error")[0];s.removeClassName("hidden");s.select(".error-title")[0].innerHTML="Error occured";s.select(".cerror-message")[0].innerHTML=a},onComplete:function(t,i,r){try{this.container.removeClassName("thumbs").removeClassName("upload").addClassName("crop");this.uploader_container.select(".upload-status")[0].addClassName("hidden");this.uploader_element.removeClassName("hidden");this.image_data=r;if(!this.check_image(this.image_data)){if(this.options.callbacks&&this.options.callbacks.image_error)this.options.callbacks.image_error(this.error_title,this.error_message);return false}else{if(r.scale){r.width*=r.scale;r.height*=r.scale;this.options.minWidth*=r.scale;this.options.minHeight*=r.scale}this.uploader_container.addClassName("hidden");this.cropper_container.removeClassName("hidden");var a=this.image_element;if(Prototype.Browser.IE){var s=this;a.onload=function(){setTimeout(function(){s.image_element.onload=null;s.image_element.src=s.image_element.src},500)}}a.src=bf_ir+this.image_data.image+"?"+(new Date).getTime();a.width=this.image_data.width;a.height=this.image_data.height;a.removeClassName("hidden");if(!this.options.showCropper){this.crop_default_size()}else{if(r.crop_data){for(var n in r.crop_data){this.regions[n]=r.crop_data[n];this["manual_"+n]=true}this.preview_image()}else{if(Prototype.Browser.IE){setTimeout(function(){this.init_cropper()}.bind(this),1e3)}else{this.init_cropper()}}}}}catch(e){console.error(e)}},close:function(){BF_UI.closeDialog("user-image-edit");BF_UI.closeDialog("super-image-edit");BF_UI.closeDialog("modal-super-image-edit");if(this.preview_button)this.preview_button.addClassName("hidden");if(this.save_button)this.save_button.addClassName("hidden");if(this.approve_button)this.approve_button.addClassName("hidden")}});BF_SETTINGS_CROPPER=Class.create(BF_IMAGE_CROPPER,{uploader_template:'		<div id="uploader_container">			<div class="upload-title">Upload an Image</div>			<p class="upload-desc">Select an image to use for your profile. After uploading you\'ll be able to crop and resize your image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',preview_template:'		<div id="preview" class="preview">			<div class="scroller"><img id="result-image" rel:width="200" rel:height="200" />&nbsp;</div>		</div>',setDefaults:function(){var t={cropper_class:"settings",showThumbs:false,showPreview:true,showCropper:true,minWidth:200,minHeight:200};if(this.options.origin=="custom_user_header"||this.options.origin=="custom_user_channel_header"||this.options.origin=="bgimage"||this.options.origin=="custom_cover_header")t.showCropper=false;Object.extend(this.options,t);this.uploader_params={action:this.options.action,origin:this.options.origin};BF_MAX_UPLOAD=BF_MAX_UPLOAD_PROFILE;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_PROFILE_TEXT;if(this.options.origin=="custom_cover_header"){BF_MAX_UPLOAD=BF_MAX_UPLOAD_COVER;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_COVER_TEXT}},cancel_image:function(e){this.close()},save_image:function(){var t=this.regions["default"];this.options.callbacks.save_image_callback(this.image_data.image,this.image_data.name,t,null,this.options.origin);this.close()},crop_done:function(t,i){try{this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src};var r=this.regions["default"];var a=$("result-image");a.up(".scroller").style.width=a.getAttribute("rel:width")+"px";a.up(".scroller").style.height=a.getAttribute("rel:height")+"px";var s=a.getAttribute("rel:width")*1;var n=a.getAttribute("rel:height")*1;var o=Math.round(this.image_data.width*s/r.width);var l=Math.round(r.left*s/r.width);var d=Math.round(n*r.top/r.height);a.src=this.image_element.src;a.style.margin="-"+d+"px 0 0 -"+l+"px";a.style.width=o+"px"}catch(e){console.error("If in IE - deal with it. "+e)}},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");if(this.uploader_params.origin=="custom_user_header")i.select(".error-title")[0].innerHTML=this.error_title="Image error.";else i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.uploader_params.origin=="user"&&(!t.uploaded||this.options.minHeight>t.height||this.options.minWidth>t.width)){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="Image error.";var r="Please upload an image that is at least "+this.options.minWidth+"px wide x "+this.options.minHeight+"px tall";if(!t.uploaded)r=t.message;i.select(".cerror-message")[0].innerHTML=this.error_message=r;
return false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,width:this.image_data.width,height:this.image_data.height};this.save_image()}});BF_SUPERPOST_CROPPER=Class.create(BF_IMAGE_CROPPER,{template:'		#{uploader_template}		<div id="cropper_container">			<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>			#{preview_template}			#{thumbs_template}		</div>',uploader_template:'		<div id="uploader_container">			<div class="upload-title hidden">Upload an Image</div>			<p class="upload-desc hidden">Select an image to use for your post. After uploading you&rsquo;ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div class="thumbs-left">				<fieldset class="normal-result">					<div class="result-header">Normal Thumbnails</div>					<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>					<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>					<button id="crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>				<fieldset class="wide-result">					<div class="result-header">Wide Thumbnail</div>					<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>					<button id="wide-crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>			</div>			<div class="thumbs-right">				<fieldset class="big-result">					<div class="result-header">Big Thumbnail</div>					<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>					<button id="big-crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>			</div>		</div>',setDefaults:function(){var t={cropper_class:"",fitImageAndScreen:true,modalIsParent:true,minWidth:625,minHeight:415};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;this.fitToScreenOuter=this.fitToScreen.bind(this);Event.stopObserving(window,"resize",this.fitToScreenOuter);Event.observe(window,"resize",this.fitToScreenOuter);Object.extend(this.options,t)},fitToScreen:function(){var t=$("modal-super-image-edit-container");if($$("#cropper_container .container")[0].hasClassName("hidden")){t.setStyle({width:""});t.setStyle({height:""});this.container.setStyle({width:""});this.container.setStyle({height:""})}else{var i=document.documentElement.clientWidth,r=document.documentElement.clientHeight,a=this.image_data.width,s=this.image_data.height,n=parseInt(this.container.getStyle("width")),o=parseInt(this.container.getStyle("height")),l=20,d=20,c=50,u=150;if(typeof this.ctw=="undefined"){this.ctw=n;this.cth=o}else{n=this.ctw;o=this.cth}var f=r-d;if(f<520)f=520;if(f-u-d>s)f=s+u+d;var p=i-l;if(p<400)p=400;if(o<f&&n<p){return}if(o>f){t.setStyle({height:f-u+"px"});this.container.setStyle({height:f+"px"})}if(n>p){t.setStyle({width:p-c>1064-c?1064-c:p-c+"px"});this.container.setStyle({width:p>1064?1064:p+"px"})}}},cancel_image:function(e){if(typeof superlist!="undefined"){superlist.redisplayPreviewIfNecessary()}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter);if(typeof superlist!="undefined"){top.superlist.redisplayPreviewIfNecessary()}},approve_image:function(e){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var r=this.regions.big;t.big_height=r.height;t.big_width=r.width;t.big_top=r.top;t.big_left=r.left}if(typeof superlist!="undefined")superlist.disable_actions();if("image_data"in this&&typeof this.image_data.scale!="undefined")t.scale=this.image_data.scale;bf_standalone_qp.save_image(this.image_data.image,this.image_data.name,t,"/buzzfeed/_edit_quickpost_image");var a=$("buzz-type");var s=a?a.value:"text";if(typeof this.options.callbacks!="undefined"&&typeof this.options.callbacks.finish_save_image!="undefined")this.options.callbacks.finish_save_image(s,this);else user_post.save_quickpost_image(s,this);if(top.$("original_image_crop_data")){top.$("original_image_crop_data").value=Object.toJSON(this.regions)}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});Event.stopObserving(window,"resize",this.fitToScreenOuter)},customize_cropper:function(t){var i=t.onloadCoords;if(this.regions[this.current_cropping_region]){i.x1=this.regions[this.current_cropping_region].left;i.y1=this.regions[this.current_cropping_region].top;i.x2=this.regions[this.current_cropping_region].left+this.regions[this.current_cropping_region].width;i.y2=this.regions[this.current_cropping_region].top+this.regions[this.current_cropping_region].height;t.minWidth=this[this.current_cropping_region+"_width"];t.minHeight=this[this.current_cropping_region+"_height"];t.ratioDim={x:this[this.current_cropping_region+"_width"],y:this[this.current_cropping_region+"_height"]}}else{var r=this.image_data;var a=r.width/this.options.minWidth;var s=r.height/this.options.minHeight;var n=Math.min(a,s);i.x2=this.options.minWidth*n;i.y2=this.options.minHeight*n}t.onloadCoords=i},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";i.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 625 x 415 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again.";return false}return true},crop_default_size:function(){this.regions.thumb={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.auto_big();this.auto_wide();this.approve_image()},crop_done:function(t,i){this.regions[this.current_cropping_region]={top:t.y1,left:t.x1,height:parseInt(t.y2-t.y1),width:parseInt(t.x2-t.x1),image:this.image_element.src}},auto_big:function(){var t=this.regions.thumb;var i={top:t.top,left:t.left,height:t.height,width:t.width};if(t.width<this.big_width){i.width=this.big_width;i.height=this.big_height;i.top=t.top-parseInt((i.height-t.height)/2);i.left=t.left-parseInt((i.width-t.width)/2);if(i.top<0)i.top=0;if(i.left<0)i.left=0;if(i.top+i.height>this.image_data.height)i.top=this.image_data.height-i.height;if(i.left+i.width>this.image_data.width)i.left=this.image_data.width-i.width}this.regions.big=i},auto_wide:function(){var t=this.regions.big;var i={top:t.top,left:t.left,height:t.height,width:t.width};i.top=t.top+parseInt(t.height/3);i.height=parseInt(this.wide_height*t.width/this.wide_width);this.regions.wide=i},show_thumbs:function(){var t=this;var i=this.image_element;if(!this.manual_big)this.auto_big();if(!this.manual_wide)this.auto_wide();this.cropper_container.select("#big-result-image, #wide-result-image").each(function(r){var a;if(r.id=="wide-result-image")a=t.regions.wide;else if(r.id=="big-result-image")a=t.regions.big;r.up(".scroller").style.width=r.getAttribute("rel:width")+"px";r.up(".scroller").style.height=r.getAttribute("rel:height")+"px";var s=r.getAttribute("rel:width")*1;var n=r.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*s/a.width);var l=Math.round(a.left*s/a.width);var d=Math.round(n*a.top/a.height);r.src=i.src;r.style.margin="-"+d+"px 0 0 -"+l+"px";r.style.width=o+"px";var c=r.up("fieldset").select("button")[0];c.stopObserving("click");c.observe("click",function(e){if(e.target.id=="big-crop-thumb"){this.manual_big=true;this.current_cropping_region="big"}else{this.manual_wide=true;this.current_cropping_region="wide"}$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t))});this.cropper_container.select("#normal-result-image, #small-result-image").each(function(r){var a=t.regions.thumb;r.up(".scroller").style.width=r.getAttribute("rel:width")+"px";r.up(".scroller").style.height=r.getAttribute("rel:height")+"px";var s=r.getAttribute("rel:width")*1;var n=r.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*s/a.width);var l=Math.round(a.left*s/a.width);var d=Math.round(n*a.top/a.height);r.src=i.src;r.style.margin="-"+d+"px 0 0 -"+l+"px";r.style.width=o+"px"});var r=$("crop-thumb");r.stopObserving("click");r.observe("click",function(){this.current_cropping_region="thumb";$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t));if(this.options.fitImageAndScreen)this.fitToScreen()}});BF_SUPERPOST_QUIZ_CROPPER=Class.create(BF_IMAGE_CROPPER,{setDefaults:function(){var t={cropper_class:"superpost_quiz",fitImageAndScreen:true,showThumbs:false,showPreview:false,showCropper:true,minWidth:this.options.image_data.crop_width,minHeight:this.options.image_data.crop_height};Object.extend(this.options,t)},fitToScreen:function(){var t=document.documentElement.clientWidth,i=document.documentElement.clientHeight,r=this.image_data.width,a=this.image_data.height,s=parseInt(this.container.getStyle("width")),n=parseInt(this.container.getStyle("height")),o=30+0,l=30+0,d=20,c=this.container.select(".bf_dialog_footer")[0].getHeight(),u=20;if(this.container.select("#cropper_container .container")[0].hasClassName("hidden")){var f=this.container.select("#cropper_container #thumbs")[0];r=parseInt(f.getStyle("width"));a=parseInt(f.getStyle("height"))}this.container.setStyle({width:r+"px"});this.container.setAttribute("width",r);this.container.setStyle({height:a+"px"});this.container.setAttribute("height",a);s=parseInt(this.container.getStyle("width"));n=parseInt(this.container.getStyle("height"));this.container.select(".cropperbody")[0].setStyle({width:s+"px"});this.container.select(".cropperbody")[0].setStyle({height:n+"px"});var p=this.container.up(".bf_dialog_content");p.setStyle({width:s+"px"});p.setStyle({height:n+c+"px"});var _=this.container.up(".bf_dialog");_.setStyle({width:s+d+"px"});_.setStyle({height:n+c+u+"px"});var h=document.documentElement.scrollLeft,m=document.body.scrollLeft,g=document.documentElement.scrollTop,v=document.body.scrollTop;_.setStyle({left:((t-s)/2>0?(t-s)/2:0)+(h>m?h:m)+"px"});_.setStyle({top:((i-n)/2>0?(i-n)/2:0)+(g>v?g:v)+"px"});_.setStyle({marginLeft:"0px"});var b=document.documentElement.clientWidth,w=document.documentElement.clientHeight,y=document.body.clientWidth,k=document.body.clientHeight;var T=this.container.up("#super-image-edit").select(".bf_overlay_mask")[0];T.setStyle({width:(b>y?b:y)+"px"});T.setStyle({height:(w>k?w:k)+"px"})},cancel_image:function(e){e.stop();this.close()},save_image:function(e){var t=this.regions["default"];quiz_admin.image_cropper_callback(this.image_data.image,this.image_data.name,this.image_data.format,t);this.close()},customize_cropper:function(t){var i=t.onloadCoords;var r=this.image_data;var a=r.width/this.options.minWidth;var s=r.height/this.options.minHeight;var n=Math.min(a,s);i.x2=this.options.minWidth*n;i.y2=this.options.minHeight*n;t.onloadCoords=i;$("save-image").focus()},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";i.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 170 x 170 pixels. Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==t.height&&this.options.minWidth==t.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.save_image()},crop_done:function(t,i){this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src}}});BF_FLEXPRO_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden btn--buzz btn--buzz--inline">Save</button>						<button id="preview-thumbs" class="hidden btn--buzz btn--buzz--inline">Save</button>						<button id="approve-thumbs" class="hidden btn--buzz btn--buzz--inline">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="btn--buzz btn--buzz--inline btn--buzz--discrete" value="Cancel" /></li>				</ul>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div>Are These Thumbnails OK? <span class="help">Thumbnail images may be be used to promote your post so make sure they look good!</span></div>			<fieldset class="big-result">				<div>Big Thumbnail</div>				<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>				<button id="big-crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>			<fieldset class="normal-result">				<div>Normal Thumbnails</div>				<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>				<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>				<button id="crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>			<fieldset class="wide-result">				<div>Wide Thumbnail</div>				<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>				<button id="wide-crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;var t={cropper_class:"flexpro",fitImageAndScreen:false,minWidth:355,minHeight:236};if(this.options.minWidth)t.minWidth=this.options.minWidth;if(this.options.minHeight)t.minHeight=this.options.minHeight;if(this.options.image_data.crop_height!=this.thumb_height||this.options.image_data.crop_width!=this.thumb_width){t={cropper_class:"flexpro",fitImageAndScreen:false,showThumbs:false,showPreview:false,showCropper:true,minHeight:parseInt(this.options.image_data.crop_height),minWidth:parseInt(this.options.image_data.crop_width)}}Object.extend(this.options,t)},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=t.err=="SmallImage"?"That image isn't big enough!":"Some error happened";i.select(".cerror-message")[0].innerHTML=t.err=="SmallImage"?"We need an image that's at least 625px wide x 415px tall. That's as big as the box this message is in! Please choose another one.":t.err;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";var r;if(this.options.showThumbs)r="We need an image that's at least "+this.options.minWidth+"px wide x "+this.options.minHeight+"px tall. That's as big as the box this message is in! Please choose another one.";else r="We need an image at least "+this.options.image_data.crop_width+" x "+this.options.image_data.crop_height+" pixels. Choose another one below, or hit cancel to try again.";i.select(".cerror-message")[0].innerHTML=this.error_message=r;return false}if(this.options.minHeight==t.height&&this.options.minWidth==t.width){this.options.showCropper=false}return true},save_image:function(){var t=this.regions.thumb;this.options.callbacks.save_image(this.image_data.image,this.image_data.name,t,this.options.controller);this.close()},approve_image:function(){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var r=this.regions.big;t.big_height=r.height;t.big_width=r.width;t.big_top=r.top;t.big_left=r.left}if(this.image_data&&this.image_data.original){t.original={image:this.image_data.original.image,image_width:this.image_data.original.width,height:this.image_data.original.height}}this.options.callbacks.save_image(this.image_data.image,this.image_data.name,t,parent.image_handling.controller);var a=$("buzz-type");var s=a?a.value:"text";this.options.callbacks.finish_save_image(s,this)},cancel_image:function(e){e.stop();$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter)},fitToScreen:function(){}});BF_OPTIMIZE_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{setDefaults:function(){var t={cropper_class:"",fitImageAndScreen:false,modalIsParent:true,minWidth:355,minHeight:236};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;if(this.options.minWidth)t.minWidth=this.options.minWidth;if(this.options.minHeight)t.minHeight=this.options.minHeight;Object.extend(this.options,t)},fitToScreen:function(){},approve_image:function(e){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var r=this.regions.big;t.big_height=r.height;t.big_width=r.width;t.big_top=r.top;t.big_left=r.left}if(this.options.image_data.image){t.image=this.options.image_data.image;if(this.options.subid){t.subid=this.options.subid}if(this.options.promoid){t.promoid=this.options.promoid}}if(t.subid){optimize.update_cropping(t)}else if(t.promoid){optimize.update_cropping_in_progress(t)}this.cancel_image()}});BF_PicksController=function(){this.controller="/buzzfeed/_picks";this.switchuser_list=new Template('<option class="pick_switch_user" rel:data="#{user.id}">#{user.display_name}</option>');this.initialized_dialog=false;this.init=function(){if(BF_STATIC&&BF_STATIC["page"]&&BF_STATIC.page.match(/Home/)){return true}if(window.location.pathname.match(/\/submit\/\w+/)){this.init_submissions()}else{var t=(new BF_User).getUserInfo();EventManager.observe("share_button:built",function(t){if(!t.type||!t.el||t.type!="rebuzz_default"){return}t.el.show();t.el.observe("click",picks_controller.launch_pick)});$$(".make_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick)});$$(".microsite-name").each(function(i){i.update(t.display_name)});var i=document.location.pathname.split("/").pop();if(i==t.username){if($("pending-submissions-notice"))$("pending-submissions-notice").show();$$(".delete_pick").each(function(t){$(t.parentNode).show();t.show();t.observe("click",picks_controller.delete_pick)});if(document.location.pathname.match(/\/submissions\//)){$$(".accept_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick_accept)});$$(".delete-pick").each(function(t){t.removeClassName("delete-pick");t.addClassName("accept-pick")})}else{$$(".edit_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick_edit)});$$(".add-pick").each(function(i){var r=JSON.parse(i.getAttribute("data"));if(r!=null&&r.username==t.username){$(i.parentNode).hide();i.hide()}else{i.addClassName("edit-pick")}})}}else{$$(".add-pick").each(function(i){var r=JSON.parse(i.getAttribute("rel:data"));if(r&&r.username==t.username){$(i.parentNode).hide();i.hide()}})}}};this.load_picks_dialog=function(t){var i=arguments;if(!this.initialized_dialog){Box.Application.getService("template-engine").load({id:"pick_dialog",returnType:"fragment",callback:function(t){var r=Box.Application.getService("dom");r.appendOnce(t,".js-page-container",".js-pick_dialog");picks_controller.init_picks_dialog.apply(picks_controller,i)}})}else{t()}},this.init_picks_dialog=function(t){if($("pick-buzz-button"))$("pick-buzz-button").observe("click",picks_controller.pick);if($("pick-buzz-cancel-button"))$("pick-buzz-cancel-button").observe("click",function(e){var t=$("pick-buzz-button").getAttribute("rel:buzz_id");if(t){if($(t+"-accept_pick-spinner"))$(t+"-accept_pick-spinner").hide();if($(t+"-make_pick-add"))$(t+"-make_pick-add").show();if($(t+"-make_pick-success"))$(t+"-make_pick-success").hide();if($(t+"-make_pick-spinner"))$(t+"-make_pick-spinner").hide()}});this.initialized_dialog=true;t()};this.init_submissions=function(){picks_controller.add_microsite_id=function(t){t.submit_to_microsite=0};picks_controller.save_image=function(t,i,r,a){var s=r;if(typeof a=="undefined"){a="/buzzfeed/_edit_user_image"}else{s.type=$("buzz-type").value+"buzz"}if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();s.image=t.replace(/\.(jpg|gif)$/,"");s.action="imagecrop";var n=function(t){picks_controller.image_saved(t)};var o=new BF_Request;o.request(a,{method:"post",parameters:s,onSuccess:n})};picks_controller.image_saved=function(t){if($("user-loading"))$("user-loading").hide();var i=JSON.parse(t.responseText);if(i.saved){if($("quickpost-enhanced-image-file"))$("quickpost-enhanced-image-file").value=i.thumb_image;if($("quickpost-embed-image-file"))$("quickpost-embed-image-file").value=i.thumb_image;if($("quickpost-link-image-file"))$("quickpost-link-image-file").value=i.thumb_image;if($("quickpost-quiz-image-file"))$("quickpost-quiz-image-file").value=i.thumb_image;if($("quickpost-video-image-file"))$("quickpost-video-image-file").value=i.thumb_image;if($("quickpost-image-image-thumb"))$("quickpost-image-image-thumb").value=i.thumb_image;if($("quickpost-image-image-file"))$("quickpost-image-image-file").value=i.large_image;if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+i.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+i.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+i.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+i.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+i.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+i.thumb_image;$("quiz-thumbnail").show()}this.settings.image=i.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};picks_controller.save_ok=function(t){if($("successful-entry"))$("successful-entry").show();if($("select-quickpost-box"))$("select-quickpost-box").hide()};user_post.init();EventManager.observe("user_post:save:success",picks_controller.save_ok);EventManager.observe("user_post:save:preparing",picks_controller.add_microsite_id);var t=new BF_User;if(t.isLoggedIn()){if(t.getUserInfo().terminal_user&&t.getUserInfo().terminal_user=="true"){if($("quickpost-enhanced-settings"))$("quickpost-enhanced-settings").show()}else{if($("quickpost-enhanced-settings"))$("quickpost-enhanced-settings").hide()}var i=new RegExp("/submit/"+t.getUserInfo().username+"$");if(window.location.href.match(i)){if($("error-div"))$("error-div").show()}}else{console.warn("signin.open is deprecated. Please use BF_LOGIN_SIGNUP.show")}};this.do_make_request=function(t,i,r,a){var s={action:t,buzz_id:i,note:r};var n=$("pick-buzz-button").getAttribute("rel:switch_user_id");if(typeof n!="undefined"&&n){s.user_id=n}if(typeof legit_switch_users=="undefined")legit_switch_users=[];if(t=="delete"&&"acl"in window&&(acl.user_can("picks_delete_from_anywhere")||legit_switch_users.indexOf((new BF_User).getUserInfo().username)>-1)&&BF_STATIC.tt_page=="User"&&"bf_username"in window){s.username=bf_username}var o=(new BF_User).getUserInfo();if((t=="hide"||t=="show")&&("acl"in window&&acl.user_can("partners_manage")||bf_username==o.username)&&"bf_username"in window){s.username=bf_username}var l=new BF_Request;l.request(picks_controller.controller,{method:"post",parameters:s,onSuccess:a})};this.make_request=function(t,i,r,a){var s=arguments;picks_controller.load_picks_dialog(function(){picks_controller.do_make_request.apply(picks_controller,s)})};this._accept=function(t){var i=JSON.parse(t.responseText);if(i.success){var r=i.buzz_id;if($(r+"-accept_pick-spinner"))$(r+"-accept_pick-spinner").hide();if($("post-"+r))$("post-"+r).appendChild(new Element("span",{"class":"this-post-was-picked"}));if($$("#post-2111731 .accept-pick")&&$$("#post-2111731 .accept-pick")[0])$$("#post-2111731 .accept-pick")[0].hide()}};this.hide_pick=function(e,t){e.stop();var i=e.target;var r=i;while(r.parentNode&&!r.getAttribute("rel:buzz_id")){r=r.parentNode}var a=r.getAttribute("rel:buzz_id");if(a){picks_controller.make_request("hide",a,"",function(i){picks_controller._delete(i);t(i)})}};this.show_pick=function(e,t){e.stop();var i=e.target;var r=i;while(r.parentNode&&!r.getAttribute("rel:buzz_id")){r=r.parentNode}var a=r.getAttribute("rel:buzz_id");if(a){picks_controller.make_request("show",a,"",function(i){picks_controller._delete(i);t(i)})}};this.delete_pick=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var r=i.getAttribute("rel:buzz_id");if(r){if($(r+"-delete_pick-spinner"))$(r+"-delete_pick-spinner").show();picks_controller.make_request("delete",r,"",picks_controller._delete)}};this._delete=function(t){var i=JSON.parse(t.responseText);if(i.success){var r=i.buzz_id;if($(r+"-delete_pick-spinner"))$(r+"-delete_pick-spinner").hide();if($("post-"+r))$("post-"+r).hide()}};this.do_launch_pick=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var r=i.getAttribute("rel:buzz_id");if($("easy_rebuzz"))$("easy_rebuzz").hide();picks_controller.start_spinner(i);(new BF_Request).request(picks_controller.controller,{method:"get",parameters:{buzz_id:r,action:"get_pick"},onSuccess:function(t){picks_controller.easy_rebuzz(e,t)},onFailure:function(t){$("pick-buzz-button").setAttribute("rel:buzz_id",r);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""},evalJSON:true});return};this.launch_pick=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick(e)})};this.do_easy_rebuzz=function(e,t){e.stop();var i=e.target;var r=i;while(r.parentNode&&!r.getAttribute("rel:buzz_id")){r=r.parentNode}var a=r.getAttribute("rel:buzz_id");var s=t.responseText.evalJSON();if(typeof s.success!="undefined"&&s.success==1){if(typeof s.pick!="undefined"&&s.pick!=0){picks_controller.launch_pick_edit(e,t)}else{BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick-buzz-button").setAttribute("rel:buzz_id",a);$("pick-buzz-button").setAttribute("rel:action","pick");$("pick_note").value="";if(typeof s.users!="undefined"){var n='<select id="switchuser_select">';var o=0;for(o=0;o<s.users.length;o++){n+=this.switchuser_list.evaluate({user:s.users[o]})}n+="</select>";if(o>0&&$("rebuzz_switchuser_list")){$("rebuzz_switchuser_list").update(n);if($("easy_rebuzz"))$("easy_rebuzz").show();if($("switchuser_select"))$("switchuser_select").observe("change",function(e){e.stop();$$(".pick_switch_user").each(function(t){if(t.selected){var i=t.getAttribute("rel:data");if(typeof i!=undefined&&i)picks_controller.choose_user(i)}})})}}}}else{$("pick-buzz-button").setAttribute("rel:buzz_id",a);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""}};this.easy_rebuzz=function(e,t){picks_controller.load_picks_dialog(function(){picks_controller.do_easy_rebuzz(e,t)})};this.do_launch_pick_edit=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var r=i.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Update Note";$("pick-buzz-button").setAttribute("rel:buzz_id",r);$("pick-buzz-button").setAttribute("rel:action","update_note");$("pick_note").value="";$("pick_note").disabled=true;var a=function(t){$("pick_note").disabled=false;var i=t.responseText.evalJSON();$("pick_note").value=BF_UI.renderEntities(i.pick.note);if(i.pick.is_pick==2&&i.pick.pending_acceptance==1){$("pick-buzz-button").setAttribute("rel:action","accept_pick");$("pick-buzz-button").value="Accept Buzz"}};if(arguments[1]){a(arguments[1])}else{(new BF_Request).request(picks_controller.controller,{method:"get",parameters:{buzz_id:r,action:"get_pick"},onSuccess:a,evalJSON:true})}BF_UI.showDialog("pick_dialog","Edit Your Note")};this.launch_pick_edit=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_edit(e)})};this.do_launch_pick_accept=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var r=i.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Accept Buzz";$("pick-buzz-button").setAttribute("rel:buzz_id",r);$("pick-buzz-button").setAttribute("rel:action","accept");BF_UI.showDialog("pick_dialog","Accept a Submission")};this.launch_pick_accept=function(e){if(!picks_controller.initialized_dialog){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_accept(e)})}else{picks_controller.do_launch_pick_accept(e)}};this.choose_user=function(t){$("pick-buzz-button").setAttribute("rel:switch_user_id",t)};this.pick=function(e){e.stop();BF_UI.closeDialog("pick_dialog");var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var r=i.getAttribute("rel:buzz_id");var a=$("pick-buzz-button").getAttribute("rel:action");var s=picks_controller._pick;if(!a)a="pick";if(a=="update_note"){var n=$$("#post-"+r+" .buzznote .what").first();if(n){n.update($F("pick_note").replace(/</g,"&lt;").replace(/>/g,"&gt;"));$$("#post-"+r+" .buzznote").first().show();
}}else if(a=="accept"){s=picks_controller._accept}else if(a=="accept_pick"){a="accept"}if(r){picks_controller.make_request(a,r,$F("pick_note"),s);picks_controller.start_spinner(i)}};this._pick=function(t){var i=JSON.parse(t.responseText);if(i.success){var r=i.buzz_id;picks_controller.stop_spinner();var a=new BF_User;if(a.isLoggedIn()){var s=a.getUserInfo().username;var n="your Feed";if(typeof i.username!="undefined"&&i.username&&s!=i.username){n+=" (/"+i.username+")";s=i.username}if($("social_message-rebuzz")){$("social_message-rebuzz").update('<h5><span class="highlight">Rebuzzed!</span> This post has been added to <a href="'+(BF_STATIC?BF_STATIC.web_root:"")+"/"+s+'/">'+n+"</a></h5>");$("social_message-rebuzz").show()}}gtrack.track_events("","share/rebuzz","")}else{picks_controller.stop_spinner()}};this.stop_spinner=function(){$$(".rebuzz_icon.busy").each(function(e){$(e).removeClassName("busy")})};this.start_spinner=function(t){var i=t.select(".rebuzz_icon");if(i&&i.length){i.first().addClassName("busy")}}};var trackToBfa=function(t,i,r,a,s){if(!window.bfa||!(window.bfa instanceof Function)||!window.bfaBinder||a!=="play"){return}var n=bfaBinder.parser.findLocation(t);bfa("track","click","Video-Play",n,"",{videoUrl:r})};var trackVideo=function(t,i,r,a){if(!r){r=""}if(!a){a=""}var s=$(t);var n=s[bfjs.read_attr]("src");if(!n){n=a}var o=n?n.split("?").length>=0?n.split("?")[0].replace(new RegExp(/^http:\/\//i),"").replace(new RegExp(/^www\./i),""):"":"";var l=gtrack.findCatLabel(t);var d=l?l:gtrack.tt_page;var c={ready:function(){gtrack.track_events(d,r+"[nc]video:load",o,null,true)},finish:function(){gtrack.track_events(d,r+"[nc]video:end",o,null,true)},play:function(){gtrack.track_events(d,r+"video-play",o,null,true);document.fire("video:play",{playerid:t})},progression_25:function(){gtrack.track_events(d,r+"[nc]video:progression:25%",o,null,true)},progression_50:function(){gtrack.track_events(d,r+"[nc]video:progression:50%",o,null,true)},progression_75:function(){gtrack.track_events(d,r+"[nc]video:progression:75%",o,null,true)}};if(typeof c[i]!="undefined"){c[i]()}trackToBfa(s,t,n,i,r)};var VimeoTrackVideo=function(){var t=this;var i={};this.init=function(){if(bfjs.isMobile()&&$(".video-embed.vimeo").length||!bfjs.isMobile()&&$$(".video_vimeo").length){if(window.addEventListener){window.addEventListener("message",t.addVideoListener,false)}else{window.attachEvent("onmessage",t.addVideoListener,false)}}};this.addVideoListener=function(e){if(typeof e.origin=="undefined"||!/^https?:\/\/player.vimeo.com/.test(event.origin)){return}var r=null,a=null,s=null;if(bfjs.isMobile()){r=JSON.parse(e.data);s="#"+r.player_id}else{r=e.data.evalJSON();s=r.player_id}a=$(s);if(!r||!a){return}if(r.event=="ready"){i[s]={};var n=a[bfjs.read_attr]("src").split("?")[0];if(bfjs.isMobile()){a=$(s)[0]}t.addEvent("addEventListener","play",a,n);t.addEvent("addEventListener","finish",a,n)}if(i[s]&&!i[s][r.event]){trackVideo(s,r.event);i[s][r.event]=true}};this.addEvent=function(t,i,r,a){var s={method:t};if(i){s.value=i}r.contentWindow.postMessage(JSON.stringify(s),a)};this.init()};bfjs.onPageLoad(function(){new VimeoTrackVideo});var YT_PLAYERS={};var YoutubeTrackVideo=function(){var t=this;var i={},r={};this.init=function(){};this.addVideoListener=function(t){i[t]={};var a=$(t).readAttribute("src"),s="";if(a==null){a=r[t].src;if(r[t].dfp){s="dfp/"}}else if(a){s=a.match(/dfp=true/)?"dfp/":""}this.addEvent(t,s,a)};this.getVideoTimestamp=function(t){return Math.floor(yt_player.players[t].getCurrentTime())};var a=function(t){var i=[],r=[25,50,75];r.forEach(function(r){var a=Math.floor(r/100*t);i.push(a)});return i};this.addEvent=function(r,s,n){var o="yt"+Math.floor(Math.random()*1e5);var l={};YT_PLAYERS[r]={pollIntervalID:0,onStateChanged:function(o){var d=t.getEventType(o),c=yt_player.players[r].getDuration();if(d=="play"){var u=a(c);if(this.pollIntervalID===0){this.pollIntervalID=setInterval(function(){var i=t.getVideoTimestamp(r);t.ad_tracking(i,r);if(!l[2]){if(u[0]==i&&!l[0]){trackVideo(r,"progression_25",s,n);l[0]=true}else if(u[1]==i&&!l[1]){trackVideo(r,"progression_50",s,n);l[1]=true}else if(u[2]==i&&!l[2]){trackVideo(r,"progression_75",s,n);l[2]=true}}},500)}}else if(d=="paused"||d=="finish"){clearInterval(this.pollIntervalID);t.ad_tracking(d,r);this.pollIntervalID=0}if(!i[r][o]){if(d){trackVideo(r,d,s,n)}i[r][o]=true}}}};this.ad_tracking=function(t,i){var r=BF_STATIC.generated_timestamp;var a=1438300799;var s=BF_STATIC.campaignid=="3891332";var n=BF_STATIC.campaignid=="3772395";var o=BF_STATIC.campaignid=="3721182";var l=BF_STATIC.campaignid=="3764305";var d=BF_STATIC.campaignid=="3764304";var c=BF_STATIC.campaignid=="3798567";var u=BF_STATIC.campaignid=="3798529";var f=BF_STATIC.campaignid=="3796318";var p=BF_STATIC.campaignid=="3797548";var _=BF_STATIC.campaignid=="3792273";var h=BF_STATIC.campaignid=="3808365";var m=BF_STATIC.campaignid=="3796239";var g=BF_STATIC.campaignid=="3946063";var v=BF_STATIC.campaignid=="3946084";var b=BF_STATIC.campaignid=="3942449";var w=BF_STATIC.campaignid=="4047635";var y=0;if(typeof t!=="undefined")y=parseInt(t,10);if(BF_STATIC.tt_page=="Buzz"){if(o&&t==="finish"){var k=document.createElement("script");k.src="http://cookiechecker.sensic.net/sandbox/upload/buzzfeed/dsmTag4194.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4194Script&clickUrl=";document.getElementsByTagName("head")[0].appendChild(k)}else if(s&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12570/dsmTag5140-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5140Script&clickUrl=";k.id="dsmTag5140Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(c&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12464/dsmTag4857-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4857Script&clickUrl=";k.id="dsmTag4857Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(u&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12397/dsmTag4682-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4682Script&clickUrl=";k.id="dsmTag4682Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(f&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12470/dsmTag4884-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4884Script&clickUrl=";k.id="dsmTag4884Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(p&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12465/dsmTag4864-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4864Script&clickUrl=";k.id="dsmTag4864Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(_&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12455/dsmTag4840-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4840Script&clickUrl=";k.id="dsmTag4840Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(h&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12396/dsmTag4680-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4680Script&clickUrl=";k.id="dsmTag4680Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(m&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12461/dsmTag4848-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4848Script&clickUrl=";k.id="dsmTag4848Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(g&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12533/dsmTag5353-min.js?identifier=&siteId=DMIMACROSvideo1DMIMACROE&adTypeId=&tacticId=&userId=&scriptID=dsmTag5353Script&clickUrl=";k.id="dsmTag5353Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(v&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12533/dsmTag5354-min.js?identifier=&siteId=DMIMACROSvideo2DMIMACROE&adTypeId=&tacticId=&userId=&scriptID=dsmTag5354Script&clickUrl=";k.id="dsmTag5354Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(b&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/html5/dimestoreTag.js?projectID=12731&playerVersion=5&identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5591&clickUrl=";k.id="dsmTag5591";document.getElementsByTagName("body")[0].appendChild(k)}else if(w&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/html5/dimestoreTag.js?projectID=12735&playerVersion=5&identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5614&clickUrl=";k.id="dsmTag5614";document.getElementsByTagName("body")[0].appendChild(k)}}};this.getEventType=function(t){var i="";switch(t){case-1:i="ready";break;case 0:i="finish";break;case 1:i="play";break;case 2:i="paused";break}return i};this.init()};var youtube_track_video=!bfjs.isMobile()?new YoutubeTrackVideo:"";var BFTestRunner=function(){this.__mock_objects={};this.called={};this.init=function(){test_runner.force_testmode_on_ajax();this.load_files([{type:"text/css",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/logger/assets/logger.css"},{type:"text/css",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yuitest/assets/testlogger.css"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yahoo-dom-event/yahoo-dom-event.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/logger/logger-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yuitest/yuitest-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yahoo/yahoo-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/json/json-min.js"}]);this.observe("page_load:done",function(){test_runner.load_tests()});document.observe("dom:loaded",function(e){test_runner.fire_event("page_load",{})})};this.on_page=function(t){if(window.location.href.indexOf(t)!=-1)return true;else{var i=window.location.search;if(t.indexOf("?")!=-1)i=i.replace(/\?/,"&");window.location.href=BF_STATIC.web_root+t+i}return false};this.append_to_function=function(old_fn,appendage){this.__mock_objects["special-"+old_fn]=eval(old_fn);this.mock(old_fn,function(){eval("var supr="+test_runner.__mock_objects[old_fn]);supr(eval(old_fn+".arguments"));appendage(eval(old_fn+".arguments"))})};this.force_testmode_on_ajax=function(t){if(typeof test_runner._request=="undefined"){this._request=Ajax.Request;this._request_events=Ajax.Request.Events;this.mock("Ajax.Request",function(t,i){i.parameters.testmode="on";Ajax.Request.Events=test_runner._request_events;new test_runner._request(t,i)},"special")}};this.remove_special=function(method){if(typeof this.__mock_objects[method]!="undefined"){eval(method+"="+this.__mock_objects["special-"+method])}};this.mock=function(method,fn,prefix){if(prefix)prefix+="-";else prefix="";this.__mock_objects[prefix+method]=eval(method);var object_path=method.split(".");var first_word=eval(object_path[0]);if(typeof first_word=="undefined"||typeof first_word=="object"){this._mock_object(object_path,[]);object_path=method.split(".");var fn_name=object_path.pop();var obj=eval(object_path.join("."));obj[fn_name]=fn}else if(typeof first_word=="function"&&object_path[1]){var obj=function(){};var old=first_word;for(var each in old.prototype){obj.prototype[each]=old.prototype[each]}obj.prototype[object_path[1]]=fn}return obj};this.unmock=function(method){if(typeof test_runner.__mock_objects[method]!="undefined"){eval(method+"="+test_runner.__mock_objects[method])}};this.unmock_all=function(){for(var t in test_runner.__mock_objects){if(t.match(/^special-/))continue;test_runner.unmock(t)}};this._mock_object=function(object_to_build,object_built){object_built.push(object_to_build.shift());var test;try{test=eval(object_built.join("."))}catch(e){var str=object_built.join(".")+" = new Object();";eval(str)}if(test=="undefined"){var str=object_built.join(".")+" = new Object();";eval(str)}if(object_to_build.length>0){this._mock_object(object_to_build,object_built)}};this._init_testmode=function(t){if(typeof test_runner=="undefined"){window.setTimeout(function(){test_runner._init_testmode(t)},200);return}test_runner.run=function(i){t.suite=i};t.reload_count=0;t.ajax=function(i,r){try{var a=t.suite.get_response(i,r.parameters);if(r.while_processing.show){$(r.while_processing.show).addClassName("hidden")}r.onSuccess({status:200,responseText:Object.toJSON(a)})}catch(e){if(t.reload_count++<15){window.setTimeout(function(){t.ajax(i,r)},200)}}}};this.generate_event_handler_tests=function(suite,tests){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated event handler tests"});for(var handler in tests){tests[handler].each(function(btn){if(typeof btn.el!="undefined"){btn.id=btn.id||btn.el.className||btn.el.tagName}else{btn.el=$(btn.id)}test_case["test_"+btn.id+"_is_hooked_up_to_"+handler+"_handler"]=function(handler,btn){if(typeof btn.setup!="undefined")btn.setup();var called={};if(typeof btn.preface!="undefined")eval(btn.preface);test_runner.mock(handler,function(){called[handler]=true;called.arguments=arguments});if(btn.el==null)btn.el=$(btn.id);test_runner.Assert.isObject(btn.el,"Found "+btn.id+" element on the page");test_runner.UserAction.click(btn.el);test_runner.Assert.areSame(true,called[handler],"Called "+handler+" from "+btn.el.innerHTML+" element ("+btn.id+")");if(btn.args){btn.args.each(function(t,i){test_runner.Assert.isDeeply(t,called.arguments[i],"Got expected argument in position "+i)})}}.curry(handler,btn)})}suite.add(test_case)};this.generate_dependency_tests=function(suite,dependencies){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated dependency tests"});dependencies.each(function(dependency){if(typeof dependency=="string"){test_case["test_"+dependency+"_element_id_exists"]=function(t){test_runner.Assert.elementIDExists(t)}.curry(dependency)}else if(typeof dependency=="object"){if(dependency.test=="is_defined"){test_case["test_"+dependency.id+"_is_defined"]=function(dependency){test_runner.Assert.isObject(eval(dependency.id),dependency.id+" is loaded")}.curry(dependency)}}});suite.add(test_case)};this.profile=function(t,i){test_runner.call_profile={};YAHOO.tool.TestRunner.subscribe(YAHOO.tool.TestRunner.COMPLETE_EVENT,function(){console.dir({coverage:test_runner.call_profile})});for(var r in i){if(typeof i[r]!="function")continue;var a=r+"_"+(new Date).getTime();i[a]=i[r];test_runner.call_profile[r]=0;i[r]=Function(i[r].argumentNames(),'test_runner.call_profile["'+r+'"]+=1;'+t+"."+a+"("+i[r].argumentNames().join(",")+")")}};var temp=BFW_Util.getCookie("bf_trace_path");this.trace_path=temp==null?new Array:JSON.parse(unescape(temp));this.trace=function(object_name){var object=eval(object_name);var temp={};for(var key in object){temp[key]=object[key]}for(var each in temp){if(typeof object[each]!="function")continue;if(object[each].toString().match(/trace_wrapper/))continue;var rnd_name=each+"_"+(new Date).getTime();object[rnd_name]=object[each];object[each]=Function(object[each].argumentNames(),'				var trace_wrapper = true; var __trace_context="unknown";				try{__trace_context = arguments.callee.caller.toString();}catch(e){} 				var __trace_result;					var __trace_e; 				var __log = {args:arguments,calling:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"calling_'+object_name+"."+each+'":__log}); 				try {					__trace_e="";					__trace_result='+object_name+"."+rnd_name+"("+object[each].argumentNames().join(",")+');				} catch(e){__trace_e=e}; 				__log = {error:__trace_e,_args:arguments,result:__trace_result,called:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"called_'+object_name+"."+each+'":__log}); 				BFW_Util.setCookie({name:"bf_trace_path",value:escape(Object.toJSON(test_runner.trace_path))}); 				if ( __trace_e != "" ) throw(__trace_e); 				return __trace_result')}};this.dump_trace=function(){var t=window.open("","");test_runner.trace_path.each(function(i){var r="<li>";for(var a in i){r+="<b>"+a+"</b>: "+i[a]+" ("+typeof i[a]+") <br />"}r+="</li>";t.document.writeln(r)})};this.clear_trace=function(){BFW_Util.deleteCookie("bf_trace_path");test_runner.trace_path=new Array};this.wait_until=function(t,i,r){if(t())i();else{if(!r){r=(new Date).getTime();Facebook["__deadlock_"+r]=0}else{if(Facebook["__deadlock_"+r]++>100){i()}}window.setTimeout(function(){test_runner.wait_until(t,i,r)},200)}};this.add=function(t){var i=YAHOO.tool.TestRunner;i.add(t)};this.run=function(t){this._run(true,t)};this.local_run=function(t){this._run(false,t)};this._run=function(t,i){var r=YAHOO.tool.TestRunner;r.subscribe(r.TEST_PASS_EVENT,test_runner.unmock_all);r.subscribe(r.TEST_FAIL_EVENT,test_runner.unmock_all);if(t){r.subscribe(r.COMPLETE_EVENT,function(t){var i=new YAHOO.tool.TestReporter(BF_STATIC.web_root+"/_fixtures",YAHOO.tool.TestFormat.JSON);i.report(t.results)})}var a=new YAHOO.tool.TestLogger;if(window.location.href.match(/test_method=/i)){var s=window.location.href.split("&");s.each(function(t){if(t.match(/test_method=/i)){var r=t.split(/=/);var a=r[1];i.items.each(function(t){for(var i in t){if(i.match(/^test_/i)&&i!=a){delete t[i]}}})}})}if(i)r.add(i);r.run()};this.log_in=function(t){var i={session_key:"1234567812345678123456781234567812345678123456781234567812345678marcos",display_name:"Test%20User",image:"",username:"marcos",facebook_uid:"",show_account_settings:"true",registration_path:"signin",is_facebook_user:"false",terminal_user:"false",last_active:123456789,isa:"false",user_id:1234567};var r=t?t:{};for(var a in i){if(typeof r[a]=="undefined"){r[a]=i[a]}}BFW_Util.setCookie({name:BFW_COOKIE,value:r.session_key});var s="display_name="+r.display_name;s+="&image="+r.image;s+="&username="+r.username;s+="&facebook_uid="+r.facebook_uid;s+="&show_account_settings="+r.show_account_settings;s+="&registration_path="+r.registration_path;s+="&is_facebook_user="+r.is_facebook_user;s+="&terminal_user="+r.terminal_user;s+="&isa="+r.isa;BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:s})};this.log_out=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER)};this.extendAssertions=function(){test_runner.Assert=YAHOO.util.Assert;test_runner.UserAction={};for(var t in YAHOO.util.UserAction){if(t=="click"){test_runner.UserAction[t]=function(t){if(t.click)t.click();else YAHOO.util.UserAction.click(t)}}else{test_runner.UserAction[t]=YAHOO.util.UserAction[t]}}test_runner.Assert.isVisible=function(t,i){var r=$(t).visible()&&!$(t).hasClassName("hidden");test_runner.Assert.areEqual(true,r,i?i:t+" is visible")};test_runner.Assert.isHidden=function(t,i){var r=$(t).visible()&&!$(t).hasClassName("hidden");test_runner.Assert.areEqual(false,r,i?i:t+" is hidden")};test_runner.Assert.isLike=function(t,i,r){test_runner.Assert.isNotNull(t.match(i),r?r:t+" matches regex")};test_runner.Assert.isNotLike=function(t,i,r){test_runner.Assert.isNull(t.match(i),r?r:t+" matches regex")};test_runner.Assert.elementIDExists=function(t,i){test_runner.Assert.isNotNull($(t),i?i:t+" is on the page")};test_runner.Assert.isDeeply=function(t,i,r){if(typeof t=="object"){for(var a in t){test_runner.Assert.isDeeply(t[a],i[a],r)}}else{test_runner.Assert.areSame(t,i,r)}}};this.load_tests=function(){var t=test_runner.parse_params();var i=t.test_suite?test_runner.__test_suites[t.test_suite]():[];if(t.tests){var r=t.tests.split(",");for(var a=0;a<r.length;a++)i.push(test_runner.__tests[r[a]])}if(t.test)i.push(test_runner.__tests[t.test]);test_runner._wait_for_yahoo(test_runner.extendAssertions);test_runner._wait_for_yahoo(function(){test_runner.load_files(i)})};this._wait_for_yahoo=function(t){if(typeof this.__wait_count=="undefined")this.__wait_count=0;else if(this.__wait_count++>1e3){alert("Took too long to load Yahoo files");return}if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.UserAction=="undefined"||typeof YAHOO.util.Assert=="undefined"){window.setTimeout(function(e){test_runner._wait_for_yahoo(t)},200)}else{t()}};this.cookie=function(t){var i=document.cookie.split(";");var r={};for(var a=0;a<i.length;a++){var s=i[a].split("=");s[0]=s[0].replace(/ /g,"");r[s[0]]=s[1]}return unescape(r[t])};this.parse_params=function(t){var i={};if(!t)t=window.location.search.substring(1);var r=t.split("&");for(var a=0;a<r.length;a++){var s=r[a].split("=");if(s.length==2){i[s[0]]=s[1]}else{i[s[0]]=true}}return i};this.$=function(t){if($(t))return $(t);return $(test_runner.DOM_SYNONYMS[t])};this.load_files=function(t){if(typeof t=="string")t=[{type:"text/javascript",url:t}];for(var i=0;i<t.length;i++){var r=t[i];if(typeof r=="undefined"){continue}if(typeof r=="string")r={type:"text/javascript",url:r};if(r.type=="text/javascript")this.load_javascript(r);else if(r.type=="text/css")this.load_css(r);else console.error("unrecognized file type to load: "+r.type)}};this.load_javascript=function(t){var i=document.createElement("script");i.setAttribute("type",t.type);i.setAttribute("src",t.url);i.setAttribute("defer","false");if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(){document.getElementsByTagName("HEAD")[0].appendChild(i)})}else{document.getElementsByTagName("HEAD")[0].appendChild(i)}};this.load_css=function(t){var i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("type",t.type);i.setAttribute("href",t.url);if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(e){document.getElementsByTagName("HEAD")[0].appendChild(i)})}else{document.getElementsByTagName("HEAD")[0].appendChild(i)}};this.observe=function(t,i){if(!this.__EVENTS[t])this.__EVENTS[t]=[];this.__EVENTS[t].push(i)};this.fire_event=function(t,i){var r=test_runner.__EVENTS[t]?test_runner.__EVENTS[t]:[];for(var a=0;a<r.length;a++){r[a](i)}if(t.indexOf(":done")==-1){test_runner.fire_event(t+":done",i)}};this.__EVENTS={};this.DOM_SYNONYMS={};this.__tests={buzz_stats:"/static/js/public/test/buzz_stats.js",demo:"/static/js/public/test/demo.js",login:"/static/js/public/test/login.js",register:"/static/js/public/test/register.js",profile:"/static/js/public/test/profile.js",prepopulated_quickpost:"/static/js/public/test/prepopulated_quickpost_test.js",save_buzz:"/static/js/public/test/save_buzz_test.js",facebook2:"/static/js/public/test/facebook2_test.js",badges:"/static/js/public/test/badge_test.js",session_tracking:"/static/js/public/test/session_test.js",micro_sites:"/static/js/public/test/microsite_test.js",handler_test:"/static/js/public/test/generic_handler.js",signup:"/static/js/public/test/new_signup_page.js",settings:"/static/js/public/test/new_settings.js",quickpost:"/static/js/public/test/quickpost_test.js",dashboard:"/static/js/public/test/dashboard_test.js","dashboard-stats":"/static/js/public/test/dashboard-stats-test.js",dashboard_ad:"/static/js/public/test/dashboard_ad_test.js",dashboard_widget:"/static/js/public/test/dashboard_widget_test.js",dashboard_user_stats:"/static/js/public/test/dashboard_user_stats_test.js",realtimeweb:"/static/js/public/test/realtimeweb_test.js",user_switching:"/static/js/public/test/user_switching_test.js",user_tracking:"/static/js/public/test/user_tracking.js",user_panel:"/static/js/public/test/user_panel_test.js",universal_dom_traversal:"/static/js/public/test/universal_dom_traversal_test.js",social:"/static/js/public/test/social_test.js"};this.__test_suites={all:function(){var t=[];for(var i in test_runner.__tests)t.push(test_runner.__tests[i]);return t}}};test_runner=new BFTestRunner;if(test_runner.parse_params()["testmode"]=="on"){test_runner.init()}var Carousel=function(){var t={id:"carousel",next:"cc-next",prev:"cc-prev",item:"thumbnail",items:"thumbnails",show:3};var i=function(i){for(var r=0;r<t.show;r++){i[r].removeClassName("hidden")}};var r=function(){return $$("#"+t.id+" ."+t.item+":not(.hidden)")};return{init:function(r){if(r){t=$H(t).merge(r);t=t._object}var a=this;var s=$$("#"+t.id+" ."+t.item);if(s.length>t.show){if($$("#"+t.id+" ."+t.next).length){$$("#"+t.id+" ."+t.next)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_next",event:"click",handler:a.next})}if($$("#"+t.id+" ."+t.prev).length){$$("#"+t.id+" ."+t.prev)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_prev",event:"click",handler:a.prev})}}i(s)},next:function(i){Event.stop(i);var a=r();a.each(function(t){t.addClassName("hidden")});for(var s=0;s<a.length;s++){var n=a[s];a[s].remove();$$("."+t.items)[0].insert(n)}var o=$$("#"+t.id+"  ."+t.item);for(var s=0;s<t.show&&o.length>s;s++){o[s].removeClassName("hidden")}},prev:function(i){Event.stop(i);var a=r();a.each(function(t){t.addClassName("hidden")});for(var s=a.length;s>0;s--){var n=a[s-1];a[s-1].remove();$$("."+t.items)[0].insert({top:n})}var o=$$("#"+t.id+"  ."+t.item);for(var s=o.length,l=0;l<t.show;l++,s--){o[s-1].removeClassName("hidden")}}}};var BFcarousel=Carousel();var BF_Click=new function(){var t=this;this.trigger=bfjs.isMobile()&&BF_STATIC.env=="live"?"click":"mousedown";this.el_types=["a","input","button","i"];this.init=function(){bfjs.universal_each(t["el_types"],t.addClickEvents)};this.addClickEvents=function(i){$(document.body).on(t["trigger"],i,function(t){var r=bfjs.eventFindEl(t,i),a=r.tagName.toUpperCase();EventManager.fire("bf_click",{el:r,tag:a})})}};BF_Click.init();EventManager.observe("bf_click",function(e){if(e["tag"]=="A"){var t=e["el"];if(typeof t.href!="undefined"&&t.href.match(/http/)&&(t.href.indexOf("mailto")!==0&&(!t.href.match(/buzzfee?d.com/)||BF_STATIC.tt_page=="StandAloneQP"))){$(t)[bfjs.write_attr]("target","_blank")}}});var BF_Pound=new function(){var t=this;this.position_tag="pound_position";this.init=function(){EventManager.observe("bf_click",function(e){t.click(e["el"])})};this.click=function(i){var r=t.findPosition(i);if(r){store.set(t.position_tag,r);if(BF_STATIC.bf_env!="live"){console.log("Pound Position: "+r)}}};this.findPosition=function(i){try{var r=0,a=99;while(i!=document&&r<a){var s=$(i)[bfjs.up]();if(s[bfjs.read_attr](t.position_tag)){return s[bfjs.read_attr](t.position_tag)}else{i=s;r++}}return null}catch(e){return null}}};if(BF_STATIC.tt_page=="Home"){BF_Pound.init()}bf_report_manager=function(){this.ERR="Sorry, we&rsquo;re unable to process your request at this time. Please try again later.";this.VOTE_UPDATED="Your report has been noted. Thanks for your input.";this.cache={};this.init=function(){if(typeof bf_cache!="undefined")report_manager.cache=bf_cache;var t=$$("a.report-button");t.each(function(t){var i=t.getAttribute("comment_id");if(i){t.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})}});var i=$$("input.flag_comment_submit");i.each(function(t){t.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})});var t=$$("a.not-iteresting-button");t.each(function(t){var i=t.getAttribute("contributionid");if(i){t.observe("click",function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false})}});if(acl.user_can("edit_user_accounts")){var r=new Array("spam-admin","boring-admin","report_user-admin","not_raw-admin","toggle_raw_user-admin","edit-admin");for(var a=0;a<r.length;a++){var s=null;if(r[a]=="spam-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"flag"});return false}}else if(r[a]=="boring-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false}}else if(r[a]=="report_user-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_user"});return false}}else if(r[a]=="toggle_raw_user-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"toggle_raw"});return false}}else if(r[a]=="not_raw-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"not_raw"});return false}}else if(r[a]=="edit-admin"){s=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_buzz"});return false}}var n=$$("a."+r[a]);for(var o=0;o<n.length;o++){var l=n[o];if(s){l.show();l.observe("click",s)}}}if($("quickpost-tags")&&typeof bf_page!="undefined"&&bf_page=="moderation"){$("quickpost-tags").observe("keydown",user_post.auto_complete_special);$("quickpost-tags").observe("keyup",user_post.auto_complete);$("quickpost-tags").observe("blur",function(){window.setTimeout(function(){$("tag_suggestions").hide()},1e3)})}if($("save-edited-buzz")){$("save-edited-buzz").observe("click",report_manager.save_edited_buzz)}if($("edit_image")){$("edit_image").observe("click",report_manager.edit_image);user_setting={save_image:report_manager.save_image};if(typeof bf_page!="undefined"&&bf_page=="moderation")parent.user_post.save_quickpost_image=function(){}}}if("universal_dom"in window){universal_dom.assign_handler({bucket:"show-badges",event:"click",handler:report_manager.show_badges})}};this.flag_comment=function(e){var t=e.target;var i=t.getAttribute("comment_id");var r=function(t){bf_catcha.catcha_answer="";$("flag_comment").hide();$$('span[comment_id="'+i+'"]')[0].addClassName("reporting")}.bind(this);var a=function(){this.error(t)}.bind(this);var s=new BF_User;var n=s.getUserInfo();if(t.id&&t.id=="flag_submit"||confirm("Report this comment?")){var o={comment_id:i,action:"flag_contribution",anonymus:s.isLoggedIn()?0:1,user_id:n.userid};(new BF_Request).request("/buzzfeed/flag_comment",{method:"post",parameters:o,onSuccess:r,onFailure:a,onCatcha:function(t){flagComment.move_it(i);if(bf_catcha.catcha_answer){alert("Wrong answer!")}}})}};this.show_badges=function(t){var i="badge";var r="show-favorite-link";var a="show-all-link";if(t.for_type=="favorite"){i="favorite";r="show-all-link";a="show-favorite-link"}universal_dom.get_bucket_elements("badge").each(function(t){t.addClassName("hidden")});universal_dom.get_bucket_elements(i).each(function(t){t.removeClassName("hidden")});var s=$(r);if(s)s.removeClassName("hidden");s=$(a);if(s)s.addClassName("hidden")};this.edit_image=function(e){var t=report_manager.cache.buzzes[report_manager.current_buzz];$("user-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";BF_UI.showDialog("user-image-edit");$("user-image-edit-iframe").src="/buzzfeed/_edit_user_contribution_image?action=imageform&template=public/user/quickpost_imageform.tt";var i="link";if(t.form=="image")i="image";else if(t.form=="video")i="video";$("user-image-edit-iframe").observe("load",function(t){t.target.contentWindow.user_image.setBuzzType(i)})};this.save_image=function(t,i,r,a){var s=report_manager.cache.buzzes[report_manager.current_buzz];var n=r;n.type=s.form+"buzz";if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();n.image=t.replace(/\.(jpg|gif)$/,"");n.action="imagecrop";var o=report_manager.image_saved;var l=report_manager.image_errored;var d=new BF_Request;d.request(a,{method:"post",parameters:n,onSuccess:o,onFailure:l})};this.image_errored=function(){alert("There was an error trying to save your image")};this.image_saved=function(t){var i=report_manager.cache.buzzes[report_manager.current_buzz];if($("user-loading"))$("user-loading").hide();var r=JSON.parse(t.responseText);if(r.saved){i.oldimage=i.image;i.image=r.thumb_image;if($("img_preview")){$("img_preview").src=BF_STATIC.image_root+r.thumb_image}}else{
this.image_errored()}};this.save_edited_buzz=function(e){if(acl.user_can("edit_user_posts")){var t=report_manager.edit_form;var i=[];var r=["name","blurb"];r.each(function(r){if(t.elements[r].value=="")i.push("Missing required field ("+r+")")});if(!(t.elements["nsfw-btn"].hasClassName("selected")||t.elements["tame-btn"].hasClassName("selected"))){i.push("Please specify if it's NSFW or not")}if(i.length){alert("Cannot save. Please address the following error"+(i.length>1?"s":"")+":\n"+i.join("\n"));return}var a=report_manager.cache.buzzes[report_manager.current_buzz];for(var s in report_manager.buzz_fields_to_text_fields){if(t.elements[report_manager.buzz_fields_to_text_fields[s]].disabled==false){a[s]=t.elements[report_manager.buzz_fields_to_text_fields[s]].value}else{delete a[s]}}var n=$("badge-checkboxes").getElementsByTagName("INPUT");a.badges=[];for(var o=0;o<n.length;o++){var l=n[o];if(l.checked)a.badges.push(l.value)}var d=t.elements.tags.value.split(",");d.each(function(t){a.tags.push(t)});a.nsfw=t.elements["nsfw-btn"].hasClassName("selected")?"true":"false";var c=new BF_Request;a.category_id=t.elements["category"].options[t.elements["category"].selectedIndex].value;var u={action:"update_buzz",buzz:Object.toJSON(a),update_html:1};var f;for(var o=0;o<t.elements.promotion.length;o++){if(t.elements.promotion[o].checked)f=t.elements.promotion[o].value}if(f&&f!="none"){u.promotion=f;u.action="update_and_promote"}if(f=="queue-at"){u["queue-on-day"]=t.elements["queue-on-day"].options[t.elements["queue-on-day"].selectedIndex].value;u["queue-on-hour"]=t.elements["queue-on-hour"].options[t.elements["queue-on-hour"].selectedIndex].value}c.request("/buzzfeed/_admin",{method:"post",parameters:u,onSuccess:report_manager._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})}else{alert("You do not have permission to save edited buzz")}};this._save_edited_buzz=function(t){var i=JSON.parse(t.responseText);if(i.success==1){try{var r=report_manager.cache.buzzes[report_manager.current_buzz];var a=report_manager.edit_form;a.addClassName("hidden");a.parentNode.removeChild(a);document.getElementsByTagName("BODY")[0].appendChild(a);$("buzz-"+r.campaignid).update(i.html)}catch(e){console.dir({e:e})}}};this.cancel_inline_editor=function(){if("bf_post_tools"in window)bf_post_tools.cancel_inline_editor();else{var t=report_manager.cache.buzzes[report_manager.current_buzz];var i=report_manager.edit_form;i.addClassName("hidden");i.parentNode.removeChild(i);document.getElementsByTagName("BODY")[0].appendChild(i);$("buzz-"+t.campaignid).appendChild(report_manager.current_snippet)}};this.buzz_fields_to_text_fields={name:"name",blurb:"blurb",short_description:"short_description"};this.load_inline_editor=function(t){if("bf_post_tools"in window)return bf_post_tools.load_inline_editor(t);var i=$("_converter");if(!i){i=document.createElement("div");i.id="_converter";i.addClassName("hidden");document.getElementsByTagName("BODY")[0].appendChild(i)}if(t.buzz_id&&typeof report_manager.cache.buzzes[t.buzz_id]!="undefined"){var r=$(t.editor_id||"editForm");var a=$("buzz-"+t.buzz_id);report_manager.current_buzz=t.buzz_id;report_manager.edit_form=r;var s=report_manager.cache.buzzes[t.buzz_id];r.parentNode.removeChild(r);report_manager.current_snippet=a.cloneNode(true);a.update("");a.appendChild(r);r.removeClassName("hidden");r.elements.promotion[0].checked=true;for(var n in report_manager.buzz_fields_to_text_fields){i.update(unescape(s[n]));r.elements[report_manager.buzz_fields_to_text_fields[n]].value=i.innerHTML}if(s.form=="enhanced"){r.elements.short_description.disabled=true;r.elements.short_description.value="Use terminal to edit"}else{r.elements.short_description.disabled=false}s.badges.each(function(t){if(typeof r.elements[t]!="undefined")r.elements[t].checked=true});var o=$("tag_list");if(o){o.update("");s.tags.each(function(t,i){if(i>0&&t!="")o.appendChild(document.createTextNode(", "));o.appendChild(document.createTextNode(t))})}if(s.nsfw=="true"){r.elements["nsfw-btn"].removeClassName("selected");r.elements["tame-btn"].removeClassName("selected")}else{r.elements["tame-btn"].addClassName("selected");r.elements["nsfw-btn"].removeClassName("selected")}if($("img_preview")){$("img_preview").setAttribute("src",BF_STATIC.image_root+s.image)}if(s.category_id){var l=r.elements.category.options;for(var d=0;d<l.length;d++){if(l[d].value==s.category_id){l[d].selected=true}}}}else{alert("Invalid ID ("+t.buzz_id+")")}};this.handle_click=function(t){var i=t.e.target;if(t.type=="report_user"){this.deleteUser(i,t.type)}else if(t.type=="edit_user"){this.editUser(i,t.type)}else if(t.type=="toggle_raw"){this.toggle_raw(i,t.type)}else if(t.type=="edit_buzz"){this.edit_buzz(i,t.type)}else this.report(i,t.type)};this.edit_buzz=function(t,i){this.el=t;var r=t.getAttribute("buzz_id");var a=false;if(acl.user_can("edit_user_accounts")){a=true}if(a){window.open(BF_STATIC.static_root+"/html/index.html?action=buzz_edit&bid="+r)}};this.toggle_raw=function(t,i){if(!acl.user_can("edit_user_posts")){return alert("You do not have permission to toggle raw")}if(t.event)t=t.event.target;this.el=t;var r=t.getAttribute("user_id");var a=t.getAttribute("current_state");var s=t.getAttribute("rel:hide_success_dialog")==1;if(a==0)return;t.innerHTML="User Cannot Post to Raw";this.new_raw_state=a=="1"?0:1;var n=false;if(acl.user_can("edit_user_accounts")){n=true}if(n){var o=new BF_Request;o.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"update_flags",id:r,raw:this.new_raw_state},onSuccess:function(i){var r="This user's posts will be shown in the Raw Feed";if(this.new_raw_state==0)r="This user's posts will not be shown in the Raw Feed";if(!s)alert(r);t.setAttribute("current_state",this.new_raw_state)}.bind(this),onFailure:function(t){o.alert("Error contacting server")},bf_auth:true})}};this.editUser=function(t,i){var r="user_admin_panel";if(typeof t.event!="undefined"){t=t.event.target;r+=t.getAttribute("user_id")||(new Date).getTime()}var a=t.getAttribute("user_id");var s=t.getAttribute("username");var n=false;if(acl.user_can("edit_user_accounts")){n=true}if(n){BF_UI.create_or_show_dialog({height:545,scrolling:"no",title:"Edit User",id:r,url:BF_STATIC.web_root+"/user_panel?username="+s,user_id:a})}};this.deleteUser=function(t,i){if(!acl.user_can("edit_user_accounts")){return alert("You do not have permission to delete user")}if(typeof t.event!="undefined")t=t.event.target;var r=t.getAttribute("user_id");if(confirm("Are you sure you want to delete this user?")){var a=new BF_Request;a.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"delete",id:r},onSuccess:function(t){alert("user deleted")}.bind(this),onFailure:function(t){a.alert("Error contacting server")},bf_auth:true})}};this.report=function(t,i){var r=t.getAttribute("contributionid");var a="boring";if(i=="flag"){a="spam"}if(i=="not_raw"){a="remove_from_raw_feed"}try{var s=new BF_User;var n=false;var o="";if(acl.user_can("edit_user_accounts")){n=true}if(s.isLoggedIn()){var l=s.getUserInfo();if(l.username){o=l.username}}var d={id:r,f:a,username:o};try{t.addClassName("reporting");if(i!=="flag"){t.innerHTML="Reporting..."}}catch(e){}var c="remove this contribution from this page";if(i=="flag"){var c="delete this contribution forever"}else if(i=="not_raw"){var c="remove this contribution from the raw feed"}if(n==true){if(confirm("Are you sure you want to "+c+"?")){this._request(t,d,n,i)}}else{this._request(t,d,n,i)}}catch(e){console.error(e)}};this._request=function(t,i,r,a){var s=function(i){this.report_success(t,a,i)}.bind(this);var n=function(r){this.isa_results(t,a,r,i)}.bind(this);var o=function(){this.error(t)}.bind(this);new Ajax.Request("/buzzfeed/_flag_contribution",{method:"get",parameters:i,onSuccess:s,onFailure:o});if(r==true){var l=new BF_User;if(i.f=="spam"){i.action="delete_buzz";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}else if(i.f=="remove_from_raw_feed"){i.action="remove_from_raw_feed";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}else{i.action="moderate";new Ajax.Request("/buzzfeed/_contribution_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}}};this.report_success=function(t,i,r){t.removeClassName("reporting");t.addClassName("reported");if(i=="uniteresting"||i!=="flag"){t.innerHTML="Flagged!"}var a=r.responseText.evalJSON()};this.isa_results=function(t,i,r,a){var s="contribwhat_"+a.id.toString();if(i=="uniteresting"){$(s).innerHTML="Item Moderated"}else{$(s).innerHTML="Item Deleted"}};this.error=function(t){}};report_manager=new bf_report_manager;report_manager.init();var HeaderBuzz=function(){this.header_buzz=$A();this.page_one_buzz=$A();this.page_quantity=8;this.start_buzz=0;this.current_page=1;this.clicktrack=false;this.page_buzzid;this.is_video;this.in_progress=0;this.attach_click_handlers=function(){universal_dom.assign_handler({bucket:"abtrack",event:"mousedown",handler:this.click_handler})}.bind(this);this.click_handler=function(t){return}.bind(this);this.draw_next=function(t){if(this.start_buzz>=this.header_buzz.length-this.page_quantity){$("hothead-scripted").hide();$("hothead-unscripted").show();this.start_buzz=0;return}else if(this.start_buzz==0&&$$("#hothead-unscripted .unit").length==8){this.start_buzz=1}this.start_buzz+=t;var i=this.header_buzz.slice(this.start_buzz,this.start_buzz+this.page_quantity);this.make_page(i);this.start_buzz+=this.page_quantity-2}.bind(this);this.make_page=function(t){var i=$A("");var r=0;for(var a=0;a<t.length;a++){if(typeof page_buzzid!="undefined"&&t[a].campaignid==page_buzzid){continue}if(!t[a].badge_type)t[a].no_badge="no-badge";if(t[a].form=="link"&&t[a].link_buzz!=null){t[a].gt_label="external/"+t[a].link_buzz.match(/:\/\/(www\.)?(.[^/:]+)/)[2]}else{if(t[a].login_type=="terminal"){t[a].gt_label="editor/"+t[a].username}else{t[a].gt_label="user/"+t[a].username}}r++;var s=this.buzz_template.evaluate({buzz:t[a],slot:r});i.push(s)}$("hothead-unscripted").hide();$("hothead-scripted").innerHTML=i.join("");$("hothead-scripted").show();universal_dom.update($("hothead-scripted"))};this.init=function(){var t=this.nextone_link();if(t)t.observe("click",this.nextone_handler);$$("meta").each(function(t,i){if(t.readAttribute("property")=="bf:buzzid"){page_buzzid=t.readAttribute("content");this.page_one_buzz.unshift(page_buzzid);var r=9;$$(".HotHead .unit").each(function(t,i){if(t.hasClassName("c"+page_buzzid)&&!t.hasClassName("thumb"+r)){$$(".HotHead div.unit.thumb"+r).each(function(t,r){var a=i>=7?0:"10px";$(t).setStyle({display:"block","margin-left":a})});t.parentNode.removeChild(t);throw $break}});throw $break}}.bind(this))};this.nextone_handler=function(t){if(t)t.stop();if(this.in_progress==1){return}else if(this.header_buzz.length==0){this.load_header_buzz()}else{var i=$$("#hothead .unit");var r=BF_STATIC.tt_page=="Home"&&i[8]&&i[8].getStyle("display")=="block"?1:0;this.draw_next(r)}}.bind(this);this.nextone_link=function(){return $("header_buzz_nextone")};this.load_header_buzz=function(){this.in_progress=1;var t=new BF_Request;var i="us";if(typeof BFW_Util=="object"){i=BFW_Util.getCookie("country")!=null&&BFW_Util.getCookie("country")!="us"?BFW_Util.getCookie("country"):"us"}var r=BF_STATIC.web_root+"/_headerstrip/";if(this.is_video){r+="video/"}else if(i=="uk"||i=="au"){r+=i+"/"}r+=this.page_one_buzz.join(",")+".js";t.request(r,{method:"get",onSuccess:function(e){var t=e.responseText.evalJSON();if(t.success){this.header_buzz=$A(t.buzzes);this.in_progress=0;this.nextone_handler()}}.bind(this)})}.bind(this);this.set_page_one_buzz=function(t){this.page_one_buzz=$A(t)}};var hb=null;function load_header_buzz(){hb=new HeaderBuzz;hb.buzz_template=new Template('<div class="unit abtrack bf_dom thumb#{slot}" onmouseover="header && header.fix_length(event);" rel:bf_bucket="track" track=\'#{buzz.track}\' id="header_buzz_scripted">'+'<a rel:gt_act="post/thumb" rel:gt_label="#{buzz.gt_label}"'+'class="thumbbb bf_dom" rel:buzz_id="#{buzz.campaignid}" rel:bf_bucket="abtrack" href="#{buzz.href_link}">'+'<span class="title">#{buzz.name}</span>'+'<img src="'+BF_STATIC.image_service_root+'#{buzz.image}" alt="" />'+"</a>"+"</div>");hb.page_one_buzz=BF_STATIC.thumbstrip_initial_buzzes;hb.page_quantity=9;hb.clicktrack=$("hothead");hb.is_video=0;BuzzLoader.register(function(){hb.init()},1)}if("undefined"!=typeof BF_STATIC.non_english&&!BF_STATIC.non_english){load_header_buzz()}(function(){var t={};function i(){var t=Array.prototype.slice.call(arguments);function i(){var a=t.shift();if(a){r(a,i)}}i()}function r(i,r){if(t[i]){return false}t[i]=true;var a=document.createElement("script");a.type="text/javascript";a.src=i;a.onerror=function(){t[i]=false};a.onload=function(){r()};document.getElementsByTagName("head")[0].appendChild(a)}window.BF_LOGIN_SIGNUP={show:function(t){if(typeof localStorage!=="undefined"&&typeof delayedCbConf!=="undefined"){localStorage.setItem("bf_login.delayedLoggedInCallbacks",Object.toJSON(t.delayedCbConf))}if(BF_LOGIN_SIGNUP._show){BF_LOGIN_SIGNUP._show(t);return}this.onSuccessLoginCb=t.onSuccessLoginCb||null;this.locationName=t.locationName||null;this.registerParams=t.registerParams||null;this.isMobile=t.isMobile||null;this.isSignout=t.isSignout||null;this.onCancelLoginCb=t.onCancelLoginCb||null;i(BF_STATIC.static_root+"/js/public/amd-common.js?v="+BF_STATIC.version,BF_STATIC.static_root+"/js/public/amd-login-signup.js?v="+BF_STATIC.version)},showMobile:function(t){t.isMobile=true;if(t.toggleNav){$(".page").trigger("touchstart")}this.show(t)}};window.BF_LOGIN_SIGNUP.updateUserNav=function(){if($("usernav-signin"))$("usernav-signin").hide();if($("usernav-signup"))$("usernav-signup").hide();var t=new BF_UserNav;t.init()};function a(){if(typeof localStorage!=="undefined"&&localStorage.getItem("bf_login.delayedLoggedInCallbacks")){try{var t=localStorage.getItem("bf_login.delayedLoggedInCallbacks");if(t!=="undefined")t=t.evalJSON();else t=[];for(var i=0;i<t.length;i++){if(!Object.isArray(t[i].params))t[i].params=[t[i].params];if(typeof window[t[i].obj]!="undefined"){window[t[i].obj][t[i].fn].apply(window[t[i].obj],t[i].params)}else{new PeriodicalExecuter(function(t){return function(i){if(typeof window[t.obj]!=="undefined"){i.stop();window[t.obj][t.fn].apply(window[t.obj],t.params)}}}(t[i]),.5)}}localStorage.removeItem("bf_login.delayedLoggedInCallbacks")}catch(e){console.log(e)}}}a()})();Box.Application.addService("keycode",function(){"use strict";var t={TAB:9,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ENTER:13};var i={};i.getKeyCode=function(i){if(!t.hasOwnProperty(i)){return-1}return t[i]};i.checkKeyCode=function(i,r){if(!t.hasOwnProperty(i)){return null}return t[i]===r};return i});Box.Application.addService("loading-spinner",function(t){"use strict";var i=t.getGlobal("bf_spinner");var r=t.getService("dom");function a(t){var i=0;this.show=function(){if(i++===0){r.removeClass(t,"hidden")}};this.hide=function(){if(i&&--i===0){r.addClass(t,"hidden")}}}var s=new i;var n={};n.create=function(t){return new a(t)};n.show=function(){s.start()};n.addAttribute=function(t,i){[s.loaderEl,s.overlayEl].forEach(function(r){r.setAttribute(t,i)})};n.hide=function(){s.stop()};return n});Box.Application.addService("validation",function(){"use strict";var t={};t.isEmail=function(t){var i=/^([^@]+)@([^\.]+)\.([a-zA-Z])+/;return t&&i.test(t.trim())};return t});Box.Application.addService("util",function(t){"use strict";var i={};var jQuery=t.getGlobal("jQuery");var r=t.getGlobal("Prototype");var a=t.getGlobal("BF_STATIC");var s=t.getGlobal("$H");var n=t.getGlobal("$A");var o=t.getGlobal("Object");i.hasjQuery=function(){return!!jQuery&&!r}();i.isMobile=function(){if(i.hasjQuery&&/^mobile/i.test(a.tt_page)){return true}else if(i.hasjQuery&&/^ab_debug/i.test(a.tt_page)){return true}else if(i.hasjQuery&&a.tt_page==="BuzzAdvertise"){return true}else{return false}}();i.isMobileApp=function(){return a.mobile_app||false}();i.isDevEnv=function(){return a.bf_env==="dev"}();i.each=function(t,i){if(jQuery){return jQuery.each(t,function(t,r){i(r,t)})}else{return n(t).each(i)}};i.isNodeList=function(t){var i=Object.prototype.toString.call(t);return typeof t==="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(i)&&typeof t.length!=="undefined"&&(t.length===0||typeof t[0]==="object"&&t[0].nodeType>0)};i.nodeListToArray=function(t){return Array.prototype.slice.call(t)};i.first=function(t){var r=i.isNodeList(t)?i.nodeListToArray(t):t;if(Array.isArray(r)&&r.length){return r[0]}return t};i.last=function(t){var r=i.isNodeList(t)?i.nodeListToArray(t):t;if(Array.isArray(r)&&r.length){return r[r.length-1]}return t};i.isArraylike=function(t){var i=!!t&&"length"in t&&t.length;var r=Array.isArray?Array.isArray(t):t instanceof Array;var a=t!==null&&t===t.window;if(typeof t==="function"||a){return false}return r||i===0||typeof i==="number"&&i>0&&i-1 in t};i.each=function(t,r){var a;var s=0;var n=t.length;var o=i.isArraylike(t);if(o){for(;s<n;s++){a=r.call(t[s],s,t[s],t);if(a===false){break}}}else{for(s in t){a=r.call(t[s],s,t[s],t);if(a===false){break}}}};i.toArray=function(t){if(!t||!t.length){return t}if(Array.isArray&&Array.isArray(t)){return t}var i=[];var r=0;for(;r<t.length;r++){i.push(t[r])}return i};i.extend=function(){var t=i.toArray(arguments);if(typeof t[0]==="boolean"){t.shift()}if(i.hasjQuery){return jQuery.extend.apply(jQuery,t)}else{t.forEach(function(i,r){if(!r){return}t[0]=s(t[0]).merge(i).toObject()});return t[0]}};i.isEmptyObj=function(t){for(var i in t){if(t.hasOwnProperty(i)){return false}}return true};i.throttle=function(t,i){var r;if(!i){return t}return function(){if(r){clearTimeout(r)}r=setTimeout(t,i)}};i.getUniqueEventName=function(t,i){return t+"-"+i.id};i.getKeys=function(t){var i;if(o.keys){return o.keys(t)}else{i=[];for(var r in t){if(t.hasOwnProperty(r)){i.push(r)}}return i}};i.isIOSMobile=function(){var t=navigator.userAgent.toLowerCase();if(t.match(/iphone|ipod/)){return true}return false}();i.getQueryParams=function(){var r=t.getGlobal("location").search.substring(1);var a=t.getGlobal("decodeURIComponent");var s={};if(r){r.split("&").forEach(function(t){var i=t.split("=");s[a(i[0])]=a(i[1])})}i.addQueryParam=function(i,r,a){i=i||t.getGlobal("location").href;return i+(i.split("?")[1]?"&":"?")+(r+"="+a)};return s};return i});Box.Application.addService("select-box",function(t){"use strict";var i=t.getGlobal("document");var r=t.getService("dom");var a=t.getService("util");var s=t.getService("template-engine");var n=t.getService("keycode");var o=t.getService("log");var l={};var d={selectWrap:"js-bf-select",selectText:"js-bf-select-text",selectList:"js-bf-select-list",selectTextValue:"js-bf-select-text__value",upArrow:"js-bf-select-text__arrow--up",downArrow:"js-bf-select-text__arrow--down",focusedText:"bf-select-text--focused",listItem:"js-bf-select-list__item",activeItem:"bf-select-list__item--active",mobile:"bf-nativeselect-mobile",desktop:"bf-nativeselect-desktop",disabled:"bf-select--disabled",jsDisabled:"js-bf-select--disabled"};var c={autoinsert:true};var u={};function f(t,i){if(!t||!i){return}o.error("[T3 Service] select-box:"+t+" - "+i)}function p(t){if(r.hasClass(t,d.selectWrap)){return t}return r.up(t,"."+d.selectWrap)}function _(t,i){var a=t.getAttribute("data-nativeselectboxid");u[a]={select:i,options:r.find(i,"option"),selectEl:t,selectList:r.find(t,"."+d.selectList)[0],listItems:r.find(t,"."+d.listItem),upArrow:r.find(t,"."+d.upArrow)[0],downArrow:r.find(t,"."+d.downArrow)[0],text:r.find(t,"."+d.selectTextValue)[0]};return a}function h(t,i){var a=r.find(t,"option");var n=[];if(a.length){for(var o=0;o<a.length;o++){n.push({optionIndex:a[o].index,optionName:a[o].text||"&nbsp"})}}else{t.appendChild("<option>&nbsp;</option>");n.push({optionIndex:"0",optionName:"&nbsp;"})}s.load({id:"selectWrap",data:{options:n,value:""},returnType:"fragment",callback:i})}function m(t){t=p(t);var i=t.getAttribute("data-nativeselectboxid");if(u[i]){return u[i]}_(t);return u[i]}function g(t){t.selectList.removeAttribute("style");t.upArrow.removeAttribute("style");r.setStyle(t.downArrow,{display:"none"})}function v(t){var i;if(typeof t.activeItem!=="undefined"){i=p(t.activeItem);t=m(i)}r.setStyle(t.selectList,{display:"none"});r.setStyle(t.upArrow,{display:"none"});t.downArrow.removeAttribute("style")}function b(t){var i=p(t);if(r.hasClass(i,d.jsDisabled)){return true}return false}function w(t){if(!t){return false}var i;for(i in u){if(!u.hasOwnProperty(i)||u[i].select!==t){continue}return u[i]}return false}function y(t,i){var a=m(t);r.removeClass(a.listItems,d.activeItem);a.listItems.forEach(function(t){if(parseInt(t.getAttribute("data-optionIndex"),10)===i){r.addClass(t,d.activeItem);r.updateHTML(a.text,a.options[i].text)}})}function k(){var t=r.find(i.body,"."+d.focusedText);if(t.length){return r.up(t[0],"."+d.selectWrap)}else{return false}}function T(t){var i=r.find(t,"."+d.activeItem);if(i.length){return a.first(i)}return null}function A(t){return r.getStyle(t,"display")!=="none"}function S(t){var i=m(t);r.addClass(i.text,d.focusedText)}function E(t){var i=m(t);r.removeClass(i.text,d.focusedText)}function C(){var t;var a=r.find(i.body,"."+d.selectWrap);if(a.length){a.forEach(function(i){t=m(i);E(i);v(t)})}}function z(t){var i=p(t);var a=m(i);var s=a.listItems;var n=a.text;var o=parseInt(t.getAttribute("data-optionIndex"),10);a.options.forEach(function(t,i){if(i===o){t.selected=true;r.updateHTML(n,t.text)}else{t.selected=false}});r.removeClass(s,d.activeItem);r.addClass(t,d.activeItem);E(i)}function x(t){var i;var s=k();if(!s||b(s)){return}var o=T(s);var l=m(s);if(n.checkKeyCode("ENTER",t)){if(A(l.selectList)){if(o){z(o)}v(l)}else{g(l)}return}if(!n.checkKeyCode("UP_ARROW",t)&&!n.checkKeyCode("DOWN_ARROW",t)){return}if(n.checkKeyCode("UP_ARROW",t)){i=o?r.previous(o):a.last(l.listItems)}else{i=o?r.next(o):a.first(l.listItems)}if(i){l.listItems.forEach(function(t){r.removeClass(t,d.activeItem)});r.addClass(i,d.activeItem)}}function B(t){if(b(t.selectEl)){return}C();g(t);S(t.selectEl)}function I(t){v(t);E(t.selectEl)}function N(t){if(A(t.selectList)){I(t)}else{B(t)}}function q(t){var e=t.data.event;var i=e.target||e.currentTarget;if(!i.className.match(new RegExp(d.selectWrap,"g"))){C()}}function F(t){var e=t.data.event;if(e.altKey||e.ctrlKey){return true}var i=e.keyCode;if(n.checkKeyCode("TAB",i)||n.checkKeyCode("ESCAPE",i)){C();e.stop();return false}x(i);e.stop();return false}function U(t){if(a.isMobile){return}if(b(t.data.element)){return}switch(t.data.elementType){case"bf-select-text":N(m(t.data.element));break;case"bf-select-list__item":z(t.data.element);v({activeItem:t.data.element});break}}function O(t){var i=t.data.element instanceof HTMLSelectElement?t.data.element:r.up(t.data.element,"select");var a=w(i);if(!a){return}y(a.selectEl,i.selectedIndex)}function R(){t.on("select-box:documentclick",q);t.on("select-box:documentkeydown",F);t.on("select-box:click",U);t.on("select-box:change",O)}l.createNativeSelect=function(t){if(!t.length){f("create","No select box options provided");return false}var r=i.createElement("select");var a=i.createDocumentFragment();function s(t){var r=i.createElement("option");r.appendChild(i.createTextNode(t.key));r.value=t.value;if(t.selected){r.selected="selected"}a.appendChild(r)}t.forEach(s);r.appendChild(a);r.className="bf-select-test";r.setAttribute("data-type","select-box");return r};l.init=function(t){t=a.extend({},c,t||{});if(!t.select){f("init",'"select" element wasn\'t passed');return false}var i="bf-native-select-box-"+(new Date).getTime();h(t.select,function(s){var n=s.firstChild;n.setAttribute("data-nativeselectboxid",i);_(n,t.select);y(n,t.select.selectedIndex);if(a.isMobile){r.addClass(t.select,d.mobile)}else{r.addClass(t.select,d.desktop)}if(t.autoinsert){r.after(t.select,n);n.appendChild(t.select)}if(typeof t.callback==="function"){t.callback(n)}})};l.enable=function(t){var i=w(t);if(!i){f("enable","Unable to retrieve elements for given select");return false}r.removeClass(i.selectEl,d.disabled);r.removeClass(i.selectEl,d.jsDisabled)};l.disable=function(t){var i=w(t);if(!i){f("disable","Unable to retrieve elements for given select");return false}r.addClass(i.selectEl,d.disabled);r.addClass(i.selectEl,d.jsDisabled);v(i)};l.toggle=function(t){var i=w(t);if(!i){f("open","Unable to retrieve elements for given select");return false}N(i)};l.open=function(t){var i=w(t);if(!i){f("open","Unable to retrieve elements for given select");return false}B(i)};l.close=function(t){var i=w(t);if(!i){f("open","Unable to retrieve elements for given select");return false}I(i)};R();return l});Box.Application.addBehavior("newsletter-signup",function(t){"use strict";var i;var r;var a;var s;var n;var o;var l;var d;function c(t){d.track_events(i.getAttribute(l.gtrack_cat),t)}function u(t){if(t.length){s.removeClass(r,"hidden");r.innerHTML="<span>"+t.join("</span><span>")+"</span>"}else{s.addClass(r,"hidden")}}function f(){c("signup/email-error");u(["Sorry! Something went wrong. Please try again."])}function p(t){var r=[];if(!o.isEmail(t.email)){r.push("Please enter a valid email address");s.addClass(s.find(i,'input[name="email"]'),"error-border")}if(!t.category||!t.category.length){r.push("Don't forget to select a newsletter!")}u(r);if(r.length){c("signup/validation-error")}return!r.length}function _(i){c("signup/email-success");t.broadcast("newsletter-subscribed",i)}var h={};h.init=function(){i=t.getElement();a=t.getService("ajax");o=t.getService("validation");s=t.getService("dom");n=t.getService("loading-spinner");var c=s.find(i,"[data-type='loading-spinner']")[0];if(c){n=n.create(c)}r=s.find(i,'[data-type="error-message"]')[0];d=t.getGlobal("gtrack");l=t.getGlobal("bfjs")};h.destroy=function(){i=null;a=null;o=null;s=null};h.onsubmit=function(t,i){t.preventDefault();var r=s.serialize(i);if(p(r)){this.subscribe(r)}};h.onclick=function(t,r,a){if(a==="vertical-checkbox"){var n=s.find(r.parentNode,'input[type="checkbox"]')[0];c(n.getAttribute(l.gtrack_act)+"/"+(n.checked?"uncheck":"check"));s.addClass(s.find(i,'[data-type="success-message"]'),"hidden")}};h.subscribe=function(t){n.show();a.request({url:"/buzzfeed/_email",data:t,type:"GET",dataType:"json",success:_,error:f,always:function(){n.hide()}})};return h});Box.Application.addBehavior("select-box",function(t){"use strict";var i={};var r;function a(e){t.application.fire("select-box:documentclick",{event:e})}function s(e){t.application.fire("select-box:documentkeydown",{event:e})}function n(i,r,a){t.application.fire("select-box:click",{event:i,element:r,elementType:a})}function o(i,r,a){t.application.fire("select-box:change",{event:i,element:r,elementType:a})}i.init=function(){r=t.getService("dom");r.on("click",a);r.on("keydown",s)};i.destroy=function(){r.off("click",a);r.off("keydown",s);r=null};i.onclick=function(t,i,r){n(t,i,r)};i.onchange=function(t,i,r){o(t,i,r)};return i});Box.Application.addModule("newsletter-signup",function(t){"use strict";var i;var r;var a={};a.behaviors=["newsletter-signup"];a.messages=["newsletter-subscribed","individual-newsletter-subscribed"];a.onmessage=function(t,a){switch(t){case"newsletter-subscribed":var s=r.find(i,'[data-type="success-message"]')[0];r.removeClass(s,"hidden");s.innerHTML="Great! You'll get your first email soon.";r.removeClass(r.find(i,".js-newsletter-list")[0],"hidden");r.removeClass(r.find(i,'[data-type="subscribe-text"]'),"hidden");r.addClass(r.find(i,'[data-type="unsubscribe-text"]'),"hidden");break;case"individual-newsletter-subscribed":var n=r.find(i,"#signup_"+a.category.toLowerCase())[0];r.removeClass(i,"hidden");r.find(i,'[data-type="newsletter-signup-form"] input[name="email"]')[0].value=a.email;if(n){n.checked=true}break}};a.init=function(){i=t.getElement();r=t.getService("dom")};a.destroy=function(){i=null;r=null};return a});Box.Application.addModule("newsletter-signup-individual",function(t){"use strict";var i;var r;var a;var s={};s.behaviors=["newsletter-signup"];s.messages=["newsletter-subscribed"];s.onmessage=function(s,n){if(s==="newsletter-subscribed"){var o=a.find(i,'[data-type="success-message"]')[0];a.removeClass(o,"hidden");o.innerHTML="<span>Great!</span> You'll get your first email soon.";a.addClass(a.find(i,'[data-type="newsletter-form"]'),"hidden");if(r&&r.hideSelf){setTimeout(function(){a.addClass(i,"hidden");t.broadcast("individual-newsletter-subscribed",n.request.parameters);t.application.stop(i)},1500)}}};s.init=function(){i=t.getElement();r=t.getConfig();a=t.getService("dom")};s.destroy=function(){i=null;r=null;a=null};return s});Box.Application.addService("seed-user-impression-tracking",function(t){"use strict";var i=t.getGlobal("bfjs");var r=t.getGlobal("gtrack");var $=t.getGlobal("$");var a=t.getService("viewport-monitor");var s={};function n(t){var a=this;a.trackIfVisible=function(){try{var a=t.querySelector("["+i.gtrack_cat.replace(":","\\:")+"]");var s=a?a[i.read_attr](i.gtrack_cat):undefined;var n=t.querySelector("["+i.gtrack_act.replace(":","\\:")+"]");var o=n?n[i.read_attr](i.gtrack_act):undefined;var l=t.querySelector("["+i.gtrack_label.replace(":","\\:")+"]");var d=l?l[i.read_attr](i.gtrack_label):undefined;if(s!==undefined&&o!==undefined){r.track_events(s,"[nc]imp:"+o,d,null,true)}}catch(c){console.error(c)}}}s.addImpressionTracking=function(t){var i=new n(t);a.startWatching({target:t,renderLookahead:0,callback:i.trackIfVisible,watchOnce:true})};return s});Box.Application.addService("viewport-monitor",function(t){"use strict";var i={};var r=0;var a=t.getService("dom");var s;function n(t){var i=a.getViewPosition(t.target,t.renderLookahead);if(i.isPartiallyInViewport()||i.isPartiallyInLookahead()){t.callback();if(t.watchOnce){s.stopWatching(t.target)}}}function o(){for(var t in i){if(i.hasOwnProperty(t)){n(i[t])}}}t.getService("scroll-listener").add({callback:o});s={};s.startWatching=function(t){i[r++]=t;n(t)};s.stopWatching=function(t){if(t instanceof HTMLElement){for(var r in i){if(i.hasOwnProperty(r)&&i[r].target===t){delete i[r];break}}}};return s});Box.Application.addService("scroll-listener",function(t){"use strict";var i=350;var r=0;var a={};var s=t.getService("dom");var n=t.getService("util");function o(t){var i=this;var a={};var o=t.throttleTimeout;this.add=function(t){a[++r]=t;return r};this.remove=function(t){delete a[t]};this.trigger=function(t){if(a.hasOwnProperty(t)){a[t]()}else{for(var i in a){if(a.hasOwnProperty(i)){a[i]()}}}};s.on("scroll",n.throttle(i.trigger,o));s.on("resize",n.throttle(i.trigger,o))}var l={};l.add=function(t){if(typeof t.throttleTimeout==="undefined"){t.throttleTimeout=i}var r=a[t.throttleTimeout];if(!r){r=a[t.throttleTimeout]=new o(t)}var s=r.add(t.callback);r.trigger(s);return s};l.remove=function(t){for(var i in a){if(a.hasOwnProperty(i)){a[i].remove(t)}}};return l});Box.Application.addService("modal-dialog",function(t){"use strict";var i=t.getService("dom");var r=t.getService("template-engine");var a=t.getGlobal("document");var s=false;var n;var o;var l;var d={};var c={};function u(t){o.innerHTML=t}function f(t){l=t}function p(t){if(n){n&&n.parentNode&&n.parentNode.removeChild(n)}n=i.stringToHTML(l)[0];o=i.find(n,".js-modal__content")[0];u(t.content);d.appendChild(n)}function _(){d=a.body;r.load({id:"modal-dialog",callback:function(t){f(t)}})}c.show=function(r){r=r||{};if(typeof r.data.insertInto!=="undefined"&&r.data.insertInto.length){try{d=i.find(a.body,r.data.insertInto)[0]}catch(e){console.error(e)}}p(r.data||{});if(typeof r.callback==="function"){r.callback.call(this,n)}i.addClass(a.body,"js-show-pv-modal");s=true;t.broadcast("modal-opened")};c.start=function(){_()};c.hide=function(){if(!n){return}i.removeClass(a.body,"js-show-pv-modal");s=false;t.broadcast("modal-closed")};c.isVisible=function(){return s};return c});Box.Application.addService("seed-user-promo-selector",function(t){"use strict";var i=t.getGlobal("BF_STATIC");var r={};var a=t.hasService("cookies")?t.getService("cookies"):null;
var s=t.getService("util");var n={};Box.Application.on("message",function(t){switch(t.data.message){case"bottom-container-updated":r.bottom=t.data.messageData;n.checkPromoCombo();break;case"top-container-updated":r.top=t.data.messageData;n.checkPromoCombo();break;case"inline-container-updated":r.inline=t.data.messageData;n.checkPromoCombo();break}});n.checkPromoCombo=function(){if(r.inline&&r.bottom){if(r.bottom.template&&r.bottom.template.match(/swarm/)!==null){t.broadcast("hide-inline-promo")}}};n.selectPromo=function(t){switch(t.promoArea){case"inline":n.selectInlinePromo(t);break;case"top-container":n.selectTopContainerPromo(t);break;case"bottom-container":n.selectBottomContainerPromo(t);break}};n.selectInlinePromo=function(r){var a=r.swarm;if(a&&i.app_name!=="bfnews"){var n=0;var o=i.os;n=a.os&&a.os[o];if(a.osVersion&&!s.isEmptyObj(a.osVersion[o])){if(a.osVersion[o].all){n=1}else{var l;if(i.os_version){l=i.os_version.toString()}if(a.osVersion[o][l]){n=1}else{for(var d in a.osVersion[o]){if(d.split(",").join("")<=l.split(",").join("")){n=1;break}}}}}var c=a.testDate||new Date;var u;var f;var p;if(a.displayDates){var _=a.displayDates.mobile[o];if(s.isEmptyObj(_)){return}if(_.news_bpage){u=_.news_bpage.end;f=_.news_bpage.start}else if(_.quiz_bpage){u=_.quiz_bpage.end;f=_.quiz_bpage.start}f=f.replace(/-/g,"/");u=u.replace(/-/g,"/");p=Date.parse(f)<Date.parse(c)&&Date.parse(c)<Date.parse(u)}if(p&&(a.noOSCheck||n)){var h={};h.templateId=a.template;h.data={};var m=a.constants[o];h.data.action=m.action;h.data.campaignStyle=m.campaignStyle;h.data.gtrack=m.gtrack;var g=m.links[a.vertical]||m.links[a.metavertical]||m.links.default;if(typeof g==="object"){var v=i.country||"us";g=g[v]}h.data.href=g;h.data.copy=m.copy[a.vertical]||m.copy[a.metavertical]||m.copy.default;if(typeof window.abtest!=="undefined"&&typeof m.ab_test!=="undefined"&&m.ab_test.name&&m.ab_test.show_variation){window.EventManager.observe_once("abtest:"+m.ab_test.name,function(i){if(i===m.ab_test.show_variation){t.broadcast("display-inline-promo-by-template",h);return}})}else{t.broadcast("display-inline-promo-by-template",h)}return}}var b=r.possiblePromos;if(!b){return}b=b.split(",");var w={};b.forEach(function(t){w[t]=1});if(typeof w.newsletter_signup!=="undefined"){t.broadcast("show-inline-newsletter-signup")}};n.getRandByWeight=function(t){var i;var r;var a=0;var s=0;var n;for(n in t){i=t[n];s+=i}var o=Math.floor(Math.random()*s);for(n in t){i=t[n];a+=i;if(o<=a){r=n;break}}return r};n.selectTopContainerPromo=function(r){var a=r.swarm;if(a){var o=i.os;if(a.noOSCheck||a.os&&a.os[o]!==undefined){var l={};l.templateId=a.template;if(s.isEmptyObj(a.constants)){l.data={}}else{l.data=a.constants}if(typeof a.adParams!=="undefined"){l.data.adParams=a.adParams}t.broadcast("display-top-promo-by-template",l);return}}var d=r.promoConfig;if(s.isEmptyObj(d)){t.broadcast("hide-top-promo");return}var c=n.getRandByWeight(d);var u=n.okToShow(c);if(u){switch(c){case"bf_app":t.broadcast("show-top-bf-app-promo");break;case"fb_follow":t.broadcast("show-top-fb-like-promo");break}}else{delete d[c];n.selectTopContainerPromo(d)}};n.okToShow=function(t){if(!a){return false}if(a.get(t+"_promo_clicked")){return false}if(a.get(t+"_promo_closed")){return false}return true};n.selectBottomContainerPromo=function(r){var a=r.possiblePromos;var s={};var o=i.os;var l=r.swarm;if(l){if(l.os[o]!==undefined||l.noOSCheck){var d={};d.data={};d.templateId=l.template;if(l.constants){d.data=l.constants[o]}if(typeof l.adParams!=="undefined"){d.data.adParams=l.adParams}t.broadcast("display-bottom-promo-by-template",d);return}}if(a){a.split(",").forEach(function(t){s[t]=1})}else{return}if(!window.BF_STATIC.bf_test_mode&&typeof s.goat!=="undefined"&&typeof window.ab_config!=="undefined"&&window.ab_config.new_app_promos&&typeof window.abtest!=="undefined"&&typeof window.abtest.abTests!=="undefined"){if(!window.abtest.abTests.match("new_app_promos")){window.EventManager.observe_once("abtest:new_app_promos",function(){n.selectBottomContainerPromo(r)});return}else{var c=window.abtest.abVariations.match("new_app_promos--(goat1|goat2|corgi|cat|dudephone|dudeyawn|squadgoals|random)(,|$)");if(c.length){t.broadcast("show-bottom-test-bf-app-promo",{data:{testName:c[1],os:o}})}return}}if(typeof s.sponsored!=="undefined"){t.broadcast("show-bottom-sponsored-bf-app-promo")}else if(typeof s.news!=="undefined"){t.broadcast("show-bottom-news-bf-app-promo")}else if(typeof s.quiz!=="undefined"){t.broadcast("show-bottom-quiz-bf-app-promo")}else if(typeof s.goat!=="undefined"){t.broadcast("show-bottom-goat-bf-app-promo")}};return n});Box.Application.addModule("inline-promo",function(t){"use strict";var i;var r;var a;var s;var n;var o;var l={};l.viewed=0;l.messages=["show-inline-newsletter-signup","hide-inline-promo","display-inline-promo-by-template"];l.onmessage=function(t,i){switch(t){case"show-inline-newsletter-signup":l.displayNewsletterSignup();break;case"hide-inline-promo":l.resetHTML();break;case"display-inline-promo-by-template":l.renderTemplate(i.templateId,i.data);break}};l.resetHTML=function(){i.innerHTML=i.innerHTML.match(/<script .*script>/)[0]};l.selectPromo=function(){var i={};i.possiblePromos=t.getConfig("promos");i.swarm=t.getConfig("swarm");i.promoArea="inline";s.selectPromo(i)};l.renderTemplate=function(s,n,o){r.loadRawTemplate({id:s,path:"/components/seed_user_promos/inline/",callback:function(){var l=r.render(s,n);if(l){i.innerHTML=i.innerHTML.match(/<script .*script>/)[0]+l;t.broadcast("inline-container-updated",{template:s})}else{var d="Unable to render "+s+" template.";if(o){d=o+": "+d}a.error(d)}}})};l.displayNewsletterSignup=function(){var i=t.getConfig("vertical");var r=t.getConfig("constants").newsletter_config;var a=t.getConfig("constants").category_to_newsletter;i=typeof a[i]!=="undefined"?a[i]:"buzzfeed";var s=r[i];var n={newsletterTitle:s.prompt_bpage,category:s.email_category};if(o.isMobile){n.gtrackCat="NewsletterPromo";n.gtrackAct="inline-mobile-bpage-promo"}else{n.gtrackCat="NewsletterPromo";n.gtrackAct="inline-desktop-bpage-promo"}var d="mailchimp-newsletter-signup-form";var c="inline-promo.displayNewsletterSignup";l.renderTemplate(d,n,c)};l.init=function(){i=t.getElement();a=t.getService("log");r=t.getService("template-engine");s=t.getService("seed-user-promo-selector");o=t.getService("util");n=t.getService("seed-user-impression-tracking");this.selectPromo();n.addImpressionTracking(i)};l.destroy=function(){i=null;a=null;r=null;s=null};return l});Box.Application.addModule("top-container-promo",function(t){"use strict";var i=t.getGlobal("BF_STATIC");var r;var a;var s;var n;var o;var l;var d;var c={};c.currentPromo={};c.templateIdMap={"fb-like-banner":"fb_follow","bf-app-banner":"bf_app"};c.messages=["show-top-bf-app-promo","show-top-fb-like-promo","hide-top-promo","display-top-promo-by-template"];c.onmessage=function(t,i){switch(t){case"show-top-bf-app-promo":c.displayBFAppPromo();break;case"show-top-fb-like-promo":c.displayFBLikePromo();break;case"hide-top-promo":c.resetAndHide();break;case"display-top-promo-by-template":c.renderTemplate(i.templateId,i.data);break}};c.onclick=function(t,i,r){if(!l){return}var a=c.currentPromo.promo;var s={};s.value=1;s.days=30;if(r==="close_icon"){c.resetAndHide();if(typeof a!=="undefined"){s.name=a+"_promo_closed";l.set(s)}}else{if(typeof a!=="undefined"){s.name=a+"_promo_clicked";l.set(s)}}};c.resetAndHide=function(){d.addClass(r,"app_promo--hidden");r.innerHTML=r.innerHTML.match(/<script .*script>/)[0]};c.renderTemplate=function(n,l,u){l.staticRoot=i.static_root;l.lazyLoadPixelSrc="data:image/gif;base64,R0lGODlhAwACAPAAAAAAAAAAACH5BAEAAAAALAAAAAADAAIAAAIChF8AOw==";a.loadRawTemplate({id:n,path:"/components/seed_user_promos/top_container/",v:i.version,callback:function(){var i=a.render(n,l);if(i){d.removeClass(r,"app_promo--hidden");r.innerHTML=r.innerHTML.match(/<script .*script>/)[0]+i;c.currentPromo.template=n;c.currentPromo.promo=c.templateIdMap[n];t.broadcast("top-container-updated",{template:n});if(n.match(/sponsored-swarm/)&&i){c.setSponsoredSwarmTargeting(l.adParams)}o.addImpressionTracking(r)}else{var f="Unable to render "+n+" template.";if(u){f=u+": "+f}s.error(f)}}})};c.setSponsoredSwarmTargeting=function(t){var i=t.size.split("x").map(function(t){return parseInt(t,10)});if(typeof window.loadSwarmAds!=="undefined"){var r=true;if(typeof window.acl!=="undefined"&&window.acl.user_can("edit_hidden_ads")){r=false}window.loadSwarmAds({wid:t.wid,size:i,pos:t.pos,aclAllow:r})}};c.selectPromo=function(){var i={};i.swarm=t.getConfig("swarm");i.promoArea="top-container";i.promoConfig=t.getConfig("weightedPromos");n.selectPromo(i)};c.displayBFAppPromo=function(){var t;var r;var a=navigator.userAgent.indexOf(/safari/i)&&navigator.userAgent.indexOf(/crios/i);if(i.os==="android"){t="Browse BuzzFeed faster with the BuzzFeed app!";r="http://bit.ly/1Baaka8"}else if(i.os==="ios"&&!a){t="Save all your favs with the BuzzFeed app!";r="http://bit.ly/1BaamyN"}else{c.resetAndHide();return}var s={copy:t,adjustLink:r};var n="bf-app-banner";var o="top-container-promo.displayBFAppPromo";c.renderTemplate(n,s,o)};c.displayFBLikePromo=function(){var t={};var i="fb-like-banner";var r="top-container-promo.displayFBLikePromo";c.renderTemplate(i,t,r)};c.init=function(){r=t.getElement();s=t.getService("log");a=t.getService("template-engine");n=t.getService("seed-user-promo-selector");o=t.getService("seed-user-impression-tracking");l=t.hasService("cookies")?t.getService("cookies"):null;d=t.getService("dom");this.selectPromo()};c.destroy=function(){r=null;s=null;a=null;n=null};return c});Box.Application.addService("promise",function(t){"use strict";var i=t.getService("util");var r=t.getGlobal("jQuery");function a(t,i){return function(){var r=arguments;var a=this;return t().then(function(){return i.apply(a,r)})}}var s={};s.create=function(){return new r.Deferred};s.inject=function(t,r){i.each(r,function(i,s){if(typeof s==="function"){r[i]=a(t,s)}})};s.when=function(){return r.when.apply(r,arguments)};r.whenArray=function(t){return r.when.apply(this,t)};s.whenArray=r.whenArray;return s});Box.Application.addService("photo-viewer-modal",function(t){"use strict";var i=t.getService("util");var r=t.getService("dom");var a=t.getService("keycode");var s=t.getService("promise");var n=t.getService("template-engine");var o=t.getService("modal-dialog");var l=t.getGlobal("BF_STATIC");var d={};var c={};function u(t){var a=t;a["config"]=l;var s=a.collection.map(function(t,i){return{description:t.description,attribution:t.attribution,has_external_link:t.has_external_link,external_link_url:t.external_link_url,external_link_text:t.external_link_text,image_src:l.image_service_root+t.images.image_src}});a["metaMap"]=JSON.stringify(s);o.start();n.load({id:"photo-viewer"+(i.isMobile?"-mobile":""),data:a,callback:function(t){o.show({data:{modifier:"photo-viewer",content:t,insertInto:"#superlist_"+l.campaignid+"_"+a.id},callback:function(t){d=r.find(t,".js-photo-viewer")[0];m()}})}})}function f(){if(o.isVisible){o.hide()}g()}function p(){window.addEventListener("keyup",h)}function _(){window.removeEventListener("keyup",h)}function h(e){var t=e.keyCode;if(a.getKeyCode("ESCAPE")===t){f()}}function m(){p();t.start(d)}function g(){_();t.stop(d)}var v={};v.start=function(t){u(t)};v.stop=function(){g()};v.close=function(){f()};return v});Box.Application.addModule("photo-viewer",function(t){"use strict";var i={};var r=t.getService("keycode");var a=t.getService("dom");var s=t.getService("util");var n=t.getElement();var o=t.getGlobal("BF_STATIC");var l={};var d=t.getService("photo-viewer-modal");var c=t.getGlobal("gtrack");var u={};var f=0;var p=0;var _={};var h={};var m={};var g={};var v={};var b={};var w={};var y={};var k={};var T=false;var A=false;var S={keyup:"keyboard",click:"click"};function E(){if(f===0){a.addClass(_,"photo-viewer__toggle--disable");a.removeClass(h,"photo-viewer__toggle--disable")}else if(f===p-1){a.addClass(h,"photo-viewer__toggle--disable");a.removeClass(_,"photo-viewer__toggle--disable")}else{a.removeClass(_,"photo-viewer__toggle--disable");a.removeClass(h,"photo-viewer__toggle--disable")}}function C(){b.innerHTML=f+1+" / "+p}v=a.find(n,".js-photo-viewer__caption")[0];g=a.find(n,".js-photo-viewer__attribution")[0];function z(t){if(t!=null&&t.length){m.innerHTML=t;a.removeClass(m,"xs-hide")}else{a.addClass(m,"xs-hide")}}function x(t){if(t!=null&&t.length){g.innerHTML=t;a.removeClass(g,"xs-hide")}else{a.addClass(g,"xs-hide")}}function B(t,i,r){if(t){k.innerHTML=r;k.setAttribute("href",i);a.removeClass(k,"xs-hide")}else{a.addClass(k,"xs-hide");k.setAttribute("href","");k.innerHTML="&nbsp"}}function I(t,r){var a=o.web_root+"/"+o.username+"/"+o.uri+"?sub="+o.campaignid+"_"+i.id;w.innerHTML="";sharing.buttons.facebook_share({parentNode:w,url:a,blurb:t||o.buzz_blurb||"",description:t,picture:r,image:r,type:"subbuzz",subbuzz_no:i.id,subbuzz:o.campaignid+"_"+i.id,icon:"facebook"});sharing.buttons.twitter({parentNode:w,url:a,blurb:t||o.buzz_name,via:"buzzfeed",type:"subbuzz",subbuzz_no:i.id,subbuzz:o.campaignid+"_"+i.id,icon:"twitter",gt_label:r});sharing.buttons.pinterest({parentNode:w,url:a,media:r,description:t,type:"subbuzz",subbuzz_no:i.id,subbuzz:o.campaignid+"_"+i.id,icon:"pinterest",gt_label:r})}function N(t){a.removeClass(u[f],"photo-viewer__item--show");a.addClass(u[t],"photo-viewer__item--show");f=t;E();C();z(i.metaMap[t].description);x(i.metaMap[t].attribution);B(i.metaMap[t].has_external_link,i.metaMap[t].external_link_url,i.metaMap[t].external_link_text);I(i.metaMap[t].description,i.metaMap[t].image_src)}function q(){A=true}function F(){A=false}function U(e,t){var i=f+1;if(i>=p||A)return false;N(i);gtrack.track_events("Subbuzz","photoset-next",S[e.type])}function O(e){var t=f-1;if(t<0||A)return false;N(t);gtrack.track_events("Subbuzz","photoset-previous",S[e.type])}function R(){d.close()}function L(e,t){gtrack.track_events("Subbuzz","photoset-external-link",t.getAttribute("href"))}function j(e){var t=e.keyCode;if(r.getKeyCode("LEFT_ARROW")===t)O(e);else if(r.getKeyCode("RIGHT_ARROW")===t)U(e)}function P(){window.addEventListener("keyup",j)}function M(){window.removeEventListener("keyup",j)}var D={};l["photo-viewer-next"]=U;l["photo-viewer-previous"]=O;l["photo-viewer-close"]=R;l["photo-viewer-external-link"]=L;D.onclick=function(t,i,r){var a=l[r];if(typeof a==="function"){a.call(this,t,i)}};D.init=function(){i=t.getConfig()||{};u=a.find(n,".js-photo-viewer__item");p=u.length;f=i.startWith||0;T=i.enableKeyboard||false;_=a.find(n,".js-photo-viewer-previous");h=a.find(n,".js-photo-viewer-next");b=a.find(n,".js-photo-viewer__progress")[0];m=a.find(n,".js-photo-viewer__description")[0];v=a.find(n,".js-photo-viewer__caption")[0];g=a.find(n,".js-photo-viewer__attribution")[0];k=a.find(n,".js-photo-viewer__external-link")[0];w=a.find(n,".js-photo-viewer__share_buttons")[0];y=a.find(n,".js-photo-viewer__content")[0];N(f);P()};D.destroy=function(){M();i=null;n=null;a=null;l=null;r=null};return D});Box.Application.addModule("subbuzz-photoset",function(t){"use strict";var i={};var r;var a=t.getService("util");var s=t.getService("dom");var n=t.getService("photo-viewer-modal");var o={};var l=t.getGlobal("BF_STATIC");var d=t.getGlobal("gtrack");var c=t.getGlobal("window");var u=t.getGlobal("document");var f="photoID";function p(i,r){t.getService("ga").track("Subbuzz",i,r)}function _(t){return!!r.collection.filter(function(i){return i.id===t}).length}function h(t){var i=0;var a=r.collection.map(function(r,a){if(r.id===t)i=a;r.images.image_src=r.images.gif_preview?r.images.original_src:r.images.image_src;return{description:r.description,attribution:r.attribution,has_external_link:r.has_external_link,external_link_url:r.external_link_url,external_link_text:r.external_link_text?r.external_link_text:r.external_link,id:r.id,parent_id:l.campaignid,images:r.images,display:a===i,index:a.toString(),aratio:r.images.original.height/r.images.original.width*100}});n.start({chosen:i,collection:a,position:"photo-viewer",id:r.id})}function m(t,i){t.preventDefault();var r=i.getAttribute("data-photosetid").toString();if(l.mobile_app){var n=a.addQueryParam(c.location.href.split("#")[0],f,r);if(l.os==="ios"){var o=u.createElement("a");o.href=n;o.click()}else{c.open(n,"_self")}}else{h(r)}if(!d){var _=s.find(i,".js-subbuzz__media-link")[0];if(_){p(_.getAttribute("data-action"),_.getAttribute("data-label"))}}}function g(t,i){t.stopPropagation();if(!d){p(i.getAttribute("data-action"),i.getAttribute("data-label"))}}o["click-photoset-item"]=m;o["click-photoset-media-link"]=g;i.onclick=function(t,i,r){var a=o[r];if(typeof a==="function"){a.call(this,t,i)}};i.init=function(){r=t.getConfig();var i=a.getQueryParams()[f];if(_(i)){h(i)}};i.destroy=function(){};return i});(function(){if(!window.Box||!Box.Application||!Box.Application.getService("template-engine"))return;Box.Application.getService("template-engine").addTemplates({modal_base:new Hogan.Template({code:function(t,i,r){var a=this;a.b(r=r||"");a.b('<div class="modal__wrapper solid">');a.b("\n"+r);a.b('  <div class="modal__content xs-mt0 sm-mt6 xs-col-12 sm-col-9 md-col-7 lg-col-5">');a.b("\n"+r);a.b('    <a class="modal__close" href="javascript:">');a.b("\n"+r);a.b('      <svg class="modal__close-icon" viewBox="0 0 512 512"><use xlink:href="#close--thick"></use></svg>');a.b("\n"+r);a.b("    </a>");a.b("\n"+r);a.b('    <div class="modal__body"></div>');a.b("\n"+r);a.b("  </div>");a.b("\n"+r);a.b("</div>");return a.fl()},partials:{},subs:{}})})})();Box.Application.addService("cookies",function(){"use strict";var t={};t.get=function(t,i){var r=t+"=";var a=document.cookie.split(";");for(var s=0;s<a.length;s++){var n=a[s];while(n.charAt(0)===" "){n=n.substring(1,n.length)}if(n.indexOf(r)===0){return n.substring(r.length,n.length)}}return typeof i!=="undefined"?i:null};t.set=function(t){var i="";if(t.days){var r=new Date;r.setTime(r.getTime()+t.days*24*60*60*1e3);i=";expires="+r.toGMTString()}document.cookie=t.name+"="+t.value+i+"; path=/; domain=.buzzfeed.com"};t.remove=function(t){this.set({name:t,value:"",days:-1})};return t});(function(t){if(t.getGlobal("yt_player"))return;var $=t.getGlobal("$");var i=t.getGlobal("$$");var r=t.getGlobal("$H");function a(){if($("video_overlay_init")){o.create_player()}r(o.all_overlays).each(function(t){if(!o.players[t.key]){o.create_player_from(t.key)}})}function s(t){if(window.bfaYoutubeIframePlayerTracking){window.bfaYoutubeIframePlayerTracking(t)}else{setTimeout(function(){window.trackVideoToBfa(t)},200)}}var n=function(){this.players={};this.player_timer=false;this.overlays=[];this.all_overlays={};this.init=function(t,i){var r=window.YT||{};if(typeof t!=="undefined"){this.destroy_video(t);o.all_overlays[t]=i}else{this.destroy_video()}if(!r.Player){var s=document.createElement("script");s.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(s,n)}else{a()}};this.create_player=function(){var t=function(i){if(i.data==1){o.player.pauseVideo();t=o.player_state_change}o.player_state_change(i)};YT.embed_template='<iframe width="250" height="350" src="" frameborder="0" allowfullscreen></iframe>';o.player=new YT.Player("video_overlay_yt",{height:325,width:540,videoId:o.videoid,events:{onReady:function(){o.load_video(o.videoid);o.player.playVideo()},onStateChange:function(i){t(i)}}});var i=$("video_overlay_yt");var r=i.getAttribute("src");i.setAttribute("src",r+"&wmode=opaque");s(o.player)};this.create_player_from=function(t){o.players[t]=new YT.Player(t,{events:{onStateChange:function(i){YT_PLAYERS[t].onStateChanged(i.data,i.target);if(i.data===-1){o.set_video_intervals()}}}});youtube_track_video.addVideoListener(t);s(o.players[t])};this.destroy_video=function(t){if(t){try{o.players[t].stopVideo();o.players[t].destroy()}catch(e){}delete o.players[t]}else{try{o.player.stopVideo();o.player.destroy()}catch(e){}o.player=null}};this.load_video=function(){try{o.player.cueVideoById(o.videoid)}catch(e){}};this.set_video_id=function(t){o.videoid=t};this.set_video_intervals=function(){if(o.player_timer)return;o.player_timer=setInterval(function(){for(var i in o.players){if(!o.players[i].getCurrentTime)continue;t(i,o.players[i].getCurrentTime(),o.all_overlays[i])}if(!o.player||!o.player.getCurrentTime)return;t(null,o.player.getCurrentTime(),o.overlays)},500);function t(t,i,r){if(!r)return;var a=t?t.replace(/^\D+/,""):"";var s=a?a+"_":"";for(var n=r.length;n--;){var l=r[n];var d="anno_"+s+n;if(l&&i>=l.start&&i<=l.end){if(!$(d)){o.add_annotation(l,n,a)}}else{if($(d)){$(d).remove()}}}}};this.clear_video_interval=function(t){if(t===undefined){for(var i in o.player_timer){clearInterval(o.player_timer[i])}o.player_timer={}}else{clearInterval(o.player_timer[t]);o.player_timer[t]=null}};this.edit_annotation=function(t,r,a){var s="anno_"+(a?a+"_":"")+r;if($(s)){$(s).setStyle({top:t.top+"%",left:t.left+"%",maxWidth:Math.max(5,100-t.left)+"%"});i("#"+s+" .video_anno_txt").each(function(i){i.innerHTML=t.text});i("#"+s+" a").each(function(i){i.href=t.link})}o.overlays[r]=t};this.add_annotation=function(t,i,r){var a={position:"absolute",top:t.top+"%",left:t.left+"%",borderRadius:"3px",padding:"5px",backgroundColor:"rgba(238, 238, 238, 0.8)",cursor:"pointer",maxWidth:Math.max(5,100-t.left)+"%",wordWrap:"break-word",lineHeight:"16px"};var s=document.createElement("div");s.className="video_anno";s.id="anno_"+(r?r+"_":"")+i;s.setStyle(a);var n=document.createElement("div");n.className="video_anno_txt";n.innerHTML=t.text;var o=document.createElement("a");o.href=t.link;o.target="_blank";o.setStyle({color:"#111"});s.appendChild(o);o.appendChild(n);var l=$(r?"video_wrapper_"+r:"video_wrapper");this.scale_anno(s,l.getWidth()/625,l.getHeight()/379);l.insert({top:s})};this.scale_anno=function(t,i,r){if(i==1&&r==1)return;var a=["mozT","msT","oT","webkitT","t"];var s={};for(var n=a.length;n--;){s[a[n]+"ransform"]="scale("+i+","+r+")";s[a[n]+"ransformOrigin"]="top left 0"}t.setStyle(s)};this.get_overlay=function(t){return o.overlays[t]};this.add_overlay=function(t,i){if(typeof i!="undefined"){o.overlays[i]=t;return i}return o.overlays.push(t)-1};this.remove_overlay=function(t,i){if(i!==undefined){var r=o.all_overlays[i][t];var a="anno_"+i+"_"+t;delete o.overlays[i][t]}else{var r=o.overlays[t];var a="anno_"+t;delete o.overlays[t]}if($(a)){$(a).remove()}}};var o=new n;t.setGlobal("yt_player",o);t.setGlobal("onYouTubeIframeAPIReady",a)})(bfjs);var ABeagleApi=function(){this.abeagleTests=[];this.timeout=1e3;this.userId="";this.clientId="";var t=this;this.init=function(){if(!BF_STATIC.abeagle_url)return false;t.userId=bf_visit.unique.unhashed(bf_visit.unique.hashed());t.clientId=t.getClientId();if(BF_STATIC.hp_original&&BF_STATIC.hp_type==="index"&&BF_STATIC.country==="us"){t.getAndSetCookieHelper("abeagle_webapp_validation_newhp_02")}if(BF_STATIC.tt_page!="Buzz"){t.getAndSetCookieHelper("abeagle_videos_test")}};this.getAndSetCookie=function(i){"use strict";var r={};var a=BF_STATIC.abeagle_url+"/public/v2/experiment_variants?experiment_names="+i+"&user_id="+t.userId+"&client_id="+t.clientId;var s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState===4){if(s.status===200){var i=JSON.parse(s.responseText);for(var a in i){if(i.hasOwnProperty(a)){var n=i[a];if("value"in n){t.getAndSetCookieHelper(n["value"])}else if("error"in n){r.error_handler&&r.error_handler("error_in_experiment","Error on experiment "+a+": "+n.error)}else if("message"in n){r.error_handler&&r.error_handler("client_not_supported","Error on experiment "+a+": "+n.message)}}}r.success_handler&&r.success_handler(i)}else if(s.status===0){r.error_handler&&r.error_handler("timeout",t.timeout)}else{r.error_handler&&r.error_handler("error",s.responseText)}}};s.timeout=t.timeout;s.open("GET",a,true);s.send()};this.getAndSetCookieHelper=function(i){"use strict";var r={};var a=BF_STATIC.abeagle_url+"/public/v2/experiment_variants?experiment_names="+i+"&user_id="+t.userId+"&client_id="+t.clientId;var s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState===4){if(s.status===200){var i=JSON.parse(s.responseText);for(var a in i){if(i.hasOwnProperty(a)){var n=i[a];if("value"in n){t.setCookie(a,n["value"],r)}else if("error"in n){r.error_handler&&r.error_handler("error_in_experiment","Error on experiment "+a+": "+n.error)}else if("message"in n){r.error_handler&&r.error_handler("client_not_supported","Error on experiment "+a+": "+n.message)}}}r.success_handler&&r.success_handler(i)}else if(s.status===0){r.error_handler&&r.error_handler("timeout",t.timeout)}else{r.error_handler&&r.error_handler("error",s.responseText)}}};s.timeout=t.timeout;s.open("GET",a,true);s.send()};this.setCookie=function(i,r,a){var s=7776e3;var n=new Date;n.setTime(n.getTime()+s*1e3);s=a.expires=n;if(s&&s.toUTCString){a.expires=s.toUTCString()}var o={expires:s,domain:".buzzfeed.com",path:"/"};r=encodeURIComponent(r);var l=i+"="+r;for(var d in o){l+="; "+d;var c=o[d];if(c!==true){l+="="+c}}document.cookie=l;t.trackCookie(i,r);if(BF_STATIC.hp_original&&BF_STATIC.hp_type==="index"){t.cookieRedirect(r)}};this.trackCookie=function(t,i){var r={type:"experiment_validation",subtype:"abeagle_set_cookie",source:"buzz_web",experiment_data1:t,experiment_data2:i};pixiedust.push(r);gtrack.track_events("abeagle_set_cookie","[nc]"+t,i)};this.cookieRedirect=function(t){var i;if(t==="new_hp_control"){i=BF_STATIC.base_url+"/indexthree"}else if(t==="new_hp_test"){i=BF_STATIC.base_url+"/indexbeta"}if(i){window.location=i}};this.getClientId=function(){var t=1;if(bfjs.isMobile()){t=2}return t}};var abeagle_api=new ABeagleApi;window.addEventListener("load",abeagle_api.init);BF_HideInCountry=function(){this.get_country=function(){var t="us";if(typeof bfjs!="undefined"){t=bfjs.read_cookie("country")}else if(document.cookie){var i=new RegExp("^\\s*country=\\s*(.*?)\\s*$");var r=document.cookie.split(";").filter(function(t){return i.test(t)});if(r&&r.length)t=r[0].toString().replace(i,"$1")}return t};if(BF_STATIC.Features["ads_use_country_cookie_for_badges"]){var t=this.get_country();var i=document.querySelectorAll('*[class*="hide_in_"]');for(var r=i.length;r--;){var a=i[r];var s=new RegExp(".*\\bhide_in_"+t+"\\b.*");if(a&&!s.test(a.className)){a.className=a.className.replace(/\W+\bhide_in_[\w\-]+/g,"")}else{a.className+=" hidden"}}}var n=[document.getElementsByClassName("badges-bpage"),document.getElementsByClassName("badge-wrapper")];n.forEach(function(t){for(var i=0,r=t.length;i<r;i++){if(!t[i].querySelectorAll(".badge:not(.hidden)").length){t[i].className+=" hidden"}}})};var BF_HideInCountry=new BF_HideInCountry;Box.Application.addBehavior("native-video-embed",function(t){"use strict";var i=t.getElement();var r=[];var a=t.getService("dom");var s=t.getService("util");var n=t.getService("native-video-embed").create(i);var o=t.getService("native-video-collection");var l=false;var d=false;var c=false;var u=false;var f=false;function p(){var i={src:t.getConfig("video-src"),id:t.getConfig("id"),defaultVolume:1,sourceTypes:{mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",m3u8:"application/x-mpegURL"},classes:["native-video__embed"],attributes:{poster:t.getConfig("thumb-src"),"data-type":"native-video-embed","data-control-type":"play"},callbacks:{onloadstart:function(){z()},onwaiting:function(){z()},onplaying:function(){x()},onerror:function(e){var t;var i;for(i in e.target.error){if(i!="code"&&e.target.error[i]==e.target.error.code){t=i;break}}if(!t){return}C(n.getVideoError(t))},onprogress:function(e){var t=[];var i=e.target.buffered;var r=e.target.duration;var a;var s;for(var n=0;n<i.length;n++){t.push({start:i.start(n),end:i.end(n)})}E(r,t)},onplay:function(e){if(!e.target.paused){h()}},onpause:function(e){if(e.target.paused&&e.target.duration!=e.target.currentTime){m()}},oncanplaythrough:function(){x();b()},oncanplay:function(e){x();_();b();w(e.target.duration,e.target.currentTime)},ontimeupdate:function(e){var t=Math.floor(e.target.currentTime/e.target.duration*100);w(e.target.duration,e.target.currentTime);if(t>=25&&t<50&&!d){d=true;v(25,t)}else if(t>=50&&t<75&&!c){c=true;v(50,t)}else if(t>=75&&!u){u=true;v(75,t)}if(e.target.duration==e.target.currentTime&&!f){f=true;g()}},onfullscreen:function(e){e.target.controls=true},onexitfullscreen:function(e){e.target.controls=false;e.target.volume=1;if(e.target.muted){A()}else{S()}if(e.target.paused){T(e.target.paused)}else{k(!e.target.paused)}setTimeout(function(){o.setFullScreenMode(false)},500)}}};n.createVideo(i)}function _(){var r=s.getUniqueEventName("native-video-embed:video-load",i);t.broadcast(r,{videoSrc:t.getConfig("video-src")})}function h(){var r=s.getUniqueEventName("native-video-embed:video-play",i);t.broadcast(r,{videoSrc:t.getConfig("video-src")})}function m(){var r=s.getUniqueEventName("native-video-embed:video-pause",i);t.broadcast(r,{videoSrc:t.getConfig("video-src")})}function g(){var r=s.getUniqueEventName("native-video-embed:video-stop",i);t.broadcast(r,{videoSrc:t.getConfig("video-src")})}function v(r,a){var n=s.getUniqueEventName("native-video-embed:video-progress",i);t.broadcast(n,{videoSrc:t.getConfig("video-src"),percentage:r,realPercentage:a})}function b(){var r=s.getUniqueEventName("native-video-embed:show-video-controls",i);t.broadcast(r)}function w(r,a){var n=s.getUniqueEventName("native-video-embed:update-video-current-time",i);t.broadcast(n,{duration:r,currentTime:a})}function y(){t.broadcast("auto-pause-other-videos",{moduleEl:i})}function k(r){var a=s.getUniqueEventName("native-video-embed:auto-play-video-control",i);t.broadcast(a,{played:r})}function T(r){var a=s.getUniqueEventName("native-video-embed:auto-pause-video-control",i);t.broadcast(a,{paused:r})}function A(){var r=s.getUniqueEventName("native-video-embed:auto-mute-video-control",i);t.broadcast(r)}function S(){var r=s.getUniqueEventName("native-video-embed:auto-unmute-video-control",i);t.broadcast(r)}function E(r,a){var n=s.getUniqueEventName("native-video-embed:update-video-progress-load-control",i);t.broadcast(n,{duration:r,bufferedParts:a})}function C(r){var a=s.getUniqueEventName("native-video-embed:error-video-playing",i);t.broadcast(a,{errorText:r})}function z(){var r=s.getUniqueEventName("native-video-embed:show-video-loader",i);t.broadcast(r)}function x(){var r=s.getUniqueEventName("native-video-embed:hide-video-loader",i);t.broadcast(r)}function B(){R();y();l=false}function I(){n.playVideo();y();l=false}function N(){n.pauseVideo();l=true}function q(){n.muteVideo()}function F(){n.unmuteVideo()}function U(t){n.updateCurrentTimeVideo(t.currentTimePercentage)}function O(){n.fullScreenVideo()}function R(){p();if(n.isVideo()&&!n.isEndedVideo()&&!l&&!s.isIOSMobile){k(n.playVideo())}}function L(){if(n.isVideo()&&!s.isIOSMobile){T(n.pauseVideo())}}function j(t){if(t.moduleEl!=i&&n.isVideo()){n.pauseVideo()}}r[s.getUniqueEventName("native-video-thumb:click-video-thumb",i)]=B;r[s.getUniqueEventName("native-video-controls:click-video-control-play",i)]=I;r[s.getUniqueEventName("native-video-controls:click-video-control-pause",i)]=N;r[s.getUniqueEventName("native-video-controls:click-video-control-unmute",i)]=F;r[s.getUniqueEventName("native-video-controls:click-video-control-mute",i)]=q;r[s.getUniqueEventName("native-video-controls:click-video-control-fullscreen",i)]=O;r[s.getUniqueEventName("native-video-controls:manual-update-video-progress-bar",i)]=U;r[s.getUniqueEventName("native-video-collection:auto-play-video",i)]=R;r[s.getUniqueEventName("native-video-collection:auto-pause-video",i)]=L;r["auto-pause-other-videos"]=j;var P={};P.messages=s.getKeys(r);P.onmessage=function(t,i){var a=r[t];if(typeof a==="function"){a.call(this,i)}};P.init=function(){};P.destroy=function(){i=null;r=[];a=null;s=null;n=null};return P});Box.Application.addBehavior("native-video-controls",function(t){"use strict";var i=t.getElement();var r=[];var a=t.getService("dom");var s=t.getService("util");var n=t.getService("native-video-controls").create(i);function o(e){
n.showAndAutoHideControls();n.disableAutoUpdateProgressBar();var t=n.manualUpdateProgressBar(e);_({currentTimePercentage:t})}function l(e){n.showAndAutoHideControls();if(n.disabledAutoUpdateProgressBar){var t=n.manualUpdateProgressBar(e);_({currentTimePercentage:t})}}function d(e){n.showAndAutoHideControls();n.enableAutoUpdateProgressBar()}function c(){n.controlsEls.progressBar.wrapper.addEventListener("touchstart",o,false);n.controlsEls.progressBar.wrapper.addEventListener("touchmove",l,false);n.controlsEls.progressBar.wrapper.addEventListener("touchend",d,false)}function u(){n.controlsEls.progressBar.wrapper.removeEventListener("touchstart",o);n.controlsEls.progressBar.wrapper.removeEventListener("touchmove",l);n.controlsEls.progressBar.wrapper.removeEventListener("touchend",d)}function f(){n.createControls(function(){c()})}function p(r,a){var n=s.getUniqueEventName("native-video-controls:click-video-control-"+r,i);t.broadcast(n,a)}function p(r,a){var n=s.getUniqueEventName("native-video-controls:click-video-control-"+r,i);t.broadcast(n,a)}function _(r){var a=s.getUniqueEventName("native-video-controls:manual-update-video-progress-bar",i);t.broadcast(a,r)}function h(){t.broadcast("auto-pause-other-videos",{moduleEl:i})}function m(t){if(!t){return}switch(t){case"play":h();p(t);n.updatePlayToPause();n.enableAutoHideControls();break;case"pause":p(t);n.updatePauseToPlay();n.disableAutoHideControls();break;case"mute":p(t);n.updateMuteToUnmute();break;case"unmute":p(t);n.updateUnmuteToMute();break;case"fullscreen":p(t);h();n.hideControls();break}n.showAndAutoHideControls()}function g(){f()}function v(){n.enableDisplayControls();n.showAndAutoHideControls()}function b(t){n.updateTimeline(t.duration,t.currentTime);n.autoUpdateProgressBar(t.duration,t.currentTime);if(t.duration==t.currentTime){n.updatePauseToPlay();n.disableAutoHideControls();n.showAndAutoHideControls()}}function w(t){if(!n.isControls()){f()}if(t.played){n.enableAutoHideControls();n.showAndAutoHideControls();n.updatePlayToPause()}}function y(t){if(t.paused){n.updatePauseToPlay();n.disableAutoHideControls();n.showAndAutoHideControls()}}function k(t){n.updateMuteToUnmute()}function T(t){n.updateUnmuteToMute()}function A(t){if(t.moduleEl!=i){n.disableAutoHideControls();n.updatePauseToPlay()}}function S(t){n.updateProgressLoad(t.duration,t.bufferedParts)}function E(t){n.showError(t.errorText)}function C(){n.showLoader()}function z(){n.hideLoader()}r[s.getUniqueEventName("native-video-thumb:click-video-thumb",i)]=g;r[s.getUniqueEventName("native-video-embed:show-video-controls",i)]=v;r[s.getUniqueEventName("native-video-embed:update-video-current-time",i)]=b;r[s.getUniqueEventName("native-video-embed:auto-play-video-control",i)]=w;r[s.getUniqueEventName("native-video-embed:auto-pause-video-control",i)]=y;r[s.getUniqueEventName("native-video-embed:auto-mute-video-control",i)]=k;r[s.getUniqueEventName("native-video-embed:auto-unmute-video-control",i)]=T;r[s.getUniqueEventName("native-video-embed:update-video-progress-load-control",i)]=S;r[s.getUniqueEventName("native-video-embed:error-video-playing",i)]=E;r[s.getUniqueEventName("native-video-embed:show-video-loader",i)]=C;r[s.getUniqueEventName("native-video-embed:hide-video-loader",i)]=z;r["auto-pause-other-videos"]=A;var x={};x.messages=s.getKeys(r);x.onmessage=function(t,i){var a=r[t];if(typeof a==="function"){a.call(this,i)}};x.init=function(){};x.destroy=function(){i=null;r=[];a=null;s=null;n=null};x.onclick=function(t,i,r){if(r=="native-video-controls"||r=="native-video-embed"){m(i.getAttribute("data-control-type"))}};x.onmousedown=function(t,i,r){var a;if(r=="native-video-controls"){a=i.getAttribute("data-control-type");if(!a){return}if(a=="progress"){o(t)}}};x.onmouseup=function(t,i,r){var a;if(r=="native-video-controls"){a=i.getAttribute("data-control-type");if(!a){return}if(a=="progress"){d(t)}}};x.onmousemove=function(t,i,r){var a;if(r=="native-video-controls"){a=i.getAttribute("data-control-type");if(!a){return}if(a=="progress"){l(t)}}};x.onmouseover=function(t,i,r){n.showAndAutoHideControls()};x.onmouseout=function(t,i,r){var a;if(r=="native-video-controls"){a=i.getAttribute("data-control-type");if(!a){return}if(a=="progress"){d(t)}}};return x});Box.Application.addBehavior("native-video-thumb",function(t){"use strict";var i=t.getElement();var r=t.getService("native-video-thumb").create(i);var a=t.getService("util");var s=[];function n(){var r=a.getUniqueEventName("native-video-thumb:click-video-thumb",i);t.broadcast(r,{moduleEl:i})}function o(){r.thumbIsHidden=true;if(r.isThumb()){r.hideThumb()}}s[a.getUniqueEventName("native-video-collection:auto-play-video",i)]=o;var l={};l.messages=a.getKeys(s);l.onmessage=function(t,i){var r=s[t];if(typeof r==="function"){r.call(this,i)}};l.init=function(){r.createThumb(t.getConfig("thumb-src"))};l.destroy=function(){i=null;r=null;a=null};l.onclick=function(t,i,a){if(a=="native-video-thumb"){r.hideThumb();n()}};return l});Box.Application.addBehavior("native-video-collection",function(t){"use strict";var i=t.getElement();var r=t.getService("util");var a=t.getService("native-video-collection");function s(){var a=r.getUniqueEventName("native-video-collection:auto-play-video",i);t.broadcast(a)}function n(){var a=r.getUniqueEventName("native-video-collection:auto-pause-video",i);t.broadcast(a)}var o={};o.init=function(){a.setToVideoCollection({moduleEl:i,autoPlayVideo:s,autoPauseVideo:n})};o.destroy=function(){i=null;r=null;a=null};return o});Box.Application.addBehavior("native-video-tracking",function(t){"use strict";var i;var r;var a;function s(t,i){if(!window.bfa||!(window.bfa instanceof Function)||!window.bfaBinder){return}bfa(t,i)}function n(t){var i="track/video/load";var r={t:"load",n:"native-video-load",l:"native-video",d:"Video is loaded",data:t};s(i,r)}function o(t){var i="track/video/play";var r={t:"play",n:"native-video-play",l:"native-video",d:"Video is playing",data:t};s(i,r)}function l(t){var i="track/video/pause";var r={t:"pause",n:"native-video-pause",l:"native-video",d:"Video is paused",data:t};s(i,r)}function d(t){var i="track/video/stop";var r={t:"stop",n:"native-video-stop",l:"native-video",d:"Video is stopped",data:t};s(i,r)}function c(t){var i="track/video/progress";var r={t:"progress-"+t.percentage,n:"native-video-progress-"+t.percentage,l:"native-video",d:t.percentage+"% of video is shown",data:t};s(i,r)}function u(){a[r.getUniqueEventName("native-video-embed:video-load",i)]=n;a[r.getUniqueEventName("native-video-embed:video-play",i)]=o;a[r.getUniqueEventName("native-video-embed:video-pause",i)]=l;a[r.getUniqueEventName("native-video-embed:video-stop",i)]=d;a[r.getUniqueEventName("native-video-embed:video-progress",i)]=c;return r.getKeys(a)}var f={};f.onmessage=function(t,i){var r=a[t];if(typeof r==="function"){r.call(this,i)}};f.init=function(){i=t.getElement();r=t.getService("util");a=[];f.messages=u()};f.destroy=function(){i=null;r=null;a=[]};return f});Box.Application.addService("native-video-thumb",function(t){"use strict";var i=t.getService("dom");var r=Box.Application.getService("template-engine");function a(t){this.moduleEl=t;this.thumbEl=null;this.thumbPlayEl=null;this.thumbIsHidden=false}a.prototype.createThumb=function(t){var a=this;r.load({id:"native-video-thumb",data:{thumbSrc:t},returnType:"fragment",callback:function(t){a.moduleEl.appendChild(t);a.thumbEl=i.find(a.moduleEl,".native-video__thumb")[0];a.thumbPlayEl=i.find(a.moduleEl,".native-video__thumb-play")[0];if(a.thumbIsHidden){a.hideThumb()}}})};a.prototype.isThumb=function(){return this.thumbEl?true:false};a.prototype.showThumb=function(){this.thumbIsHidden=false;i.setStyle(that.thumbPlayEl,{display:"block"});i.setStyle(this.thumbEl,{display:"block"})};a.prototype.hideThumb=function(){this.thumbIsHidden=true;i.setStyle(this.thumbPlayEl,{display:"none"});i.setStyle(this.thumbEl,{display:"none"})};return{create:function(t){return new a(t)}}});Box.Application.addService("native-video-embed",function(t){"use strict";var i=t.getService("dom");var r=t.getService("native-video-collection");var a={MEDIA_ERR_ABORTED:"You aborted the media playback",MEDIA_ERR_NETWORK:"A network error caused the media download to fail part-way.",MEDIA_ERR_DECODE:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The media could not be loaded, either because the server or network failed or because the format is not supported.",MEDIA_ERR_ENCRYPTED:"The media is encrypted and we do not have the keys to decrypt it."};var s=function(){if("onfullscreenchange"in document){return"fullscreenchange"}else if("onmozfullscreenchange"in document){return"mozfullscreenchange"}else if("onwebkitfullscreenchange"in document){return"webkitfullscreenchange"}else if("onmsfullscreenchange"in document){return"MSFullscreenChange"}return false}();function n(t){this.moduleEl=t;this.videoEl=null;this.isFullScreen=false}n.prototype.createVideoElement=function(t){var r=this;var a;var n;var o;var l;var d;if(!t.src){return null}this.videoEl=document.createElement("video");if(t.classes){this.videoEl.setAttribute("class",t.classes.join(" "))}if(t.attributes){for(n in t.attributes){this.videoEl.setAttribute(n,t.attributes[n])}}if(t.callbacks){for(o in t.callbacks){this.videoEl[o]=t.callbacks[o]}}if(t.defaultVolume){this.videoEl.volume=t.defaultVolume}else{this.videoEl.volume=1}if(s){document.addEventListener(s,function(){if(!r.isFullScreen){return}if(!document.fullscreen&&!document.webkitIsFullScreen&&!document.mozFullScreen&&!document.msFullscreenElement){r.isFullScreen=false;if(r.videoEl.onexitfullscreen){r.videoEl.onexitfullscreen({target:r.videoEl})}}else{if(r.videoEl.onfullscreen){r.videoEl.onfullscreen({target:r.videoEl})}}})}if(t.sourceTypes){for(l in t.sourceTypes){if(new RegExp("."+l).test(t.src)){a=document.createElement("source");a.type=t.sourceTypes[l];a.src=t.src;this.videoEl.appendChild(a)}}}else{this.videoEl.src=t.src}i.append(this.moduleEl,this.videoEl)};n.prototype.createVideo=function(t){if(this.isVideo()){return}this.createVideoElement(t)};n.prototype.isVideo=function(){return this.videoEl?true:false};n.prototype.playVideo=function(){this.videoEl.play();if(!this.videoEl.paused){this.videoEl.setAttribute("data-control-type","pause")}return!this.videoEl.paused};n.prototype.isEndedVideo=function(){return this.videoEl.duration==this.videoEl.currentTime};n.prototype.pauseVideo=function(){this.videoEl.pause();if(this.videoEl.paused){this.videoEl.setAttribute("data-control-type","play")}return this.videoEl.paused};n.prototype.muteVideo=function(){this.videoEl.muted=true};n.prototype.unmuteVideo=function(){this.videoEl.muted=false};n.prototype.updateCurrentTimeVideo=function(t){this.videoEl.currentTime=Math.min(this.videoEl.duration,this.videoEl.duration*t/100)};n.prototype.fullScreenVideo=function(){var t=false;if(this.videoEl.requestFullscreen){t=true;this.videoEl.requestFullscreen()}else if(this.videoEl.msRequestFullscreen){this.videoEl.controls=true;t=true;this.videoEl.msRequestFullscreen()}else if(this.videoEl.mozRequestFullScreen){t=true;this.videoEl.mozRequestFullScreen()}else if(this.videoEl.webkitRequestFullscreen){t=true;this.videoEl.webkitRequestFullscreen()}if(t){this.isFullScreen=true;r.setFullScreenMode(true)}};n.prototype.getVideoError=function(t){if(t&&a[t]){return a[t]}return""};return{create:function(t){return new n(t)}}});Box.Application.addService("native-video-controls",function(t){"use strict";var i=t.getService("dom");var r=Box.Application.getService("template-engine");function a(t){var i=Math.floor(t/(60*60));var r=t%(60*60);var a=Math.floor(r/60);var s=r%60;var t=Math.floor(s);return{h:i,m:a,s:t}}function s(t){var i=a(t);var r="";if(i.h){r+=i.h+":"}if(i.m){r+=i.m+":"}else{r+="0:"}if(i.s){r+=i.s<10?"0"+i.s:i.s}else{r+="00"}return r}function n(t){this.moduleEl=t;this.controlsEls=null;this.disabledDisplayControls=true;this.disabledAutoHideControls=true;this.disabledAutoUpdateProgressBar=false;this.autoHideControlsTimeout=null;this.controlsLoadCallbacks={}}n.prototype.createControls=function(t){var a=this;var s;if(this.controlsEls){return}r.load({id:"native-video-controls",returnType:"fragment",callback:function(r){a.moduleEl.appendChild(r);a.controlsEls={loader:i.find(a.moduleEl,".native-video-loader")[0],errorWrapper:i.find(a.moduleEl,".native-video-error")[0],wrapper:i.find(a.moduleEl,".native-video-controls")[0],playButton:i.find(a.moduleEl,".native-video__play-button")[0],muteButton:i.find(a.moduleEl,".native-video__mute-button")[0],currentTimeText:i.find(a.moduleEl,".native-video__current-time-text")[0],durationText:i.find(a.moduleEl,".native-video__duration-text")[0],progressBar:{wrapper:i.find(a.moduleEl,".native-video-progress")[0],play:i.find(a.moduleEl,".native-video-progress__play")[0],load:i.find(a.moduleEl,".native-video-progress__load")[0],seekHandle:i.find(a.moduleEl,".native-video-progress__seek-handle")[0]}};if(t){a.controlsLoadCallbacks["createControls"]=t}for(s in a.controlsLoadCallbacks){a.controlsLoadCallbacks[s].call(a)}}})};n.prototype.isControls=function(){return this.controlsEls?true:false};n.prototype.showControls=function(){if(!this.isControls()){this.controlsLoadCallbacks["showControls"]=this.showControls;return}i.setStyle(this.controlsEls.wrapper,{display:"block"})};n.prototype.hideControls=function(){if(!this.isControls()){this.controlsLoadCallbacks["hideControls"]=this.hideControls;return}i.setStyle(this.controlsEls.wrapper,{display:"none"})};n.prototype.updateTimeline=function(t,r){var a=this;if(!this.isControls()){this.controlsLoadCallbacks["updateTimeline"]=function(){a.updateTimeline(t,r)};return}var n=s(Math.max(0,t-r));var o=s(r);i.updateHTML(this.controlsEls.currentTimeText,o);i.updateHTML(this.controlsEls.durationText,"-"+n)};n.prototype.autoUpdateProgressBar=function(t,r){var a=this;if(!this.isControls()){this.controlsLoadCallbacks["autoUpdateProgressBar"]=function(){a.autoUpdateProgressBar(t,r)};return}if(this.disabledAutoUpdateProgressBar){return}i.setStyle(this.controlsEls.progressBar.play,{width:Math.max(0,Math.min(100,r/t*100))+"%"});i.setStyle(this.controlsEls.progressBar.seekHandle,{left:Math.max(0,Math.min(100,r/t*100))+"%"})};n.prototype.manualUpdateProgressBar=function(e){var t=this;if(!this.isControls()){this.controlsLoadCallbacks["manualUpdateProgressBar"]=function(){t.manualUpdateProgressBar(e)};return}if(!this.disabledAutoUpdateProgressBar){return}e.preventDefault();e.stopPropagation();var r=(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0);var a=e.changedTouches?Math.min(e.changedTouches[0].clientX,e.changedTouches[0].pageX,e.changedTouches[0].screenX):Math.min(e.clientX,e.pageX,e.screenX);var s=this.controlsEls.progressBar.wrapper.clientWidth||this.controlsEls.progressBar.wrapper.offsetWidth;var n=i.offset(this.controlsEls.progressBar.wrapper);var o=Math.min(s,Math.max(0,a-Math.abs(n.left-r)));var l=Math.min(100,Math.max(0,o/s*100));i.setStyle(this.controlsEls.progressBar.play,{width:l+"%"});i.setStyle(this.controlsEls.progressBar.seekHandle,{left:l+"%"});return l};n.prototype.disableAutoUpdateProgressBar=function(){this.disabledAutoUpdateProgressBar=true};n.prototype.enableAutoUpdateProgressBar=function(){this.disabledAutoUpdateProgressBar=false};n.prototype.updatePlayToPause=function(){if(!this.isControls()){this.controlsLoadCallbacks["updatePlayToPause"]=this.updatePlayToPause;return}if(this.controlsEls.playButton.getAttribute("data-control-type")!="play"){return}this.controlsEls.playButton.setAttribute("data-control-type","pause");i.addClass(this.controlsEls.playButton,"native-video__play-button--pause")};n.prototype.updatePauseToPlay=function(){if(!this.isControls()){this.controlsLoadCallbacks["updatePauseToPlay"]=this.updatePauseToPlay;return}if(this.controlsEls.playButton.getAttribute("data-control-type")!="pause"){return}this.controlsEls.playButton.setAttribute("data-control-type","play");i.removeClass(this.controlsEls.playButton,"native-video__play-button--pause")};n.prototype.updateMuteToUnmute=function(){if(!this.isControls()){this.controlsLoadCallbacks["updateMuteToUnmute"]=this.updateMuteToUnmute;return}if(this.controlsEls.muteButton.getAttribute("data-control-type")!="mute"){return}this.controlsEls.muteButton.setAttribute("data-control-type","unmute");i.addClass(this.controlsEls.muteButton,"native-video__mute-button--mute")};n.prototype.updateUnmuteToMute=function(){if(!this.isControls()){this.controlsLoadCallbacks["updateUnmuteToMute"]=this.updateUnmuteToMute;return}if(this.controlsEls.muteButton.getAttribute("data-control-type")!="unmute"){return}this.controlsEls.muteButton.setAttribute("data-control-type","mute");i.removeClass(this.controlsEls.muteButton,"native-video__mute-button--mute")};n.prototype.enableDisplayControls=function(){this.disabledDisplayControls=false};n.prototype.disableDisplayControls=function(){this.disabledDisplayControls=true};n.prototype.enableAutoHideControls=function(){this.disabledAutoHideControls=false};n.prototype.disableAutoHideControls=function(){this.disabledAutoHideControls=true};n.prototype.showAndAutoHideControls=function(){var t=this;if(!this.isControls()||this.disabledDisplayControls){this.controlsLoadCallbacks["showAndAutoHideControls"]=this.showAndAutoHideControls;return}this.showControls();clearTimeout(this.autoHideControlsTimeout);this.autoHideControlsTimeout=setTimeout(function(){if(!t.disabledAutoHideControls){t.hideControls()}},2500)};n.prototype.updateProgressLoad=function(t,r){var a=this;var s;var n;var o;var l;var d;var c;if(!this.isControls()){this.controlsLoadCallbacks["updateProgressLoad"]=function(){a.updateProgressLoad(t,r)};return}if(!r.length){return}n=i.find(this.moduleEl,".native-video-progress__load-part");for(c=0;c<r.length;c++){l=parseFloat((r[c].start/t*100).toFixed(1));d=parseFloat(((r[c].end-r[c].start)/t*100).toFixed(1));if(d<=3){continue}if(n[c]){o=n[c];o.setAttribute("style","left:"+l+"%; width:"+d+"%;")}else{o=document.createElement("div");o.setAttribute("class","native-video-progress__load-part fill-gray");this.controlsEls.progressBar.load.appendChild(o);o.setAttribute("style","left:"+l+"%; width:"+d+"%;")}}n=i.find(this.moduleEl,".native-video-progress__load-part");for(c=n.length;c>r.length;c--){this.controlsEls.progressBar.load.removeChild(n[c-1])}s=r[r.length-1].end/t*100;if(s>99){s=100}i.setStyle(this.controlsEls.progressBar.load,{width:s+"%"})};n.prototype.showError=function(t){var r=this;if(!this.isControls()){this.controlsLoadCallbacks["showError"]=function(){r.showError(t)};return}this.disableDisplayControls();i.updateHTML(this.controlsEls.errorWrapper,t);i.setStyle(this.controlsEls.errorWrapper,{display:"block"})};n.prototype.showLoader=function(){if(!this.isControls()){this.controlsLoadCallbacks["showLoader"]=this.showLoader;return}i.setStyle(this.controlsEls.loader,{display:"block"})};n.prototype.hideLoader=function(){if(!this.isControls()){this.controlsLoadCallbacks["hideLoader"]=this.hideLoader;return}i.setStyle(this.controlsEls.loader,{display:"none"})};return{create:function(t){return new n(t)}}});Box.Application.addService("native-video-collection",function(t){"use strict";var i=t.getService("dom");var r=t.getService("scroll-listener");var a=t.getService("viewport-monitor");var s=[];var n=null;var o=false;var l=false;var d;function c(){return l}function u(t){var r=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);var a=window.innerHeight||document.documentElement.clientHeight;var s=i.offset(t);var n=t.clientHeight;var o=0;if(a<n){return o}if(s.top-r<0){o=Math.abs(s.top-r)/n*100}else if(s.top+n-(r+a)>0){o=(s.top+n-(r+a))/n*100}return o}if(!o){r.add({callback:function(){if(c()){return}for(d=0;d<s.length;d++){if(n!=s[d].moduleEl){s[d].autoPauseVideo()}}n=null}});o=true}var f={};f.setFullScreenMode=function(t){l=t};f.setToVideoCollection=function(t){s.push(t);a.startWatching({target:t.moduleEl,renderLookahead:0,callback:function(){if(c()){return}if(u(t.moduleEl)>15){return}if(n){return}n=t.moduleEl;t.autoPlayVideo()}})};return f});Box.Application.addModule("native-video",function(t){"use strict";var i=t.getService("util");var r={};r.behaviors=["native-video-thumb","native-video-embed","native-video-collection","native-video-tracking"];if(!i.isIOSMobile){r.behaviors.push("native-video-controls")}return r});